<!DOCTYPE html>
    <html lang="en">
      <head>
        <link rel="stylesheet" type="text/css" href="/assets/static/renderer_css_index-e8e12f67.BzcesyCW.css">
        <link rel="stylesheet" type="text/css" href="/assets/static/renderer_Layout-031b266d.CEjdw0pU.css">
        <meta charset="UTF-8" />
        <link rel="icon" href="/img/head.webp" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Gaubee&#039;s Blogs / Events / Projects" />
        <title>Gaubee&#039;s Site</title>
      </head>
      <body>
        <div id="root"><link rel="preload" as="image" href="/img/head.webp"/><div style="display:flex;max-width:900px;margin:auto"><div style="display:flex;flex-direction:column;justify-content:space-between;max-height:100vh;width:38%;max-width:26em;position:sticky;top:0"><div id="sidebar" style="padding:20px;flex-shrink:0;display:flex;flex-direction:column;line-height:1.8em;border-right:2px solid #eee"><div style="margin-top:20px;margin-bottom:10px"><a href="/"><img src="/img/head.webp" height="64" width="64" alt="logo"/></a></div><a href="/" class="">Timeline</a><a href="/projects" class="">Projects</a><a href="/about" class="">About</a></div><div style="padding:16px"><small>本网站不收集任何访问者的行为与信息，不做任何商业运作，仅仅为个人使用。</small><small style="display:block;margin-top:8px"><a href="https://beian.miit.gov.cn/#/Integrated/recordQuery">闽ICP备17026139号-1</a></small></div></div><div id="page-container"><div id="page-content" style="padding:20px;padding-bottom:50px;min-height:100vh;background-color:#fafafa;color:#333"><style type="text/css">
          p {
            text-indent: "2em";
            line-height: 3;
          }
        </style><h1>Publishing Your Deno Project as a Monorepo using dnt</h1><main><h2>Publishing Your Deno Project as a Monorepo using dnt</h2>
<blockquote>
<p>Before providing theoretical guidance, let's look at how to achieve this in practice. After completion, I will explain the advantages of this project management solution.</p>
</blockquote>
<h3>Tools</h3>
<ol>
<li><a href="https://deno.com/" target="_blank">deno</a></li>
<li><a href="https://pnpm.io/installation" target="_blank">pnpm</a></li>
</ol>
<h3>Preparation</h3>
<ol>
<li>
<p>Create your project:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">deno</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> dnt-mono</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># cd dnt-mono</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># code . # open in ide</span></span></code></pre>
</li>
<li>
<p>Initialize a git repository</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">git</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "npm\nnode_modules"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> .gitignore</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # ignore the npm folder</span></span></code></pre>
</li>
<li>
<p>Initialize package.json, and other files typically required by npm/pnpm</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --yes</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --private</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # create a package.json file</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "MIT"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> LICENSE</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "# Hello Dnt ❤️ Monorepo"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> README.md</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "packages:\n  - </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">npm/*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> pnpm-workspace.yaml</span></span></code></pre>
</li>
<li>
<p>Prepare the dnt script</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">deno</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> @deno/dnt</span></span></code></pre>
<p>Refer to <a href="https://github.com/denoland/dnt?tab=readme-ov-file#setup" target="_blank">Setup</a>, as we need to build multiple npm packages, create the <code>scripts/npmBuilder.ts</code> file:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-ts"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { build, BuildOptions, emptyDir } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "@deno/dnt"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fs </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "node:fs"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> path </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "node:path"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { fileURLToPath } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "node:url"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rootDir</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">meta</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rootResolve</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">path</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fileURLToPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> URL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(path, rootDir));</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> npmBuilder</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> async</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">config</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  packageDir</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  version</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  importMap</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  options</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Partial</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">BuildOptions</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">packageDir</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">version</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">importMap</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">options</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> config;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> packageResolve</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">path</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    fileURLToPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> URL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(path, packageDir));</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> packageJson</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> JSON</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    fs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">readFileSync</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">packageResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./package.json"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"utf-8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // remove some field which dnt will create. if you known how dnt work, you can keep them.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> packageJson.main;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> packageJson.module;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> packageJson.exports;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">start dnt: ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">packageJson</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">name</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> npmDir</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rootResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`./npm/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">packageJson</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">name</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">split</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pop</span><span style="color:#032F62;--shiki-dark:#9ECBFF">()</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> npmResolve</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">p</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> path.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(npmDir, p);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  await</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> emptyDir</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(npmDir);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (version) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Object.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">assign</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(packageJson, { version: version });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  await</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> build</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    entryPoints: [{ name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"."</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, path: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">packageResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./index.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    outDir: npmDir,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    packageManager: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"pnpm"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    shims: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      deno: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // you should open it in actual</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    test: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    importMap: importMap,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    package: packageJson,</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // custom by yourself</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    compilerOptions: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      lib: [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"DOM"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ES2022"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      target: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ES2022"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      emitDecoratorMetadata: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    postBuild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">      // steps to run after building and before running the tests</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      Deno.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">copyFileSync</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rootResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./LICENSE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">npmResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./LICENSE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      Deno.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">copyFileSync</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        packageResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./README.md"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        npmResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./README.md"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">options,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span></code></pre>
</li>
</ol>
<h3>Main Steps</h3>
<ol>
<li>
<p>Create two subfolders and add some project files</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># start from root</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">mkdir</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> packages/module-a</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">cd</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> packages/module-a</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "export const a = 1;"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> index.ts</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "# @dnt-mono/module-a"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> README.md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --scope</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> @dnt-mono</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --yes</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # name: @dnt-mono/module-a</span></span></code></pre>
<p>Repeat the steps to create a <code>module-b</code> folder</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># start from root</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">mkdir</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> packages/module-b</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">cd</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> packages/module-b</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "import { a } from </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">@dnt-mono/module-a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">;\nexport const b = a + 1;"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> index.ts</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">echo</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "# @dnt-mono/module-b"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> README.md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --scope</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> @dnt-mono</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --yes</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # name: @dnt-mono/module-b</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pnpm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> @dnt-mono/module-a</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --workspace</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # add module-a as a dependency</span></span></code></pre>
</li>
<li>
<p>In this example, <code>module-b</code> depends on <code>module-a</code>, and we used the specifier <code>@dnt-mono/module-a</code> in the code, so we need some configurations to make the deno language server work correctly. In the <code>imports</code> field of <code>deno.json</code>, add these configurations:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-jsonc"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF"> "@dnt-mono/module-a"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./packages/module-a/index.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6A737D;--shiki-dark:#6A737D">// in imports</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF"> "@dnt-mono/module-b"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./packages/module-b/index.ts"</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // in imports</span></span></code></pre>
</li>
<li>
<p>Next, create the build script and configuration files</p>
<ol>
<li>
<p><code>scripts/build_npm.ts</code></p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-ts"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { npmBuilder } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "./npmBuilder.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> version</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Deno.args[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">await</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> npmBuilder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  packageDir: </span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">meta</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../packages/module-a/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  importMap: </span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">meta</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./import_map.npm.json"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  version,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">await</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> npmBuilder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  packageDir: </span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">meta</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../packages/module-b/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  importMap: </span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">meta</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./import_map.npm.json"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  version,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
</li>
<li>
<p><code>scripts/import_map.npm.json</code></p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-json"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  "imports"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "@dnt-mono/module-a"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"npm:@dnt-mono/module-a"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "@dnt-mono/module-b"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"npm:@dnt-mono/module-b"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre>
</li>
</ol>
</li>
<li>
<p>Then, in your <code>deno.json</code>, configure the build command:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-jsonc"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">"build"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"deno run -A ./scripts/build_npm.ts"</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // in tasks</span></span></code></pre>
</li>
<li>
<p>Finally, try executing the build command to create the npm directory</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">deno</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> task</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span></span></code></pre>
<p>Now, you should see the npm directory has been populated with the module-a and module-b folders ready for npm publishing.
You can try to publish these npm packages:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pnpm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> publish</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -r</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --no-git-checks</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dry-run</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # you should remove --dry-run for an actual run</span></span></code></pre>
</li>
</ol>
<h3>How It Works</h3>
<ol>
<li>We use deno as the language server, which is quite powerful, vastly improved from tsc itself through customized development.</li>
<li>So here, the package.json is just a &quot;template file&quot; and not a configuration file. The only configuration file that goes into effect during development is deno.json.</li>
<li>Hence, pnpm is just a tool for the final output built by dnt, meaning it only serves the <code>npm/*</code> directory. This is also why <code>pnpm-workspaces.yaml</code> is configured as it is.</li>
<li>The <code>import_map.npm.json</code> used in dnt is essential. We can't use <code>deno.json</code> directly as <code>importMap</code> because <code>deno.json</code> is configured for the deno language server, while <code>import_map.npm.json</code> is for dnt/pnpm use. In complex projects, it's advisable to manage it automatically with a script.</li>
</ol>
<h3>Advanced Tips</h3>
<p>In deno development, our philosophy is file-oriented rather than module-oriented. Therefore, if needed, you may want to add this kind of configuration in <code>deno.json</code>:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-jsonc"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  "imports"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "@dnt-mono/module-a"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./packages/module-a/index.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "@dnt-mono/module-a/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./packages/module-a/src/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "@dnt-mono/module-b"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./packages/module-b/index.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "@dnt-mono/module-b/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./packages/module-b/src/"</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre>
<p>I prefer to put files other than <code>index.ts</code> into a <code>src</code> directory, which aligns more with the style of node projects.</p>
<blockquote>
<p>However, remember not to move the <code>index.ts</code> file to the <code>src</code> directory as well, as it could cause exceptions <a href="https://github.com/denoland/dnt/issues/249" target="_blank">#249</a>.</p>
</blockquote>
<p>Then, it's about the dnt configuration, where you need to iterate over all your files and configure them in the entryPoints:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-ts"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">build</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  entryPoints: [</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // default entry</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"."</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, path: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">packageResolve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./index.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) },</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // src files</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ALL_SRC_TS_FILES</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`./${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">name</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      path: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`./src/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">name</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
<p>Now, you can write code like this:</p>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-ts"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { xxx } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "@dnt-mono/module-a/xxx.ts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<h3>Points to Note</h3>
<ol>
<li>Plan your project structure well to avoid cyclic dependencies. If needed, you should configure peerDependencies yourself.</li>
<li>Don't self-import within a module.
<blockquote>
<p>The language server doesn't understand that you intend to publish to npm, so even if deno works correctly, your goal is to make it work with node as well.</p>
</blockquote>
<pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8" tabindex="0"><code class="language-ts"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { a } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "@dnt-mono/module-a"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// don't import module-a in module-a</span></span></code></pre>
It is advisable to write lint rules to avoid these mistakes in actual projects.</li>
</ol>
</main></div></div></div></div>
        <script id="vike_pageContext" type="application/json">{"abortReason":"!undefined","_urlRewrite":null,"_urlRedirect":"!undefined","abortStatusCode":"!undefined","_abortCall":"!undefined","_pageContextInitIsPassedToClient":"!undefined","pageId":"/pages/article/@id","routeParams":{"id":"Publishing-Your-Deno-Project-as-a-Monorepo-using-dnt"},"data":{"article":{"metadata":{"layout":"layouts/article.njk","title":"Publishing Your Deno Project as a Monorepo using dnt","date":"!Date:2024-04-27T04:40:46.724Z","updated":"!Date:2024-04-27T04:40:46.724Z","id":"Publishing-Your-Deno-Project-as-a-Monorepo-using-dnt","createdAt":"!Date:2024-04-27T04:40:46.724Z","updatedAt":"!Date:2024-04-27T04:40:46.724Z","tags":[]},"htmlContent":"\u003ch2>Publishing Your Deno Project as a Monorepo using dnt\u003c/h2>\n\u003cblockquote>\n\u003cp>Before providing theoretical guidance, let's look at how to achieve this in practice. After completion, I will explain the advantages of this project management solution.\u003c/p>\n\u003c/blockquote>\n\u003ch3>Tools\u003c/h3>\n\u003col>\n\u003cli>\u003ca href=\"https://deno.com/\" target=\"_blank\">deno\u003c/a>\u003c/li>\n\u003cli>\u003ca href=\"https://pnpm.io/installation\" target=\"_blank\">pnpm\u003c/a>\u003c/li>\n\u003c/ol>\n\u003ch3>Preparation\u003c/h3>\n\u003col>\n\u003cli>\n\u003cp>Create your project:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">deno\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> init\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> dnt-mono\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"># cd dnt-mono\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"># code . # open in ide\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>Initialize a git repository\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">git\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> init\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"npm\\nnode_modules\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> .gitignore\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> # ignore the npm folder\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>Initialize package.json, and other files typically required by npm/pnpm\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">npm\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> init\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --yes\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --private\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> # create a package.json file\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"MIT\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> LICENSE\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"# Hello Dnt ❤️ Monorepo\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> README.md\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"packages:\\n  - \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\\"\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">npm/*\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\\"\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> pnpm-workspace.yaml\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>Prepare the dnt script\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">deno\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> add\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> @deno/dnt\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003cp>Refer to \u003ca href=\"https://github.com/denoland/dnt?tab=readme-ov-file#setup\" target=\"_blank\">Setup\u003c/a>, as we need to build multiple npm packages, create the \u003ccode>scripts/npmBuilder.ts\u003c/code> file:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-ts\">\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { build, BuildOptions, emptyDir } \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"@deno/dnt\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> fs \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"node:fs\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> path \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"node:path\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { fileURLToPath } \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"node:url\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">const\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> rootDir\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">meta\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">resolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"../\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">);\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">const\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> rootResolve\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (\u003c/span>\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">path\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">:\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=>\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> fileURLToPath\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">new\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> URL\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(path, rootDir));\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">export\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> const\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> npmBuilder\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> async\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (\u003c/span>\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">config\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">:\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  packageDir\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">:\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  version\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">?:\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  importMap\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">?:\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  options\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">?:\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> Partial\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">&#x3C;\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">BuildOptions\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">>;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}) \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=>\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">packageDir\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">version\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">importMap\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">options\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> } \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> config;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> packageResolve\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (\u003c/span>\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">path\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">:\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=>\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">    fileURLToPath\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">new\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> URL\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(path, packageDir));\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> packageJson\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> JSON\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">parse\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    fs.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">readFileSync\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">packageResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./package.json\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">), \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"utf-8\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">)\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  );\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">  // remove some field which dnt will create. if you known how dnt work, you can keep them.\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  delete\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> packageJson.main;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  delete\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> packageJson.module;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  delete\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> packageJson.exports;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  console.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">log\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\n\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">start dnt: ${\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">packageJson\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">.\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">name\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">);\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> npmDir\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> rootResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`./npm/${\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">packageJson\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">.\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">name\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">split\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"/\"\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">).\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">pop\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">()\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">);\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> npmResolve\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (\u003c/span>\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">p\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">:\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=>\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> path.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">resolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(npmDir, p);\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  await\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> emptyDir\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(npmDir);\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  if\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (version) {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    Object.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">assign\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(packageJson, { version: version });\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  await\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> build\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">({\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    entryPoints: [{ name: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\".\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, path: \u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">packageResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./index.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) }],\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    outDir: npmDir,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    packageManager: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"pnpm\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    shims: {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      deno: \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">true\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    },\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">    // you should open it in actual\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    test: \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">false\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    importMap: importMap,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    package: packageJson,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">    // custom by yourself\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    compilerOptions: {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      lib: [\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"DOM\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"ES2022\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">],\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      target: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"ES2022\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      emitDecoratorMetadata: \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">true\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    },\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">    postBuild\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">() {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">      // steps to run after building and before running the tests\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      Deno.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">copyFileSync\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">rootResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./LICENSE\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">), \u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">npmResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./LICENSE\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">));\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      Deno.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">copyFileSync\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">        packageResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./README.md\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">),\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">        npmResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./README.md\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">)\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      );\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    },\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">    ...\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">options,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  });\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">};\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003c/ol>\n\u003ch3>Main Steps\u003c/h3>\n\u003col>\n\u003cli>\n\u003cp>Create two subfolders and add some project files\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"># start from root\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">mkdir\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> packages/module-a\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">cd\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> packages/module-a\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"export const a = 1;\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> index.ts\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"# @dnt-mono/module-a\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> README.md\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">npm\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> init\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --scope\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> @dnt-mono\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --yes\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> # name: @dnt-mono/module-a\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003cp>Repeat the steps to create a \u003ccode>module-b\u003c/code> folder\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"># start from root\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">mkdir\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> packages/module-b\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">cd\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> packages/module-b\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"import { a } from \u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\\"\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">@dnt-mono/module-a\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\\"\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">;\\nexport const b = a + 1;\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> index.ts\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">echo\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"# @dnt-mono/module-b\"\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> README.md\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">npm\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> init\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --scope\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> @dnt-mono\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --yes\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> # name: @dnt-mono/module-b\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">pnpm\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> add\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> @dnt-mono/module-a\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --workspace\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> # add module-a as a dependency\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>In this example, \u003ccode>module-b\u003c/code> depends on \u003ccode>module-a\u003c/code>, and we used the specifier \u003ccode>@dnt-mono/module-a\u003c/code> in the code, so we need some configurations to make the deno language server work correctly. In the \u003ccode>imports\u003c/code> field of \u003ccode>deno.json\u003c/code>, add these configurations:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-jsonc\">\u003cspan class=\"line\">\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"@dnt-mono/module-a\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./packages/module-a/index.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">// in imports\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"@dnt-mono/module-b\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./packages/module-b/index.ts\"\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> // in imports\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>Next, create the build script and configuration files\u003c/p>\n\u003col>\n\u003cli>\n\u003cp>\u003ccode>scripts/build_npm.ts\u003c/code>\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-ts\">\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { npmBuilder } \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"./npmBuilder.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">const\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> version\u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> Deno.args[\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">0\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">];\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">await\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> npmBuilder\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">({\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  packageDir: \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">meta\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">resolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"../packages/module-a/\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">),\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  importMap: \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">meta\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">resolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./import_map.npm.json\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">),\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  version,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">});\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">await\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> npmBuilder\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">({\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  packageDir: \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">meta\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">resolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"../packages/module-b/\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">),\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  importMap: \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">meta\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">resolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./import_map.npm.json\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">),\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  version,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">});\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>\u003ccode>scripts/import_map.npm.json\u003c/code>\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-json\">\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">{\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">  \"imports\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"@dnt-mono/module-a\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"npm:@dnt-mono/module-a\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"@dnt-mono/module-b\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"npm:@dnt-mono/module-b\"\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003c/ol>\n\u003c/li>\n\u003cli>\n\u003cp>Then, in your \u003ccode>deno.json\u003c/code>, configure the build command:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-jsonc\">\u003cspan class=\"line\">\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"build\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"deno run -A ./scripts/build_npm.ts\"\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> // in tasks\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003cli>\n\u003cp>Finally, try executing the build command to create the npm directory\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">deno\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> task\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> build\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003cp>Now, you should see the npm directory has been populated with the module-a and module-b folders ready for npm publishing.\nYou can try to publish these npm packages:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-shell\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">pnpm\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> publish\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> -r\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --no-git-checks\u003c/span>\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> --dry-run\u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\"> # you should remove --dry-run for an actual run\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003c/li>\n\u003c/ol>\n\u003ch3>How It Works\u003c/h3>\n\u003col>\n\u003cli>We use deno as the language server, which is quite powerful, vastly improved from tsc itself through customized development.\u003c/li>\n\u003cli>So here, the package.json is just a &quot;template file&quot; and not a configuration file. The only configuration file that goes into effect during development is deno.json.\u003c/li>\n\u003cli>Hence, pnpm is just a tool for the final output built by dnt, meaning it only serves the \u003ccode>npm/*\u003c/code> directory. This is also why \u003ccode>pnpm-workspaces.yaml\u003c/code> is configured as it is.\u003c/li>\n\u003cli>The \u003ccode>import_map.npm.json\u003c/code> used in dnt is essential. We can't use \u003ccode>deno.json\u003c/code> directly as \u003ccode>importMap\u003c/code> because \u003ccode>deno.json\u003c/code> is configured for the deno language server, while \u003ccode>import_map.npm.json\u003c/code> is for dnt/pnpm use. In complex projects, it's advisable to manage it automatically with a script.\u003c/li>\n\u003c/ol>\n\u003ch3>Advanced Tips\u003c/h3>\n\u003cp>In deno development, our philosophy is file-oriented rather than module-oriented. Therefore, if needed, you may want to add this kind of configuration in \u003ccode>deno.json\u003c/code>:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-jsonc\">\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">{\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">  // ...\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">  \"imports\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: {\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">    // ...\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"@dnt-mono/module-a\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./packages/module-a/index.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"@dnt-mono/module-a/\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./packages/module-a/src/\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"@dnt-mono/module-b\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./packages/module-b/index.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"@dnt-mono/module-b/\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./packages/module-b/src/\"\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">    // ...\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003cp>I prefer to put files other than \u003ccode>index.ts\u003c/code> into a \u003ccode>src\u003c/code> directory, which aligns more with the style of node projects.\u003c/p>\n\u003cblockquote>\n\u003cp>However, remember not to move the \u003ccode>index.ts\u003c/code> file to the \u003ccode>src\u003c/code> directory as well, as it could cause exceptions \u003ca href=\"https://github.com/denoland/dnt/issues/249\" target=\"_blank\">#249\u003c/a>.\u003c/p>\n\u003c/blockquote>\n\u003cp>Then, it's about the dnt configuration, where you need to iterate over all your files and configure them in the entryPoints:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-ts\">\u003cspan class=\"line\">\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">build\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">({\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  entryPoints: [\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">    // default entry\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    { name: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\".\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, path: \u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">packageResolve\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"./index.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) },\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">    // src files\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    ALL_SRC_TS_FILES\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">.\u003c/span>\u003cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">map\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">((\u003c/span>\u003cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">name\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=>\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> ({\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      name: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`./${\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">name\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      path: \u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`./src/${\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">name\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    })),\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  ],\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">  // ...\u003c/span>\u003c/span>\n\u003cspan class=\"line\">\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">});\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003cp>Now, you can write code like this:\u003c/p>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-ts\">\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { xxx } \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"@dnt-mono/module-a/xxx.ts\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\n\u003ch3>Points to Note\u003c/h3>\n\u003col>\n\u003cli>Plan your project structure well to avoid cyclic dependencies. If needed, you should configure peerDependencies yourself.\u003c/li>\n\u003cli>Don't self-import within a module.\n\u003cblockquote>\n\u003cp>The language server doesn't understand that you intend to publish to npm, so even if deno works correctly, your goal is to make it work with node as well.\u003c/p>\n\u003c/blockquote>\n\u003cpre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\">\u003ccode class=\"language-ts\">\u003cspan class=\"line\">\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">import\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { a } \u003c/span>\u003cspan style=\"color:#D73A49;--shiki-dark:#F97583\">from\u003c/span>\u003cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> \"@dnt-mono/module-a\"\u003c/span>\u003cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">; \u003c/span>\u003cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">// don't import module-a in module-a\u003c/span>\u003c/span>\u003c/code>\u003c/pre>\nIt is advisable to write lint rules to avoid these mistakes in actual projects.\u003c/li>\n\u003c/ol>\n","markdownContent":"\n## Publishing Your Deno Project as a Monorepo using dnt\n\n> Before providing theoretical guidance, let's look at how to achieve this in practice. After completion, I will explain the advantages of this project management solution.\n\n### Tools\n\n1. [deno](https://deno.com/)\n2. [pnpm](https://pnpm.io/installation)\n\n### Preparation\n\n1. Create your project:\n   ```shell\n   deno init dnt-mono\n   # cd dnt-mono\n   # code . # open in ide\n   ```\n2. Initialize a git repository\n   ```shell\n   git init\n   echo \"npm\\nnode_modules\" > .gitignore # ignore the npm folder\n   ```\n3. Initialize package.json, and other files typically required by npm/pnpm\n   ```shell\n   npm init --yes --private # create a package.json file\n   echo \"MIT\" > LICENSE\n   echo \"# Hello Dnt ❤️ Monorepo\" > README.md\n   echo \"packages:\\n  - \\\"npm/*\\\"\" > pnpm-workspace.yaml\n   ```\n4. Prepare the dnt script\n\n   ```shell\n   deno add @deno/dnt\n   ```\n\n   Refer to [Setup](https://github.com/denoland/dnt?tab=readme-ov-file#setup), as we need to build multiple npm packages, create the `scripts/npmBuilder.ts` file:\n\n   ```ts\n   import { build, BuildOptions, emptyDir } from \"@deno/dnt\";\n   import fs from \"node:fs\";\n   import path from \"node:path\";\n   import { fileURLToPath } from \"node:url\";\n\n   const rootDir = import.meta.resolve(\"../\");\n   const rootResolve = (path: string) => fileURLToPath(new URL(path, rootDir));\n   export const npmBuilder = async (config: {\n     packageDir: string;\n     version?: string;\n     importMap?: string;\n     options?: Partial\u003cBuildOptions>;\n   }) => {\n     const { packageDir, version, importMap, options } = config;\n     const packageResolve = (path: string) =>\n       fileURLToPath(new URL(path, packageDir));\n     const packageJson = JSON.parse(\n       fs.readFileSync(packageResolve(\"./package.json\"), \"utf-8\")\n     );\n     // remove some field which dnt will create. if you known how dnt work, you can keep them.\n     delete packageJson.main;\n     delete packageJson.module;\n     delete packageJson.exports;\n\n     console.log(`\\nstart dnt: ${packageJson.name}`);\n\n     const npmDir = rootResolve(`./npm/${packageJson.name.split(\"/\").pop()}`);\n     const npmResolve = (p: string) => path.resolve(npmDir, p);\n\n     await emptyDir(npmDir);\n\n     if (version) {\n       Object.assign(packageJson, { version: version });\n     }\n\n     await build({\n       entryPoints: [{ name: \".\", path: packageResolve(\"./index.ts\") }],\n       outDir: npmDir,\n       packageManager: \"pnpm\",\n       shims: {\n         deno: true,\n       },\n       // you should open it in actual\n       test: false,\n       importMap: importMap,\n       package: packageJson,\n       // custom by yourself\n       compilerOptions: {\n         lib: [\"DOM\", \"ES2022\"],\n         target: \"ES2022\",\n         emitDecoratorMetadata: true,\n       },\n       postBuild() {\n         // steps to run after building and before running the tests\n         Deno.copyFileSync(rootResolve(\"./LICENSE\"), npmResolve(\"./LICENSE\"));\n         Deno.copyFileSync(\n           packageResolve(\"./README.md\"),\n           npmResolve(\"./README.md\")\n         );\n       },\n       ...options,\n     });\n   };\n   ```\n\n### Main Steps\n\n1. Create two subfolders and add some project files\n\n   ```shell\n   # start from root\n   mkdir packages/module-a\n   cd packages/module-a\n   echo \"export const a = 1;\" > index.ts\n   echo \"# @dnt-mono/module-a\" > README.md\n   npm init --scope @dnt-mono --yes # name: @dnt-mono/module-a\n   ```\n\n   Repeat the steps to create a `module-b` folder\n\n   ```shell\n   # start from root\n   mkdir packages/module-b\n   cd packages/module-b\n   echo \"import { a } from \\\"@dnt-mono/module-a\\\";\\nexport const b = a + 1;\" > index.ts\n   echo \"# @dnt-mono/module-b\" > README.md\n   npm init --scope @dnt-mono --yes # name: @dnt-mono/module-b\n\n   pnpm add @dnt-mono/module-a --workspace # add module-a as a dependency\n   ```\n\n2. In this example, `module-b` depends on `module-a`, and we used the specifier `@dnt-mono/module-a` in the code, so we need some configurations to make the deno language server work correctly. In the `imports` field of `deno.json`, add these configurations:\n\n   ```jsonc\n    \"@dnt-mono/module-a\": \"./packages/module-a/index.ts\", // in imports\n    \"@dnt-mono/module-b\": \"./packages/module-b/index.ts\" // in imports\n   ```\n\n3. Next, create the build script and configuration files\n\n   1. `scripts/build_npm.ts`\n\n      ```ts\n      import { npmBuilder } from \"./npmBuilder.ts\";\n\n      const version = Deno.args[0];\n      await npmBuilder({\n        packageDir: import.meta.resolve(\"../packages/module-a/\"),\n        importMap: import.meta.resolve(\"./import_map.npm.json\"),\n        version,\n      });\n      await npmBuilder({\n        packageDir: import.meta.resolve(\"../packages/module-b/\"),\n        importMap: import.meta.resolve(\"./import_map.npm.json\"),\n        version,\n      });\n      ```\n\n   2. `scripts/import_map.npm.json`\n\n      ```json\n      {\n        \"imports\": {\n          \"@dnt-mono/module-a\": \"npm:@dnt-mono/module-a\",\n          \"@dnt-mono/module-b\": \"npm:@dnt-mono/module-b\"\n        }\n      }\n      ```\n\n4. Then, in your `deno.json`, configure the build command:\n\n   ```jsonc\n   \"build\": \"deno run -A ./scripts/build_npm.ts\" // in tasks\n   ```\n\n5. Finally, try executing the build command to create the npm directory\n   ```shell\n   deno task build\n   ```\n   Now, you should see the npm directory has been populated with the module-a and module-b folders ready for npm publishing.\n   You can try to publish these npm packages:\n   ```shell\n   pnpm publish -r --no-git-checks --dry-run # you should remove --dry-run for an actual run\n   ```\n\n### How It Works\n\n1. We use deno as the language server, which is quite powerful, vastly improved from tsc itself through customized development.\n2. So here, the package.json is just a \"template file\" and not a configuration file. The only configuration file that goes into effect during development is deno.json.\n3. Hence, pnpm is just a tool for the final output built by dnt, meaning it only serves the `npm/*` directory. This is also why `pnpm-workspaces.yaml` is configured as it is.\n4. The `import_map.npm.json` used in dnt is essential. We can't use `deno.json` directly as `importMap` because `deno.json` is configured for the deno language server, while `import_map.npm.json` is for dnt/pnpm use. In complex projects, it's advisable to manage it automatically with a script.\n\n### Advanced Tips\n\nIn deno development, our philosophy is file-oriented rather than module-oriented. Therefore, if needed, you may want to add this kind of configuration in `deno.json`:\n\n```jsonc\n{\n  // ...\n  \"imports\": {\n    // ...\n    \"@dnt-mono/module-a\": \"./packages/module-a/index.ts\",\n    \"@dnt-mono/module-a/\": \"./packages/module-a/src/\",\n    \"@dnt-mono/module-b\": \"./packages/module-b/index.ts\",\n    \"@dnt-mono/module-b/\": \"./packages/module-b/src/\"\n    // ...\n  }\n}\n```\n\nI prefer to put files other than `index.ts` into a `src` directory, which aligns more with the style of node projects.\n\n> However, remember not to move the `index.ts` file to the `src` directory as well, as it could cause exceptions [#249](https://github.com/denoland/dnt/issues/249).\n\nThen, it's about the dnt configuration, where you need to iterate over all your files and configure them in the entryPoints:\n\n```ts\nbuild({\n  entryPoints: [\n    // default entry\n    { name: \".\", path: packageResolve(\"./index.ts\") },\n    // src files\n    ALL_SRC_TS_FILES.map((name) => ({\n      name: `./${name}`,\n      path: `./src/${name}`,\n    })),\n  ],\n  // ...\n});\n```\n\nNow, you can write code like this:\n\n```ts\nimport { xxx } from \"@dnt-mono/module-a/xxx.ts\";\n```\n\n### Points to Note\n\n1. Plan your project structure well to avoid cyclic dependencies. If needed, you should configure peerDependencies yourself.\n2. Don't self-import within a module.\n   > The language server doesn't understand that you intend to publish to npm, so even if deno works correctly, your goal is to make it work with node as well.\n   ```ts\n   import { a } from \"@dnt-mono/module-a\"; // don't import module-a in module-a\n   ```\n   It is advisable to write lint rules to avoid these mistakes in actual projects.\n"}}}</script>
        <script src="/assets/entries/entry-client-routing.BGuB9iqG.js" type="module" async></script>
        <link rel="modulepreload" href="/assets/entries/pages_article_-id.BCFv3ZOD.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/assets/chunks/chunk-Z1L0Yy9g.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/assets/chunks/chunk-DpeCXkLi.js" as="script" type="text/javascript">
      </body>
    </html>