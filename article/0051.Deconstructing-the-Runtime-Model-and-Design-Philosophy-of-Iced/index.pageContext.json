{"abortReason":"!undefined","_urlRewrite":null,"_urlRedirect":"!undefined","abortStatusCode":"!undefined","_abortCall":"!undefined","_pageContextInitIsPassedToClient":"!undefined","pageId":"/pages/article/@id","routeParams":{"id":"0051.Deconstructing-the-Runtime-Model-and-Design-Philosophy-of-Iced"},"data":{"article":{"fileEntry":{"path":"/home/runner/work/gaubee.com/gaubee.com/articles/0051.Deconstructing-the-Runtime-Model-and-Design-Philosophy-of-Iced.mdx","options":{"cwd":"/home/runner/work/gaubee.com/gaubee.com/articles"},"isFile":true,"isDirectory":false},"originMetadata":{"title":"简单解构 Iced 运行时模型与设计哲学","date":"!Date:2025-03-18T02:39:50.659Z","tags":["rust","iced","gui"],"updated":"!Date:2025-03-19T03:58:41.753Z"},"metadata":{"title":"简单解构 Iced 运行时模型与设计哲学","date":"!Date:2025-03-18T02:39:50.659Z","tags":["rust","iced","gui"],"updated":"!Date:2025-03-19T03:58:41.753Z","id":"0051.Deconstructing-the-Runtime-Model-and-Design-Philosophy-of-Iced","createdAt":"!Date:2025-03-18T02:39:50.659Z","updatedAt":"!Date:2025-03-19T03:58:41.753Z"},"htmlContent":"<html><head><blockquote>\n<p>参考入门视频：</p>\n<div id=\"video-player\"></div>\n</blockquote>\n<h2>1. 架构总览：消息驱动的响应式系统</h2>\n<p>Iced 的核心架构遵循经典的 Elm 模式，其运行时模型可抽象为三个核心要素：\n• <strong>状态容器</strong>：承载当前应用数据的不可变结构体\n• <strong>消息管道</strong>：用户交互与系统事件的中继处理器\n• <strong>渲染引擎</strong>：基于状态变更的视图同步器</p>\n</head><body><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"0 0 990.5625 164\" style=\"max-width:990.5625px\" class=\"flowchart\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mmd-02acdf-0\"><g><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-02acdf-0_flowchart-v2-pointEnd\"><path style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-02acdf-0_flowchart-v2-pointStart\"><path style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-02acdf-0_flowchart-v2-circleEnd\"><circle style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-02acdf-0_flowchart-v2-circleStart\"><circle style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mmd-02acdf-0_flowchart-v2-crossEnd\"><path style=\"stroke-width:2;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mmd-02acdf-0_flowchart-v2-crossStart\"><path style=\"stroke-width:2;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"></g><g class=\"edgePaths\"><path marker-end=\"url(#mmd-02acdf-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_S_V_0\" d=\"M100,52.155L109.5,49.296C119,46.437,138,40.718,156.333,37.859C174.667,35,192.333,35,201.167,35L210,35\"></path><path marker-end=\"url(#mmd-02acdf-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_V_M_0\" d=\"M307.703,35L317.203,35C326.703,35,345.703,35,364.036,35C382.37,35,400.036,35,408.87,35L417.703,35\"></path><path marker-end=\"url(#mmd-02acdf-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_M_U_0\" d=\"M537.688,35L547.188,35C556.688,35,575.688,35,594.046,37.494C612.404,39.988,630.121,44.976,638.979,47.471L647.837,49.965\"></path><path marker-end=\"url(#mmd-02acdf-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_U_S_0\" d=\"M651.688,80.951L642.188,83.626C632.688,86.301,613.688,91.65,585.022,94.325C556.357,97,518.026,97,479.695,97C441.365,97,403.034,97,366.56,97C330.086,97,295.469,97,260.852,97C226.234,97,191.617,97,165.447,94.333C139.277,91.666,121.554,86.332,112.692,83.665L103.83,80.997\"></path><path marker-end=\"url(#mmd-02acdf-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_U_C_0\" d=\"M757.891,66L766.057,66C774.224,66,790.557,66,806.257,68.481C821.958,70.963,837.024,75.925,844.558,78.406L852.091,80.888\"></path><path marker-end=\"url(#mmd-02acdf-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_M_0\" d=\"M855.891,126.116L847.724,129.097C839.557,132.077,823.224,138.039,798.04,141.019C772.857,144,738.823,144,703.456,144C668.089,144,631.388,144,599.104,130.792C566.819,117.584,538.951,91.168,525.017,77.96L511.083,64.752\"></path></g><g class=\"edgeLabels\"><g transform=\"translate(157, 35)\" class=\"edgeLabel\"><g transform=\"translate(-32, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>状态快照</p></span></div></foreignObject></g></g><g transform=\"translate(364.703125, 35)\" class=\"edgeLabel\"><g transform=\"translate(-32, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>用户交互</p></span></div></foreignObject></g></g><g transform=\"translate(594.6875, 35)\" class=\"edgeLabel\"><g transform=\"translate(-32, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>事件路由</p></span></div></foreignObject></g></g><g transform=\"translate(364.703125, 97)\" class=\"edgeLabel\"><g transform=\"translate(-32, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>状态变更</p></span></div></foreignObject></g></g><g transform=\"translate(806.890625, 66)\" class=\"edgeLabel\"><g transform=\"translate(-24, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"48\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>副作用</p></span></div></foreignObject></g></g><g transform=\"translate(704.7890625, 144)\" class=\"edgeLabel\"><g transform=\"translate(-32, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>异步任务</p></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(54, 66)\" id=\"flowchart-S-0\" class=\"node default\"><rect height=\"54\" width=\"92\" y=\"-27\" x=\"-46\" class=\"basic label-container\"></rect><g transform=\"translate(-16, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"32\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>State</p></span></div></foreignObject></g></g><g transform=\"translate(260.8515625, 35)\" id=\"flowchart-V-1\" class=\"node default\"><rect height=\"54\" width=\"93.703125\" y=\"-27\" x=\"-46.8515625\" class=\"basic label-container\"></rect><g transform=\"translate(-16.8515625, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"33.703125\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>View</p></span></div></foreignObject></g></g><g transform=\"translate(479.6953125, 35)\" id=\"flowchart-M-3\" class=\"node default\"><rect height=\"54\" width=\"115.984375\" y=\"-27\" x=\"-57.9921875\" class=\"basic label-container\"></rect><g transform=\"translate(-27.9921875, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"55.984375\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>Message</p></span></div></foreignObject></g></g><g transform=\"translate(704.7890625, 66)\" id=\"flowchart-U-5\" class=\"node default\"><rect height=\"54\" width=\"106.203125\" y=\"-27\" x=\"-53.1015625\" class=\"basic label-container\"></rect><g transform=\"translate(-23.1015625, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"46.203125\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>Update</p></span></div></foreignObject></g></g><g transform=\"translate(919.2265625, 103)\" id=\"flowchart-C-9\" class=\"node default\"><rect height=\"54\" width=\"126.671875\" y=\"-27\" x=\"-63.3359375\" class=\"basic label-container\"></rect><g transform=\"translate(-33.3359375, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"66.671875\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>Command</p></span></div></foreignObject></g></g></g></g></g></svg>\n<p>这种架构实现了严格的单向数据流，使得状态变更具有可预测性。特别值得注意的是，视图层不直接修改状态，而是通过消息管道间接触发状态变更。</p>\n<h2>2. 状态管理的基本单元与数据流</h2>\n<p>状态容器的设计体现了最小化原则：</p>\n<ul>\n<li>纯数据结构体，无生命周期绑定</li>\n<li>每次更新生成新状态实例（非强制）</li>\n<li>变更触发条件严格受控于消息类型</li>\n</ul>\n<blockquote>\n<p><strong>Q: 为何不采用自动依赖追踪？</strong></p>\n<p>通过强制显式声明消息处理路径，实现了：</p>\n<ol>\n<li>状态变更路径显式化</li>\n<li>调试溯源能力增强</li>\n<li>渲染优化边界清晰化</li>\n</ol>\n</blockquote>\n<h2>3. 渲染循环与事件处理机制</h2>\n<p>核心处理流程包含四个阶段：</p>\n<html><head></head><body><svg aria-roledescription=\"sequence\" role=\"graphics-document document\" viewBox=\"-50 -10 861 544\" style=\"max-width:861px\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mmd-f5e9ef-0\"><g><rect class=\"actor actor-bottom\" ry=\"3\" rx=\"3\" name=\"VR\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"458\" x=\"600\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"490.5\" x=\"675\"><tspan dy=\"0\" x=\"675\">虚拟渲染器</tspan></text></g><g><rect class=\"actor actor-bottom\" ry=\"3\" rx=\"3\" name=\"UC\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"458\" x=\"400\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"490.5\" x=\"475\"><tspan dy=\"0\" x=\"475\">更新控制器</tspan></text></g><g><rect class=\"actor actor-bottom\" ry=\"3\" rx=\"3\" name=\"MQ\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"458\" x=\"200\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"490.5\" x=\"275\"><tspan dy=\"0\" x=\"275\">消息队列</tspan></text></g><g><rect class=\"actor actor-bottom\" ry=\"3\" rx=\"3\" name=\"E\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"458\" x=\"0\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"490.5\" x=\"75\"><tspan dy=\"0\" x=\"75\">事件源</tspan></text></g><g><line name=\"VR\" stroke=\"#999\" stroke-width=\"0.5px\" class=\"actor-line 200\" y2=\"458\" x2=\"675\" y1=\"65\" x1=\"675\" id=\"actor3\"></line><g id=\"root-3\"><rect class=\"actor actor-top\" ry=\"3\" rx=\"3\" name=\"VR\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"0\" x=\"600\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"32.5\" x=\"675\"><tspan dy=\"0\" x=\"675\">虚拟渲染器</tspan></text></g></g><g><line name=\"UC\" stroke=\"#999\" stroke-width=\"0.5px\" class=\"actor-line 200\" y2=\"458\" x2=\"475\" y1=\"65\" x1=\"475\" id=\"actor2\"></line><g id=\"root-2\"><rect class=\"actor actor-top\" ry=\"3\" rx=\"3\" name=\"UC\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"0\" x=\"400\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"32.5\" x=\"475\"><tspan dy=\"0\" x=\"475\">更新控制器</tspan></text></g></g><g><line name=\"MQ\" stroke=\"#999\" stroke-width=\"0.5px\" class=\"actor-line 200\" y2=\"458\" x2=\"275\" y1=\"65\" x1=\"275\" id=\"actor1\"></line><g id=\"root-1\"><rect class=\"actor actor-top\" ry=\"3\" rx=\"3\" name=\"MQ\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"0\" x=\"200\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"32.5\" x=\"275\"><tspan dy=\"0\" x=\"275\">消息队列</tspan></text></g></g><g><line name=\"E\" stroke=\"#999\" stroke-width=\"0.5px\" class=\"actor-line 200\" y2=\"458\" x2=\"75\" y1=\"65\" x1=\"75\" id=\"actor0\"></line><g id=\"root-0\"><rect class=\"actor actor-top\" ry=\"3\" rx=\"3\" name=\"E\" height=\"65\" width=\"150\" stroke=\"#666\" fill=\"#eaeaea\" y=\"0\" x=\"0\"></rect><text style=\"text-anchor:middle;font-size:12px;font-weight:400;font-family:var(--font-sans-serif)\" class=\"actor actor-box\" alignment-baseline=\"central\" dominant-baseline=\"central\" y=\"32.5\" x=\"75\"><tspan dy=\"0\" x=\"75\">事件源</tspan></text></g></g><g></g><defs><symbol height=\"24\" width=\"24\" id=\"computer\"><path d=\"M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z\" transform=\"scale(.5)\"></path></symbol></defs><defs><symbol clip-rule=\"evenodd\" fill-rule=\"evenodd\" id=\"database\"><path d=\"M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z\" transform=\"scale(.5)\"></path></symbol></defs><defs><symbol height=\"24\" width=\"24\" id=\"clock\"><path d=\"M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z\" transform=\"scale(.5)\"></path></symbol></defs><defs><marker orient=\"auto-start-reverse\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"7.9\" id=\"arrowhead\"><path d=\"M -1 0 L 10 5 L 0 10 z\"></path></marker></defs><defs><marker refY=\"4.5\" refX=\"4\" orient=\"auto\" markerHeight=\"8\" markerWidth=\"15\" id=\"crosshead\"><path style=\"stroke-dasharray:0, 0\" d=\"M 1,2 L 6,7 M 6,2 L 1,7\" stroke-width=\"1pt\" stroke=\"#000000\" fill=\"none\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"28\" markerWidth=\"20\" refY=\"7\" refX=\"15.5\" id=\"filled-head\"><path d=\"M 18,7 L9,13 L14,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"40\" markerWidth=\"60\" refY=\"15\" refX=\"15\" id=\"sequencenumber\"><circle r=\"6\" cy=\"15\" cx=\"15\"></circle></marker></defs><g><line class=\"loopLine\" y2=\"75\" x2=\"761\" y1=\"75\" x1=\"64\"></line><line class=\"loopLine\" y2=\"438\" x2=\"761\" y1=\"75\" x1=\"761\"></line><line class=\"loopLine\" y2=\"438\" x2=\"761\" y1=\"438\" x1=\"64\"></line><line class=\"loopLine\" y2=\"438\" x2=\"64\" y1=\"75\" x1=\"64\"></line><polygon class=\"labelBox\" points=\"64,75 114,75 114,88 105.6,95 64,95\"></polygon><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" class=\"labelText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"88\" x=\"89\">loop</text><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" class=\"loopText\" text-anchor=\"middle\" y=\"93\" x=\"437.5\"><tspan x=\"437.5\">[主循环]</tspan></text></g><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" dy=\"1em\" class=\"messageText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"125\" x=\"174\">事件编码为消息</text><line style=\"fill:none\" marker-end=\"url(#arrowhead)\" stroke=\"none\" stroke-width=\"2\" class=\"messageLine0\" y2=\"148\" x2=\"271\" y1=\"148\" x1=\"76\"></line><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" dy=\"1em\" class=\"messageText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"163\" x=\"374\">消息派发</text><line style=\"fill:none\" marker-end=\"url(#arrowhead)\" stroke=\"none\" stroke-width=\"2\" class=\"messageLine0\" y2=\"186\" x2=\"471\" y1=\"186\" x1=\"276\"></line><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" dy=\"1em\" class=\"messageText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"201\" x=\"476\">状态变更</text><path style=\"fill:none\" marker-end=\"url(#arrowhead)\" stroke=\"none\" stroke-width=\"2\" class=\"messageLine0\" d=\"M 476,224 C 536,214 536,254 476,244\"></path><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" dy=\"1em\" class=\"messageText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"269\" x=\"377\">生成副作用命令</text><line style=\"fill:none\" marker-end=\"url(#arrowhead)\" stroke=\"none\" stroke-width=\"2\" class=\"messageLine0\" y2=\"292\" x2=\"279\" y1=\"292\" x1=\"474\"></line><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" dy=\"1em\" class=\"messageText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"307\" x=\"574\">触发差异比对</text><line style=\"fill:none\" marker-end=\"url(#arrowhead)\" stroke=\"none\" stroke-width=\"2\" class=\"messageLine0\" y2=\"330\" x2=\"671\" y1=\"330\" x1=\"476\"></line><text style=\"font-family:var(--font-sans-serif);font-size:12px;font-weight:400\" dy=\"1em\" class=\"messageText\" alignment-baseline=\"middle\" dominant-baseline=\"middle\" text-anchor=\"middle\" y=\"345\" x=\"676\">最小化DOM更新</text><path style=\"fill:none\" marker-end=\"url(#arrowhead)\" stroke=\"none\" stroke-width=\"2\" class=\"messageLine0\" d=\"M 676,368 C 736,358 736,398 676,388\"></path></svg>\n<blockquote>\n<p><strong>Q: 视图更新是立即生效的吗？</strong></p>\n<p>更新流程遵循&quot;批处理优先&quot;原则：</p>\n<ol>\n<li>同步操作立即更新状态并触发渲染</li>\n<li>异步操作将任务移交运行时</li>\n<li>视图层在每帧渲染前同步最新状态</li>\n</ol>\n</blockquote>\n<h2>4. 异步任务处理与并发模型</h2>\n<p>命令(Command)系统实现了副作用隔离机制：</p>\n<html><head></head><body><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"0 0 820 198\" style=\"max-width:820px\" class=\"flowchart\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mmd-32745f-0\"><g><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-32745f-0_flowchart-v2-pointEnd\"><path style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-32745f-0_flowchart-v2-pointStart\"><path style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-32745f-0_flowchart-v2-circleEnd\"><circle style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-32745f-0_flowchart-v2-circleStart\"><circle style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mmd-32745f-0_flowchart-v2-crossEnd\"><path style=\"stroke-width:2;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mmd-32745f-0_flowchart-v2-crossStart\"><path style=\"stroke-width:2;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"></g><g class=\"edgePaths\"><path marker-end=\"url(#mmd-32745f-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_N_0\" d=\"M338.664,46.922L292.553,55.602C246.443,64.281,154.221,81.641,108.111,95.82C62,110,62,121,62,126.5L62,132\"></path><path marker-end=\"url(#mmd-32745f-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_A_0\" d=\"M338.664,58.296L320.22,65.08C301.776,71.864,264.888,85.432,246.444,97.716C228,110,228,121,228,126.5L228,132\"></path><path marker-end=\"url(#mmd-32745f-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_B_0\" d=\"M402,62L402,68.167C402,74.333,402,86.667,402,98.333C402,110,402,121,402,126.5L402,132\"></path><path marker-end=\"url(#mmd-32745f-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_S_0\" d=\"M465.336,59.419L482.447,66.016C499.557,72.612,533.779,85.806,550.889,97.903C568,110,568,121,568,126.5L568,132\"></path><path marker-end=\"url(#mmd-32745f-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_K_0\" d=\"M465.336,46.922L511.447,55.602C557.557,64.281,649.779,81.641,695.889,95.82C742,110,742,121,742,126.5L742,132\"></path></g><g class=\"edgeLabels\"><g transform=\"translate(62, 99)\" class=\"edgeLabel\"><g transform=\"translate(-15.5546875, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"31.109375\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>none</p></span></div></foreignObject></g></g><g transform=\"translate(228, 99)\" class=\"edgeLabel\"><g transform=\"translate(-25.765625, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"51.53125\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>perform</p></span></div></foreignObject></g></g><g transform=\"translate(402, 99)\" class=\"edgeLabel\"><g transform=\"translate(-17.328125, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"34.65625\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>batch</p></span></div></foreignObject></g></g><g transform=\"translate(568, 99)\" class=\"edgeLabel\"><g transform=\"translate(-21.328125, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"42.65625\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>stream</p></span></div></foreignObject></g></g><g transform=\"translate(742, 99)\" class=\"edgeLabel\"><g transform=\"translate(-29.765625, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"59.53125\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>abortable</p></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(402, 35)\" id=\"flowchart-C-0\" class=\"node default\"><rect height=\"54\" width=\"126.671875\" y=\"-27\" x=\"-63.3359375\" class=\"basic label-container\"></rect><g transform=\"translate(-33.3359375, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"66.671875\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>Command</p></span></div></foreignObject></g></g><g transform=\"translate(62, 163)\" id=\"flowchart-N-1\" class=\"node default\"><rect height=\"54\" width=\"108\" y=\"-27\" x=\"-54\" class=\"basic label-container\"></rect><g transform=\"translate(-24, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"48\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>空操作</p></span></div></foreignObject></g></g><g transform=\"translate(228, 163)\" id=\"flowchart-A-3\" class=\"node default\"><rect height=\"54\" width=\"124\" y=\"-27\" x=\"-62\" class=\"basic label-container\"></rect><g transform=\"translate(-32, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>异步任务</p></span></div></foreignObject></g></g><g transform=\"translate(402, 163)\" id=\"flowchart-B-5\" class=\"node default\"><rect height=\"54\" width=\"124\" y=\"-27\" x=\"-62\" class=\"basic label-container\"></rect><g transform=\"translate(-32, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>命令集合</p></span></div></foreignObject></g></g><g transform=\"translate(568, 163)\" id=\"flowchart-S-7\" class=\"node default\"><rect height=\"54\" width=\"108\" y=\"-27\" x=\"-54\" class=\"basic label-container\"></rect><g transform=\"translate(-24, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"48\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>事件流</p></span></div></foreignObject></g></g><g transform=\"translate(742, 163)\" id=\"flowchart-K-9\" class=\"node default\"><rect height=\"54\" width=\"140\" y=\"-27\" x=\"-70\" class=\"basic label-container\"></rect><g transform=\"translate(-40, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"80\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>可终止任务</p></span></div></foreignObject></g></g></g></g></g></svg>\n<blockquote>\n<p><strong>Q: 长时间异步任务会阻塞界面吗？</strong></p>\n<p>通过任务调度器的分级策略：</p>\n<ul>\n<li>I/O 密集型：移交线程池</li>\n<li>UI 密集型：主线程优先</li>\n<li>定时任务：时间切片处理</li>\n</ul>\n</blockquote>\n<p>典型处理流程：</p>\n<html><head></head><body><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"0 0 880.640625 105\" style=\"max-width:880.640625px\" class=\"flowchart\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mmd-b8ee69-0\"><g><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-b8ee69-0_flowchart-v2-pointEnd\"><path style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-b8ee69-0_flowchart-v2-pointStart\"><path style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-b8ee69-0_flowchart-v2-circleEnd\"><circle style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mmd-b8ee69-0_flowchart-v2-circleStart\"><circle style=\"stroke-width:1;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mmd-b8ee69-0_flowchart-v2-crossEnd\"><path style=\"stroke-width:2;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mmd-b8ee69-0_flowchart-v2-crossStart\"><path style=\"stroke-width:2;stroke-dasharray:1, 0\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"></g><g class=\"edgePaths\"><path marker-end=\"url(#mmd-b8ee69-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_U_C_0\" d=\"M132,43.908L136.167,42.423C140.333,40.939,148.667,37.969,156.333,36.485C164,35,171,35,174.5,35L178,35\"></path><path marker-end=\"url(#mmd-b8ee69-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_T_0\" d=\"M371.766,35L379.34,35C386.914,35,402.063,35,416.544,35C431.026,35,444.841,35,451.749,35L458.656,35\"></path><path marker-end=\"url(#mmd-b8ee69-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_T_M_0\" d=\"M603.547,35L610.38,35C617.214,35,630.88,35,643.897,36.425C656.914,37.849,669.282,40.699,675.465,42.124L681.649,43.548\"></path><path marker-end=\"url(#mmd-b8ee69-0_flowchart-v2-pointEnd)\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_M_U_0\" d=\"M685.547,87.553L678.714,89.128C671.88,90.702,658.214,93.851,632.806,95.426C607.398,97,570.25,97,532.361,97C494.471,97,455.841,97,413.138,97C370.435,97,323.659,97,280.29,97C236.922,97,196.961,97,173.442,95.739C149.923,94.478,142.845,91.956,139.307,90.695L135.768,89.435\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g transform=\"translate(417.2109375, 35)\" class=\"edgeLabel\"><g transform=\"translate(-20.4453125, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"40.890625\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>spawn</p></span></div></foreignObject></g></g><g transform=\"translate(644.546875, 35)\" class=\"edgeLabel\"><g transform=\"translate(-16, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"32\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>完成</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(70, 66)\" id=\"flowchart-U-0\" class=\"node default\"><rect height=\"54\" width=\"124\" y=\"-27\" x=\"-62\" class=\"basic label-container\"></rect><g transform=\"translate(-32, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"64\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>更新状态</p></span></div></foreignObject></g></g><g transform=\"translate(276.8828125, 35)\" id=\"flowchart-C-1\" class=\"node default\"><rect height=\"54\" width=\"189.765625\" y=\"-27\" x=\"-94.8828125\" class=\"basic label-container\"></rect><g transform=\"translate(-64.8828125, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"129.765625\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>生成SaveCommand</p></span></div></foreignObject></g></g><g transform=\"translate(533.1015625, 35)\" id=\"flowchart-T-3\" class=\"node default\"><rect height=\"54\" width=\"140.890625\" y=\"-27\" x=\"-70.4453125\" class=\"basic label-container\"></rect><g transform=\"translate(-40.4453125, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"80.890625\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>文件IO线程</p></span></div></foreignObject></g></g><g transform=\"translate(779.09375, 66)\" id=\"flowchart-M-5\" class=\"node default\"><rect height=\"54\" width=\"187.09375\" y=\"-27\" x=\"-93.546875\" class=\"basic label-container\"></rect><g transform=\"translate(-63.546875, -12)\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"127.09375\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>生成SavedMessage</p></span></div></foreignObject></g></g></g></g></g></svg>\n<h2>5. 组件间通信与扩展机制</h2>\n<p>事件订阅系统采用观察者模式变体：</p>\n<html><head></head><body><svg aria-roledescription=\"class\" role=\"graphics-document document\" viewBox=\"0 0 352.15625 324\" style=\"max-width:352.15625px\" class=\"classDiagram\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mmd-d46d33-0\"><g><defs><marker orient=\"auto\" markerHeight=\"240\" markerWidth=\"190\" refY=\"7\" refX=\"18\" class=\"marker aggregation class\" id=\"mmd-d46d33-0_class-aggregationStart\"><path d=\"M 18,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"28\" markerWidth=\"20\" refY=\"7\" refX=\"1\" class=\"marker aggregation class\" id=\"mmd-d46d33-0_class-aggregationEnd\"><path d=\"M 18,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"240\" markerWidth=\"190\" refY=\"7\" refX=\"18\" class=\"marker extension class\" id=\"mmd-d46d33-0_class-extensionStart\"><path d=\"M 1,7 L18,13 V 1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"28\" markerWidth=\"20\" refY=\"7\" refX=\"1\" class=\"marker extension class\" id=\"mmd-d46d33-0_class-extensionEnd\"><path d=\"M 1,1 V 13 L18,7 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"240\" markerWidth=\"190\" refY=\"7\" refX=\"18\" class=\"marker composition class\" id=\"mmd-d46d33-0_class-compositionStart\"><path d=\"M 18,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"28\" markerWidth=\"20\" refY=\"7\" refX=\"1\" class=\"marker composition class\" id=\"mmd-d46d33-0_class-compositionEnd\"><path d=\"M 18,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"240\" markerWidth=\"190\" refY=\"7\" refX=\"6\" class=\"marker dependency class\" id=\"mmd-d46d33-0_class-dependencyStart\"><path d=\"M 5,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"28\" markerWidth=\"20\" refY=\"7\" refX=\"13\" class=\"marker dependency class\" id=\"mmd-d46d33-0_class-dependencyEnd\"><path d=\"M 18,7 L9,13 L14,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" markerHeight=\"240\" markerWidth=\"190\" refY=\"7\" refX=\"13\" class=\"marker lollipop class\" id=\"mmd-d46d33-0_class-lollipopStart\"><circle r=\"6\" cy=\"7\" cx=\"7\" fill=\"transparent\" stroke=\"black\"></circle></marker></defs><defs><marker orient=\"auto\" markerHeight=\"240\" markerWidth=\"190\" refY=\"7\" refX=\"1\" class=\"marker lollipop class\" id=\"mmd-d46d33-0_class-lollipopEnd\"><circle r=\"6\" cy=\"7\" cx=\"7\" fill=\"transparent\" stroke=\"black\"></circle></marker></defs><g class=\"root\"><g class=\"clusters\"></g><g class=\"edgePaths\"><path marker-start=\"url(#mmd-d46d33-0_class-extensionStart)\" class=\"edge-thickness-normal edge-pattern-solid relation\" id=\"id_Subscription_Keyboard_1\" d=\"M69.502,193.78L66.956,195.983C64.41,198.186,59.318,202.593,56.772,208.963C54.227,215.333,54.227,223.667,54.227,227.833L54.227,232\"></path><path marker-start=\"url(#mmd-d46d33-0_class-extensionStart)\" class=\"edge-thickness-normal edge-pattern-solid relation\" id=\"id_Subscription_Timer_2\" d=\"M183.633,200L183.633,201.167C183.633,202.333,183.633,204.667,183.633,210C183.633,215.333,183.633,223.667,183.633,227.833L183.633,232\"></path><path marker-start=\"url(#mmd-d46d33-0_class-extensionStart)\" class=\"edge-thickness-normal edge-pattern-solid relation\" id=\"id_Subscription_Custom_3\" d=\"M291.538,194.181L293.862,196.317C296.187,198.454,300.835,202.727,303.16,209.03C305.484,215.333,305.484,223.667,305.484,227.833L305.484,232\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"0\"><div class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"0\"><div class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"0\"><div class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:200px;text-align:center\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(183.6328125, 95)\" id=\"classId-Subscription-0\" class=\"node default\"><g class=\"basic label-container\"><path fill=\"#1f2020\" stroke-width=\"0\" stroke=\"none\" d=\"M-101.69140625 -87 L101.69140625 -87 L101.69140625 87 L-101.69140625 87\"></path><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-101.69140625 -87 C-57.51644218083173 -87, -13.341478111663463 -87, 101.69140625 -87 M-101.69140625 -87 C-45.330474889422625 -87, 11.03045647115475 -87, 101.69140625 -87 M101.69140625 -87 C101.69140625 -42.40871526651736, 101.69140625 2.182569466965276, 101.69140625 87 M101.69140625 -87 C101.69140625 -41.155615328252466, 101.69140625 4.688769343495068, 101.69140625 87 M101.69140625 87 C42.81092103325514 87, -16.069564183489717 87, -101.69140625 87 M101.69140625 87 C36.082088106796874 87, -29.52723003640625 87, -101.69140625 87 M-101.69140625 87 C-101.69140625 51.488885673561704, -101.69140625 15.977771347123408, -101.69140625 -87 M-101.69140625 87 C-101.69140625 37.41424297606364, -101.69140625 -12.17151404787272, -101.69140625 -87\"></path></g><g transform=\"translate(0, -63)\" class=\"annotation-group text\"></g><g transform=\"translate(-43.5703125, -63)\" class=\"label-group text\"><g transform=\"translate(0,-12)\" style=\"font-weight:bolder\" class=\"label\"><foreignObject height=\"24\" width=\"87.140625\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:111px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>Subscription</p></span></div></foreignObject></g></g><g transform=\"translate(-89.69140625, -15)\" class=\"members-group text\"></g><g transform=\"translate(-89.69140625, 15)\" class=\"methods-group text\"><g transform=\"translate(0,-12)\" class=\"label\"><foreignObject height=\"24\" width=\"135.8125\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:155px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>+merge() : 组合订阅</p></span></div></foreignObject></g><g transform=\"translate(0,12)\" class=\"label\"><foreignObject height=\"24\" width=\"127.21875\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:149px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>+filter() : 事件过滤</p></span></div></foreignObject></g><g transform=\"translate(0,36)\" class=\"label\"><foreignObject height=\"24\" width=\"123.671875\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:146px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>+map() : 消息转换</p></span></div></foreignObject></g></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-101.69140625 -39 C-51.38849140380934 -39, -1.0855765576186798 -39, 101.69140625 -39 M-101.69140625 -39 C-31.50505935879623 -39, 38.68128753240754 -39, 101.69140625 -39\"></path></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-101.69140625 -15 C-56.6283292958629 -15, -11.565252341725795 -15, 101.69140625 -15 M-101.69140625 -15 C-51.51874613461034 -15, -1.346086019220678 -15, 101.69140625 -15\"></path></g></g><g transform=\"translate(54.2265625, 274)\" id=\"classId-Keyboard-1\" class=\"node default\"><g class=\"basic label-container\"><path fill=\"#1f2020\" stroke-width=\"0\" stroke=\"none\" d=\"M-46.2265625 -42 L46.2265625 -42 L46.2265625 42 L-46.2265625 42\"></path><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-46.2265625 -42 C-13.938937762871674 -42, 18.34868697425665 -42, 46.2265625 -42 M-46.2265625 -42 C-11.58962732362832 -42, 23.04730785274336 -42, 46.2265625 -42 M46.2265625 -42 C46.2265625 -22.73154602232282, 46.2265625 -3.4630920446456415, 46.2265625 42 M46.2265625 -42 C46.2265625 -24.90633767705003, 46.2265625 -7.812675354100058, 46.2265625 42 M46.2265625 42 C20.693386146723295 42, -4.83979020655341 42, -46.2265625 42 M46.2265625 42 C15.939788162623469 42, -14.346986174753063 42, -46.2265625 42 M-46.2265625 42 C-46.2265625 15.482810107002294, -46.2265625 -11.034379785995412, -46.2265625 -42 M-46.2265625 42 C-46.2265625 9.840048785291174, -46.2265625 -22.319902429417652, -46.2265625 -42\"></path></g><g transform=\"translate(0, -18)\" class=\"annotation-group text\"></g><g transform=\"translate(-34.2265625, -18)\" class=\"label-group text\"><g transform=\"translate(0,-12)\" style=\"font-weight:bolder\" class=\"label\"><foreignObject height=\"24\" width=\"68.453125\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:97px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>Keyboard</p></span></div></foreignObject></g></g><g transform=\"translate(-34.2265625, 30)\" class=\"members-group text\"></g><g transform=\"translate(-34.2265625, 60)\" class=\"methods-group text\"></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-46.2265625 6 C-9.645208327665571 6, 26.936145844668857 6, 46.2265625 6 M-46.2265625 6 C-12.413413955680149 6, 21.399734588639703 6, 46.2265625 6\"></path></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-46.2265625 24 C-20.97566336604843 24, 4.2752357679031405 24, 46.2265625 24 M-46.2265625 24 C-18.084541897477227 24, 10.057478705045547 24, 46.2265625 24\"></path></g></g><g transform=\"translate(183.6328125, 274)\" id=\"classId-Timer-2\" class=\"node default\"><g class=\"basic label-container\"><path fill=\"#1f2020\" stroke-width=\"0\" stroke=\"none\" d=\"M-33.1796875 -42 L33.1796875 -42 L33.1796875 42 L-33.1796875 42\"></path><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-33.1796875 -42 C-8.58861563951838 -42, 16.00245622096324 -42, 33.1796875 -42 M-33.1796875 -42 C-7.386316888218062 -42, 18.407053723563877 -42, 33.1796875 -42 M33.1796875 -42 C33.1796875 -15.054392865743687, 33.1796875 11.891214268512627, 33.1796875 42 M33.1796875 -42 C33.1796875 -11.00922950906821, 33.1796875 19.98154098186358, 33.1796875 42 M33.1796875 42 C13.898727815071549 42, -5.382231869856902 42, -33.1796875 42 M33.1796875 42 C15.294255376445278 42, -2.5911767471094436 42, -33.1796875 42 M-33.1796875 42 C-33.1796875 14.357580461228213, -33.1796875 -13.284839077543573, -33.1796875 -42 M-33.1796875 42 C-33.1796875 22.33912636340406, -33.1796875 2.678252726808118, -33.1796875 -42\"></path></g><g transform=\"translate(0, -18)\" class=\"annotation-group text\"></g><g transform=\"translate(-21.1796875, -18)\" class=\"label-group text\"><g transform=\"translate(0,-12)\" style=\"font-weight:bolder\" class=\"label\"><foreignObject height=\"24\" width=\"42.359375\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:79px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>Timer</p></span></div></foreignObject></g></g><g transform=\"translate(-21.1796875, 30)\" class=\"members-group text\"></g><g transform=\"translate(-21.1796875, 60)\" class=\"methods-group text\"></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-33.1796875 6 C-13.56867525216008 6, 6.04233699567984 6, 33.1796875 6 M-33.1796875 6 C-12.839852496228282 6, 7.499982507543436 6, 33.1796875 6\"></path></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-33.1796875 24 C-14.09335616000708 24, 4.992975179985841 24, 33.1796875 24 M-33.1796875 24 C-16.632716961084096 24, -0.08574642216819228 24, 33.1796875 24\"></path></g></g><g transform=\"translate(305.484375, 274)\" id=\"classId-Custom-3\" class=\"node default\"><g class=\"basic label-container\"><path fill=\"#1f2020\" stroke-width=\"0\" stroke=\"none\" d=\"M-38.671875 -42 L38.671875 -42 L38.671875 42 L-38.671875 42\"></path><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-38.671875 -42 C-12.379756390741704 -42, 13.912362218516591 -42, 38.671875 -42 M-38.671875 -42 C-22.506636221867065 -42, -6.341397443734131 -42, 38.671875 -42 M38.671875 -42 C38.671875 -16.35939781256445, 38.671875 9.281204374871102, 38.671875 42 M38.671875 -42 C38.671875 -17.35201279132013, 38.671875 7.295974417359737, 38.671875 42 M38.671875 42 C16.893105689809428 42, -4.885663620381145 42, -38.671875 42 M38.671875 42 C9.872162456062668 42, -18.927550087874664 42, -38.671875 42 M-38.671875 42 C-38.671875 20.51417912342876, -38.671875 -0.9716417531424781, -38.671875 -42 M-38.671875 42 C-38.671875 9.555860667387044, -38.671875 -22.88827866522591, -38.671875 -42\"></path></g><g transform=\"translate(0, -18)\" class=\"annotation-group text\"></g><g transform=\"translate(-26.671875, -18)\" class=\"label-group text\"><g transform=\"translate(0,-12)\" style=\"font-weight:bolder\" class=\"label\"><foreignObject height=\"24\" width=\"53.34375\"><div style=\"display:table-cell;white-space:nowrap;line-height:1.5;max-width:88px;text-align:center\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel markdown-node-label\"><p>Custom</p></span></div></foreignObject></g></g><g transform=\"translate(-26.671875, 30)\" class=\"members-group text\"></g><g transform=\"translate(-26.671875, 60)\" class=\"methods-group text\"></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-38.671875 6 C-22.218369368593986 6, -5.764863737187973 6, 38.671875 6 M-38.671875 6 C-22.9414113701854 6, -7.210947740370802 6, 38.671875 6\"></path></g><g class=\"divider\"><path fill=\"none\" stroke-width=\"1.3\" stroke=\"#ccc\" d=\"M-38.671875 24 C-12.561433617326824 24, 13.549007765346353 24, 38.671875 24 M-38.671875 24 C-14.420657029946646 24, 9.830560940106707 24, 38.671875 24\"></path></g></g></g></g></g></svg>\n<blockquote>\n<p><strong>Q: 如何处理多事件源订阅？</strong></p>\n<p>通过订阅合成器实现：</p>\n<html><head></head><body><pre class=\"shiki shiki-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">Subscription</span><span style=\"color:#D73A49;--shiki-dark:#F97583\">::</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">batch</span><span style=\"color:#24292E;--shiki-dark:#E1E4E8\">([</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    keyboard</span><span style=\"color:#D73A49;--shiki-dark:#F97583\">::</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">on_key_press</span><span style=\"color:#24292E;--shiki-dark:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    mouse</span><span style=\"color:#D73A49;--shiki-dark:#F97583\">::</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">on_click</span><span style=\"color:#24292E;--shiki-dark:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    custom</span><span style=\"color:#D73A49;--shiki-dark:#F97583\">::</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">on_event</span><span style=\"color:#24292E;--shiki-dark:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#24292E;--shiki-dark:#E1E4E8\">])</span></span>\n<span class=\"line\"></span></code></pre></body></html>\n</blockquote><html><head><style>#mmd-02acdf-0{font-family:var(--font-sans-serif);font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mmd-02acdf-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mmd-02acdf-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mmd-02acdf-0 .error-icon{fill:#a44141;}#mmd-02acdf-0 .error-text{fill:#ddd;stroke:#ddd;}#mmd-02acdf-0 .edge-thickness-normal{stroke-width:1px;}#mmd-02acdf-0 .edge-thickness-thick{stroke-width:3.5px;}#mmd-02acdf-0 .edge-pattern-solid{stroke-dasharray:0;}#mmd-02acdf-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mmd-02acdf-0 .edge-pattern-dashed{stroke-dasharray:3;}#mmd-02acdf-0 .edge-pattern-dotted{stroke-dasharray:2;}#mmd-02acdf-0 .marker{fill:lightgrey;stroke:lightgrey;}#mmd-02acdf-0 .marker.cross{stroke:lightgrey;}#mmd-02acdf-0 svg{font-family:var(--font-sans-serif);font-size:16px;}#mmd-02acdf-0 p{margin:0;}#mmd-02acdf-0 .label{font-family:var(--font-sans-serif);color:#ccc;}#mmd-02acdf-0 .cluster-label text{fill:#F9FFFE;}#mmd-02acdf-0 .cluster-label span{color:#F9FFFE;}#mmd-02acdf-0 .cluster-label span p{background-color:transparent;}#mmd-02acdf-0 .label text,#mmd-02acdf-0 span{fill:#ccc;color:#ccc;}#mmd-02acdf-0 .node rect,#mmd-02acdf-0 .node circle,#mmd-02acdf-0 .node ellipse,#mmd-02acdf-0 .node polygon,#mmd-02acdf-0 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mmd-02acdf-0 .rough-node .label text,#mmd-02acdf-0 .node .label text,#mmd-02acdf-0 .image-shape .label,#mmd-02acdf-0 .icon-shape .label{text-anchor:middle;}#mmd-02acdf-0 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mmd-02acdf-0 .rough-node .label,#mmd-02acdf-0 .node .label,#mmd-02acdf-0 .image-shape .label,#mmd-02acdf-0 .icon-shape .label{text-align:center;}#mmd-02acdf-0 .node.clickable{cursor:pointer;}#mmd-02acdf-0 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mmd-02acdf-0 .arrowheadPath{fill:lightgrey;}#mmd-02acdf-0 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mmd-02acdf-0 .flowchart-link{stroke:lightgrey;fill:none;}#mmd-02acdf-0 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mmd-02acdf-0 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mmd-02acdf-0 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mmd-02acdf-0 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mmd-02acdf-0 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mmd-02acdf-0 .cluster text{fill:#F9FFFE;}#mmd-02acdf-0 .cluster span{color:#F9FFFE;}#mmd-02acdf-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-sans-serif);font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mmd-02acdf-0 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mmd-02acdf-0 rect.text{fill:none;stroke-width:0;}#mmd-02acdf-0 .icon-shape,#mmd-02acdf-0 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mmd-02acdf-0 .icon-shape p,#mmd-02acdf-0 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mmd-02acdf-0 .icon-shape rect,#mmd-02acdf-0 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mmd-02acdf-0 :root{--mermaid-font-family:var(--font-sans-serif);}</style></head><body><html><head><style>#mmd-f5e9ef-0{font-family:var(--font-sans-serif);font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mmd-f5e9ef-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mmd-f5e9ef-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mmd-f5e9ef-0 .error-icon{fill:#a44141;}#mmd-f5e9ef-0 .error-text{fill:#ddd;stroke:#ddd;}#mmd-f5e9ef-0 .edge-thickness-normal{stroke-width:1px;}#mmd-f5e9ef-0 .edge-thickness-thick{stroke-width:3.5px;}#mmd-f5e9ef-0 .edge-pattern-solid{stroke-dasharray:0;}#mmd-f5e9ef-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mmd-f5e9ef-0 .edge-pattern-dashed{stroke-dasharray:3;}#mmd-f5e9ef-0 .edge-pattern-dotted{stroke-dasharray:2;}#mmd-f5e9ef-0 .marker{fill:lightgrey;stroke:lightgrey;}#mmd-f5e9ef-0 .marker.cross{stroke:lightgrey;}#mmd-f5e9ef-0 svg{font-family:var(--font-sans-serif);font-size:16px;}#mmd-f5e9ef-0 p{margin:0;}#mmd-f5e9ef-0 .actor{stroke:#ccc;fill:#1f2020;}#mmd-f5e9ef-0 text.actor&gt;tspan{fill:lightgrey;stroke:none;}#mmd-f5e9ef-0 .actor-line{stroke:#ccc;}#mmd-f5e9ef-0 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mmd-f5e9ef-0 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mmd-f5e9ef-0 #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mmd-f5e9ef-0 .sequenceNumber{fill:black;}#mmd-f5e9ef-0 #sequencenumber{fill:lightgrey;}#mmd-f5e9ef-0 #crosshead path{fill:lightgrey;stroke:lightgrey;}#mmd-f5e9ef-0 .messageText{fill:lightgrey;stroke:none;}#mmd-f5e9ef-0 .labelBox{stroke:#ccc;fill:#1f2020;}#mmd-f5e9ef-0 .labelText,#mmd-f5e9ef-0 .labelText&gt;tspan{fill:lightgrey;stroke:none;}#mmd-f5e9ef-0 .loopText,#mmd-f5e9ef-0 .loopText&gt;tspan{fill:lightgrey;stroke:none;}#mmd-f5e9ef-0 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mmd-f5e9ef-0 .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mmd-f5e9ef-0 .noteText,#mmd-f5e9ef-0 .noteText&gt;tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mmd-f5e9ef-0 .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mmd-f5e9ef-0 .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mmd-f5e9ef-0 .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mmd-f5e9ef-0 .actorPopupMenu{position:absolute;}#mmd-f5e9ef-0 .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mmd-f5e9ef-0 .actor-man line{stroke:#ccc;fill:#1f2020;}#mmd-f5e9ef-0 .actor-man circle,#mmd-f5e9ef-0 line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mmd-f5e9ef-0 :root{--mermaid-font-family:var(--font-sans-serif);}</style></head><body><html><head><style>#mmd-32745f-0{font-family:var(--font-sans-serif);font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mmd-32745f-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mmd-32745f-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mmd-32745f-0 .error-icon{fill:#a44141;}#mmd-32745f-0 .error-text{fill:#ddd;stroke:#ddd;}#mmd-32745f-0 .edge-thickness-normal{stroke-width:1px;}#mmd-32745f-0 .edge-thickness-thick{stroke-width:3.5px;}#mmd-32745f-0 .edge-pattern-solid{stroke-dasharray:0;}#mmd-32745f-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mmd-32745f-0 .edge-pattern-dashed{stroke-dasharray:3;}#mmd-32745f-0 .edge-pattern-dotted{stroke-dasharray:2;}#mmd-32745f-0 .marker{fill:lightgrey;stroke:lightgrey;}#mmd-32745f-0 .marker.cross{stroke:lightgrey;}#mmd-32745f-0 svg{font-family:var(--font-sans-serif);font-size:16px;}#mmd-32745f-0 p{margin:0;}#mmd-32745f-0 .label{font-family:var(--font-sans-serif);color:#ccc;}#mmd-32745f-0 .cluster-label text{fill:#F9FFFE;}#mmd-32745f-0 .cluster-label span{color:#F9FFFE;}#mmd-32745f-0 .cluster-label span p{background-color:transparent;}#mmd-32745f-0 .label text,#mmd-32745f-0 span{fill:#ccc;color:#ccc;}#mmd-32745f-0 .node rect,#mmd-32745f-0 .node circle,#mmd-32745f-0 .node ellipse,#mmd-32745f-0 .node polygon,#mmd-32745f-0 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mmd-32745f-0 .rough-node .label text,#mmd-32745f-0 .node .label text,#mmd-32745f-0 .image-shape .label,#mmd-32745f-0 .icon-shape .label{text-anchor:middle;}#mmd-32745f-0 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mmd-32745f-0 .rough-node .label,#mmd-32745f-0 .node .label,#mmd-32745f-0 .image-shape .label,#mmd-32745f-0 .icon-shape .label{text-align:center;}#mmd-32745f-0 .node.clickable{cursor:pointer;}#mmd-32745f-0 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mmd-32745f-0 .arrowheadPath{fill:lightgrey;}#mmd-32745f-0 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mmd-32745f-0 .flowchart-link{stroke:lightgrey;fill:none;}#mmd-32745f-0 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mmd-32745f-0 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mmd-32745f-0 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mmd-32745f-0 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mmd-32745f-0 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mmd-32745f-0 .cluster text{fill:#F9FFFE;}#mmd-32745f-0 .cluster span{color:#F9FFFE;}#mmd-32745f-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-sans-serif);font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mmd-32745f-0 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mmd-32745f-0 rect.text{fill:none;stroke-width:0;}#mmd-32745f-0 .icon-shape,#mmd-32745f-0 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mmd-32745f-0 .icon-shape p,#mmd-32745f-0 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mmd-32745f-0 .icon-shape rect,#mmd-32745f-0 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mmd-32745f-0 :root{--mermaid-font-family:var(--font-sans-serif);}</style></head><body><html><head><style>#mmd-b8ee69-0{font-family:var(--font-sans-serif);font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mmd-b8ee69-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mmd-b8ee69-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mmd-b8ee69-0 .error-icon{fill:#a44141;}#mmd-b8ee69-0 .error-text{fill:#ddd;stroke:#ddd;}#mmd-b8ee69-0 .edge-thickness-normal{stroke-width:1px;}#mmd-b8ee69-0 .edge-thickness-thick{stroke-width:3.5px;}#mmd-b8ee69-0 .edge-pattern-solid{stroke-dasharray:0;}#mmd-b8ee69-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mmd-b8ee69-0 .edge-pattern-dashed{stroke-dasharray:3;}#mmd-b8ee69-0 .edge-pattern-dotted{stroke-dasharray:2;}#mmd-b8ee69-0 .marker{fill:lightgrey;stroke:lightgrey;}#mmd-b8ee69-0 .marker.cross{stroke:lightgrey;}#mmd-b8ee69-0 svg{font-family:var(--font-sans-serif);font-size:16px;}#mmd-b8ee69-0 p{margin:0;}#mmd-b8ee69-0 .label{font-family:var(--font-sans-serif);color:#ccc;}#mmd-b8ee69-0 .cluster-label text{fill:#F9FFFE;}#mmd-b8ee69-0 .cluster-label span{color:#F9FFFE;}#mmd-b8ee69-0 .cluster-label span p{background-color:transparent;}#mmd-b8ee69-0 .label text,#mmd-b8ee69-0 span{fill:#ccc;color:#ccc;}#mmd-b8ee69-0 .node rect,#mmd-b8ee69-0 .node circle,#mmd-b8ee69-0 .node ellipse,#mmd-b8ee69-0 .node polygon,#mmd-b8ee69-0 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mmd-b8ee69-0 .rough-node .label text,#mmd-b8ee69-0 .node .label text,#mmd-b8ee69-0 .image-shape .label,#mmd-b8ee69-0 .icon-shape .label{text-anchor:middle;}#mmd-b8ee69-0 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mmd-b8ee69-0 .rough-node .label,#mmd-b8ee69-0 .node .label,#mmd-b8ee69-0 .image-shape .label,#mmd-b8ee69-0 .icon-shape .label{text-align:center;}#mmd-b8ee69-0 .node.clickable{cursor:pointer;}#mmd-b8ee69-0 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mmd-b8ee69-0 .arrowheadPath{fill:lightgrey;}#mmd-b8ee69-0 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mmd-b8ee69-0 .flowchart-link{stroke:lightgrey;fill:none;}#mmd-b8ee69-0 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mmd-b8ee69-0 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mmd-b8ee69-0 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mmd-b8ee69-0 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mmd-b8ee69-0 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mmd-b8ee69-0 .cluster text{fill:#F9FFFE;}#mmd-b8ee69-0 .cluster span{color:#F9FFFE;}#mmd-b8ee69-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-sans-serif);font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mmd-b8ee69-0 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mmd-b8ee69-0 rect.text{fill:none;stroke-width:0;}#mmd-b8ee69-0 .icon-shape,#mmd-b8ee69-0 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mmd-b8ee69-0 .icon-shape p,#mmd-b8ee69-0 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mmd-b8ee69-0 .icon-shape rect,#mmd-b8ee69-0 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mmd-b8ee69-0 :root{--mermaid-font-family:var(--font-sans-serif);}</style></head><body><html><head><style>#mmd-d46d33-0{font-family:var(--font-sans-serif);font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mmd-d46d33-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mmd-d46d33-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mmd-d46d33-0 .error-icon{fill:#a44141;}#mmd-d46d33-0 .error-text{fill:#ddd;stroke:#ddd;}#mmd-d46d33-0 .edge-thickness-normal{stroke-width:1px;}#mmd-d46d33-0 .edge-thickness-thick{stroke-width:3.5px;}#mmd-d46d33-0 .edge-pattern-solid{stroke-dasharray:0;}#mmd-d46d33-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mmd-d46d33-0 .edge-pattern-dashed{stroke-dasharray:3;}#mmd-d46d33-0 .edge-pattern-dotted{stroke-dasharray:2;}#mmd-d46d33-0 .marker{fill:lightgrey;stroke:lightgrey;}#mmd-d46d33-0 .marker.cross{stroke:lightgrey;}#mmd-d46d33-0 svg{font-family:var(--font-sans-serif);font-size:16px;}#mmd-d46d33-0 p{margin:0;}#mmd-d46d33-0 g.classGroup text{fill:#ccc;stroke:none;font-family:var(--font-sans-serif);font-size:10px;}#mmd-d46d33-0 g.classGroup text .title{font-weight:bolder;}#mmd-d46d33-0 .nodeLabel,#mmd-d46d33-0 .edgeLabel{color:#e0dfdf;}#mmd-d46d33-0 .edgeLabel .label rect{fill:#1f2020;}#mmd-d46d33-0 .label text{fill:#e0dfdf;}#mmd-d46d33-0 .labelBkg{background:#1f2020;}#mmd-d46d33-0 .edgeLabel .label span{background:#1f2020;}#mmd-d46d33-0 .classTitle{font-weight:bolder;}#mmd-d46d33-0 .node rect,#mmd-d46d33-0 .node circle,#mmd-d46d33-0 .node ellipse,#mmd-d46d33-0 .node polygon,#mmd-d46d33-0 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mmd-d46d33-0 .divider{stroke:#ccc;stroke-width:1;}#mmd-d46d33-0 g.clickable{cursor:pointer;}#mmd-d46d33-0 g.classGroup rect{fill:#1f2020;stroke:#ccc;}#mmd-d46d33-0 g.classGroup line{stroke:#ccc;stroke-width:1;}#mmd-d46d33-0 .classLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mmd-d46d33-0 .classLabel .label{fill:#ccc;font-size:10px;}#mmd-d46d33-0 .relation{stroke:lightgrey;stroke-width:1;fill:none;}#mmd-d46d33-0 .dashed-line{stroke-dasharray:3;}#mmd-d46d33-0 .dotted-line{stroke-dasharray:1 2;}#mmd-d46d33-0 #compositionStart,#mmd-d46d33-0 .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #compositionEnd,#mmd-d46d33-0 .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #dependencyStart,#mmd-d46d33-0 .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #dependencyStart,#mmd-d46d33-0 .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #extensionStart,#mmd-d46d33-0 .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #extensionEnd,#mmd-d46d33-0 .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #aggregationStart,#mmd-d46d33-0 .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #aggregationEnd,#mmd-d46d33-0 .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #lollipopStart,#mmd-d46d33-0 .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 #lollipopEnd,#mmd-d46d33-0 .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mmd-d46d33-0 .edgeTerminals{font-size:11px;line-height:initial;}#mmd-d46d33-0 .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mmd-d46d33-0 :root{--mermaid-font-family:var(--font-sans-serif);}</style></head><body></body></html>","markdownContent":"\nimport { YoutubePlayer } from \"../components/YoutubePlayer.tsx\";\n\n> 参考入门视频：\n>\n> <YoutubePlayer videoId=\"gcBJ7cPSALo\" />\n\n## 1. 架构总览：消息驱动的响应式系统\n\nIced 的核心架构遵循经典的 Elm 模式，其运行时模型可抽象为三个核心要素：\n• **状态容器**：承载当前应用数据的不可变结构体\n• **消息管道**：用户交互与系统事件的中继处理器\n• **渲染引擎**：基于状态变更的视图同步器\n\n```mermaid\ngraph LR\n    S[State] -->|状态快照| V[View]\n    V -->|用户交互| M[Message]\n    M -->|事件路由| U[Update]\n    U -->|状态变更| S\n    U -->|副作用| C[Command]\n    C -->|异步任务| M\n```\n\n这种架构实现了严格的单向数据流，使得状态变更具有可预测性。特别值得注意的是，视图层不直接修改状态，而是通过消息管道间接触发状态变更。\n\n## 2. 状态管理的基本单元与数据流\n\n状态容器的设计体现了最小化原则：\n\n- 纯数据结构体，无生命周期绑定\n- 每次更新生成新状态实例（非强制）\n- 变更触发条件严格受控于消息类型\n\n> **Q: 为何不采用自动依赖追踪？**\n>\n> 通过强制显式声明消息处理路径，实现了：\n>\n> 1. 状态变更路径显式化\n> 2. 调试溯源能力增强\n> 3. 渲染优化边界清晰化\n\n## 3. 渲染循环与事件处理机制\n\n核心处理流程包含四个阶段：\n\n```mermaid\nsequenceDiagram\n    participant E as 事件源\n    participant MQ as 消息队列\n    participant UC as 更新控制器\n    participant VR as 虚拟渲染器\n\n    loop 主循环\n        E->>MQ: 事件编码为消息\n        MQ->>UC: 消息派发\n        UC->>UC: 状态变更\n        UC->>MQ: 生成副作用命令\n        UC->>VR: 触发差异比对\n        VR->>VR: 最小化DOM更新\n    end\n```\n\n> **Q: 视图更新是立即生效的吗？**\n>\n> 更新流程遵循\"批处理优先\"原则：\n>\n> 1. 同步操作立即更新状态并触发渲染\n> 2. 异步操作将任务移交运行时\n> 3. 视图层在每帧渲染前同步最新状态\n\n## 4. 异步任务处理与并发模型\n\n命令(Command)系统实现了副作用隔离机制：\n\n```mermaid\ngraph TB\n    C[Command] -->|none| N[空操作]\n    C -->|perform| A[异步任务]\n    C -->|batch| B[命令集合]\n    C -->|stream| S[事件流]\n    C -->|abortable| K[可终止任务]\n```\n\n> **Q: 长时间异步任务会阻塞界面吗？**\n>\n> 通过任务调度器的分级策略：\n>\n> - I/O 密集型：移交线程池\n> - UI 密集型：主线程优先\n> - 定时任务：时间切片处理\n\n典型处理流程：\n\n```mermaid\nflowchart LR\n    U[用户点击保存] --> C[生成SaveCommand]\n    C -->|spawn| T[文件IO线程]\n    T -->|完成| M[生成SavedMessage]\n    M --> U[更新状态]\n```\n\n## 5. 组件间通信与扩展机制\n\n事件订阅系统采用观察者模式变体：\n\n```mermaid\nclassDiagram\n    class Subscription{\n        +merge() 组合订阅\n        +filter() 事件过滤\n        +map() 消息转换\n    }\n\n    Subscription <|-- Keyboard\n    Subscription <|-- Timer\n    Subscription <|-- Custom\n```\n\n> **Q: 如何处理多事件源订阅？**\n>\n> 通过订阅合成器实现：\n>\n> ```rust\n> Subscription::batch([\n>     keyboard::on_key_press(),\n>     mouse::on_click(),\n>     custom::on_event()\n> ])\n> ```\n"}}}