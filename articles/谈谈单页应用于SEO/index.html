<!doctype html><html lang=zh-CH><meta charset=utf-8><title>谈谈单页应用于SEO · Gaubee</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#ec407a name=theme-color><link href=/articles.atom rel=alternate title="Gaubee's Articles Atom feed" type=application/atom+xml><link href=/events.atom rel=alternate title="Gaubee's Events Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><header id=header><h1><a href=/ >Gaubee</a></h1><a href=#navigation-toggle id=nav-toggle>显示导航 Show navigation</a><nav><ul><li><a href=/ >主页 Home</a><li class=current><a href=/articles>文章 Articles</a><li><a href=/events>小事件 Events</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>谈谈单页应用于SEO</h1><p class=meta>发布于 <time datetime=3/11/2014 itemprop=datePublished>3/11/2014</time> · 最后修改时间 <time datetime=3/11/2014 itemprop=dateModified>3/11/2014</time></header><div itemprop=articleBody><blockquote><p>注： 本文章的文字内容来自鬼懿群 20:00 2014/3/10 的内容，并非访谈形式。内容有所删减。</blockquote><h2 id=%E7%AC%AC%E4%B8%80%E8%AF%9D-%E5%90%84%E8%87%AA%E7%9A%84%E6%96%B9%E6%A1%88 tabindex=-1><a href=#%E7%AC%AC%E4%B8%80%E8%AF%9D-%E5%90%84%E8%87%AA%E7%9A%84%E6%96%B9%E6%A1%88 class=header-anchor>第一话 各自的方案</a></h2><p><strong>@浩明 1999</strong><br>现在网上大部分流传的方法是这样：<p>index.html 的代码如下：<pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ajax.html?id=1<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token javascript language-javascript value"><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ajax.html?id=2<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token javascript language-javascript value"><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ajax.html?id=3<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token javascript language-javascript value"><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><p>通过在 A 标签上 return false 来区别搜索引擎和用户。<p>那我有一个疑问，搜索引擎收录的页面链接是 Ajax.html?id=3，如果我在百度搜索到内容，点进去的应该是 Ajax.html?id=3 这个页面，而我们的期望并不是这样啊，我们是希望用户点击到 index.html 这个页面并触发 onclick="fun(3);<p>那我们能不能在 Ajax.html?id=3 这个页面中用 js 跳转到 index.html<hr><p><strong>@Igin</strong><br>Ajax.html?id=3 用 js 跳转不合适<br>等于这个页面加载了却浪费不用<br>你可以在服务端直接重定向<br>或者用 google 认识的 <code>#!</code><hr><p><strong>@漂 ౣ 流 ౣ 瓶 ౣ</strong><br>搜一下 facebook 的 quickling 吧，这个有现成的解决方案<br>quickling 是比较完美的解决方案<hr><p><strong>@天猪</strong><br>prerender.io<hr><p><strong>@Gaubee</strong><br>纯粹的单页面太极端了，开发起来也并不是最好的选择。我现在都是混合在用，应用是单页的，其它的依旧是分页面。<hr><p><strong>@蚂蚁 zzbo</strong><br>百度用 baidumap.xml ...<h2 id=%E7%AC%AC%E4%BA%8C%E8%AF%9D-%E7%A3%A8 tabindex=-1><a href=#%E7%AC%AC%E4%BA%8C%E8%AF%9D-%E7%A3%A8 class=header-anchor>第二话 磨</a></h2><p><strong>@雨夜带刀</strong><br>单页面对前端是有很大的挑战<br>能提升用户体验那是显而易见的<br>（前端）出错了只能怪代码没写好 所以一定要保证 js 不能出错<hr><p><strong>@Gaubee</strong><br>等于把后端的框架往前端搬。工作量确实很大，我基本上已经离不开 requirejs 了。<br>有模块开发的规范的话，错误的出现会比较容易处理。<br>做测试也会容易<br>那些考虑单页面 SEO 的，感觉都是把炫酷的 H5 技术滥用了。<br>个人觉得 hash 路由主要使用在 web 应用上。而不是非要到处使用。别扭就是别扭。<hr><p><strong>@雨夜带刀</strong><br><a href="http://image.so.com/zv?ch=pet&cid=%E7%83%AD%E9%97%A8&tid=#groupid=cd2f127aa7d0a72bede10f2a626babe7&dataindex=34&lightboxindex=7&itemindex=0">http://image.so.com/zv?ch=pet&cid=热门&tid=#groupid=cd2f127aa7d0a72bede10f2a626babe7&dataindex=34&lightboxindex=7&itemindex=0</a><br><a href=http://music.163.com>http://music.163.com</a><br>看应用场景 像我上面发的都很具代表性<br>普通的站点真心没必要<hr><p><strong>@漂 ౣ 流 ౣ 瓶 ౣ</strong><br>借助后端，是可以实现这样一种页面输出能力：<br>1 直接访问页面 a，比如 url 是 /a ，返回的内容是正常的 html<br>2 如果希望把 a 页面中的某些模块以 json 形式返回，比如 url 是 /a?pagelets=m1,m2 这个 url 的返回结果是 json，json 包括了 m1，m2 模块的 js、css 以及 html 内容，前端加载其 js、css、并插入 html 就可以实现局刷了。<p>实现这两个功能，就能解决：<br>1 无 js 用户或者网络爬虫用户访问 a 或者 b 页面时，返回的是普通的 html<br>2 当用从 a 页面切换到 b 页面的时候，可以用 js 发起 /b?pagelets=m3,m4 来局部刷新<p>这种方式就是 facebook 的 quickling 实现原理，它的页面代码形如：<figure><img alt="" height=234 loading=lazy src=/_img/spa-seo/img-1.jpg width=319><figcaption>facebookquickling</figcaption></figure><p>直接访问页面，返回完整的 html，如果访问 的 url 加上 pagelets=left,right，就会返回两个页面小部件的 js、css 和 html 的 json 数据<p>代码很简单：<br>假设上面的例子的文件叫 a.php，其实有一个后端的控制框架，代码是这样的：<pre class=language-php><code class=language-php><span class="token language-php php"><span class="token delimiter important">&lt;?php</span><br><span class="token variable">$pagelets</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'pagelets'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$pagelets</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>    <span class="token class-name static-context">Pagelet</span><span class="token operator">::</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token variable">$pagelets</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">include</span> <span class="token single-quoted-string string">'a.php'</span><span class="token punctuation">;</span><br>    <span class="token function">ob_end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">echo</span> <span class="token class-name static-context">Pagelet</span><span class="token operator">::</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token keyword">echo</span> <span class="token keyword">include</span> <span class="token single-quoted-string string">'a.php'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token operator">></span></span></code></pre><p>也就是同一个页面，如果请求中有 pagelets 参数，就抑制原始的 html 输出，改成 Pagelet 收集，否则就正常输出<br>然后，我们考虑一下，那个 load_pagelet 函数是怎么实现的。<br>其实就是一个简单的命中而已。有一个 Pagelet 框架帮忙收集，最后将数据以 json 形势吐出<br>这样，工程师好像在写一个普通的 html 页面，但是可以在 ajax 化和非 ajax 化之间切换<figure><img alt="" height=355 loading=lazy src=/_img/spa-seo/img-2.jpg width=671><figcaption>facebookquickling</figcaption></figure><p>有一个前端框架，页面加载之后，找到所有有 pagelets 属性的 a 标签，抑制它的点击，点击的时候，改成 ajax 请求 /b?pagelets=xxx<p>对于搜索引擎用户，它不能执行 js，这个时候 /b 这个链接是正确的，访问也是正常的 html<p>对于可以执行 js 的用户，它的那个 url 被 js 拦截，发起了一个 ajax 请求 /b?pagelets=left,right 并能做到页面的 ajax 化<hr><p><strong>@雨夜带刀</strong><br>我说的不是同一个页面是针对用户来说<br>搜索引擎和真实的用户<br>本身做搜索的体验不到需要兼容搜索引擎的难处...<br>这个解决方案貌似还行<hr><p><strong>@漂 ౣ 流 ౣ 瓶 ౣ</strong><br>ajax 和 seo 不是鱼和熊掌，而是要跨栈联合解决的，页面可以有两种输出模式，并且能实现静态资源的组件化管理，这些都有完整实现的，比如 facebook 在 velocity2010 上关于 ajax 流水化的分享。另外百度的 hao123，贴吧的 pad 版都是这样实现的<hr><p><strong>@Gaubee</strong><br>等于就做了两个网站，<br>一个针对 SEO，主打关键字展示。<br>一个针对浏览器用户，返回真正的程序数据。<p>要我我就直接做两套路由。硬生生整合在一起没理由啊<hr><p><strong>@漂 ౣ 流 ౣ 瓶 ౣ</strong><br>没有硬生生整合<br>其实上面的截图也能看到，工程师基本上感觉不到在写一个 ajax 化的网站<br>而是传统的 html 页面，这种工程上的优化收益很大的。此外，这里还有一种技术叫 pagecache<br>比如 a 页面切换到 b 页面的时候，前端可以记录 a 和 b 页面所用到的静态资源和 html 内容，那么，下次 ab 页面之间切换的时候，不用再发起 ajax 请求，而是直接从内存中恢复页面即可<br>facebook 会保留几个用户最常访问的页面的 pagecache，提高访问速度<br>大家可以感受一下百度贴吧 pad 版的这个效果<hr><p><strong>@Gaubee</strong><br>嗯。是这样子的。我只是觉得没必要把细节隐藏起来，开发者知道整套构架最好。观点不一样，这点我没什么好说的。<br>pagecache 是等于把资源手动存储么。等于 cookie 再过期时间内无需重新请求资源。<hr><p><strong>@漂 ౣ 流 ౣ 瓶 ౣ</strong><br>恩，没有隐藏全部细节，因为链接还是要指定要异步的 pagelets 的 id 的，以及要填充的容器 id<figure><img alt="" height=679 loading=lazy src=/_img/spa-seo/img-3.jpg width=784><figcaption>facebookquickling</figcaption></figure><p>这样两个 tab 短时间内切换是没有 http 请求的<figure><img alt="" height=667 loading=lazy src=/_img/spa-seo/img-4.jpg width=761><figcaption>facebookquickling</figcaption></figure><p>这个种方式还能解决一个问题，就是 ajax 化的网站通常会有一个 loading 界面，因为页面内容是异步刷新得到的，而这种解决方案可以在第一次请求的时候直接生成整个 html 内容，之后再跳转页面就是 ajax 化的了，体验上也有优势<p>我们也是从 facebook 网站源码、velocity 分享以及他们的 GitHub 上这些碎片信息里分析到的</div><footer></footer></article></main><footer id=footer><div><nav><a href=https://twitter.com/gaubeebangeel rel="me nofollow" target=_blank>Twitter</a> · <a href=https://github.com/gaubee/gaubee.com/tree/main/./src/articles/谈谈单页应用于SEO.md rel=nofollow target=_blank>Edit this page on GitHub</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>除非有特别的说明, 该站点所有直接内容都使用许可证：<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>署名 4.0 国际 (CC BY 4.0)</a></small><blockquote><small>本网站不收集任何访问者的行为与信息，不做任何商业运作，仅仅为个人使用</small></blockquote></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/time-elements.mjs type=module></script><script src=/_js/main.mjs type=module></script>