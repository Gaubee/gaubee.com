<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/icon-192x192.png"><meta name="generator" content="Astro v5.13.9"><title>æ·±å…¥æµ…å‡º Observableï¼šé©¯æœ Web/JS å¼‚æ­¥äº‹ä»¶æµçš„â€œç‘å£«å†›åˆ€â€ï¼Ÿ</title><meta name="description" content="Gaubee's personal blog"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.B3vRBseb.js"></script><style>astro-island:has(.md-renderer)~.fallback-content{display:none}
</style>
<link rel="stylesheet" href="/_astro/editor.DuBCv8QM.css">
<link rel="stylesheet" href="/_astro/MarkdownRenderer.COXD5gRV.css"></head> <body class="bg-white text-zinc-900 transition-colors duration-300 dark:bg-zinc-900 dark:text-zinc-50">  <div class="flex max-w-7xl mx-auto"> <aside class="hidden lg:block sticky top-0 h-screen w-64 flex-shrink-0 py-8 pr-8"> <aside class="w-64 p-4 pr-8"><nav class="flex flex-col space-y-2"><a href="/" class="flex items-center gap-4 py-3 px-6 text-lg font-semibold no-underline text-zinc-900 dark:text-zinc-100 rounded-full transition-colors duration-200 ease-in-out hover:bg-gray-200 dark:hover:bg-zinc-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house" aria-hidden="true"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg><span>ä¸»é¡µ</span></a><a href="/events" class="flex items-center gap-4 py-3 px-6 text-lg font-semibold no-underline text-zinc-900 dark:text-zinc-100 rounded-full transition-colors duration-200 ease-in-out hover:bg-gray-200 dark:hover:bg-zinc-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss" aria-hidden="true"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg><span>æ—¶äº‹å¿«è®¯</span></a></nav></aside> </aside> <main class="flex-1 min-w-0"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1iipdX" prefix="r15" component-url="/_astro/MobileNav.IYPvWUAA.js" component-export="default" renderer-url="/_astro/client.D0HLj-jK.js" props="{&quot;title&quot;:[0,&quot;æ·±å…¥æµ…å‡º Observableï¼šé©¯æœ Web/JS å¼‚æ­¥äº‹ä»¶æµçš„â€œç‘å£«å†›åˆ€â€ï¼Ÿ&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;MobileNav&quot;,&quot;value&quot;:true}" await-children><div id="mobile-topbar" class="sticky top-0 z-50 flex h-14 items-center justify-between border-b border-zinc-200 bg-white/80 px-4 backdrop-blur-sm dark:border-zinc-800 dark:bg-zinc-900/80 lg:hidden"><div class="w-6"></div><div class="absolute left-1/2 -translate-x-1/2 text-sm font-semibold text-zinc-700 dark:text-zinc-300">æ·±å…¥æµ…å‡º Observableï¼šé©¯æœ Web/JS å¼‚æ­¥äº‹ä»¶æµçš„â€œç‘å£«å†›åˆ€â€ï¼Ÿ</div><button type="button" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu" aria-hidden="true"><path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path></svg></button></div><template data-astro-template> <div class="space-y-4"> <astro-island uid="Z1iPLNP" prefix="r8" component-url="/_astro/TableOfContentsCard.BBvTc4w5.js" component-export="default" renderer-url="/_astro/client.D0HLj-jK.js" props="{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;ä¸€observable-çš„çµé­‚æ‹·é—®å®ƒåˆ°åº•æƒ³å¹²å•¥&quot;],&quot;text&quot;:[0,&quot;ä¸€ã€Observable çš„çµé­‚æ‹·é—®â€”â€”å®ƒåˆ°åº•æƒ³å¹²å•¥ï¼Ÿ&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;äºŒå‰ä¸–ä»Šç”Ÿobservable-çš„é•¿å¾è·¯&quot;],&quot;text&quot;:[0,&quot;äºŒã€å‰ä¸–ä»Šç”Ÿâ€”â€”Observable çš„â€œé•¿å¾è·¯â€&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;ä¸‰å°è¯•ç‰›åˆ€eventtargetwhen-åˆä½“éªŒ&quot;],&quot;text&quot;:[0,&quot;ä¸‰ã€å°è¯•ç‰›åˆ€â€”â€”EventTarget.when() åˆä½“éªŒ&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;å››ç™»å ‚å…¥å®¤æ ¸å¿ƒ-observable-api-ä¸æ¦‚å¿µ&quot;],&quot;text&quot;:[0,&quot;å››ã€ç™»å ‚å…¥å®¤â€”â€”æ ¸å¿ƒ Observable API ä¸æ¦‚å¿µ&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;äº”ç¥å…µåˆ©å™¨ç©è½¬-observable-æ“ä½œç¬¦&quot;],&quot;text&quot;:[0,&quot;äº”ã€ç¥å…µåˆ©å™¨â€”â€”ç©è½¬ Observable æ“ä½œç¬¦&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;å…­ä¸‡ç‰©çš†å¯-observableobservablefrom&quot;],&quot;text&quot;:[0,&quot;å…­ã€ä¸‡ç‰©çš†å¯ Observableâ€”â€”Observable.from()&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;ä¸ƒèä¼šè´¯é€šå®æˆ˜åœºæ™¯æ¼”ç»ƒ&quot;],&quot;text&quot;:[0,&quot;ä¸ƒã€èä¼šè´¯é€šâ€”â€”å®æˆ˜åœºæ™¯æ¼”ç»ƒ&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;å…«ç«™åœ¨å·¨äººè‚©ä¸Šæ€»ç»“ä¸å±•æœ›&quot;],&quot;text&quot;:[0,&quot;å…«ã€ç«™åœ¨å·¨äººè‚©ä¸Šâ€”â€”æ€»ç»“ä¸å±•æœ›&quot;]}]]]}" ssr client="load" opts="{&quot;name&quot;:&quot;TableOfContentsCard&quot;,&quot;value&quot;:true}" await-children><div class="rounded-xl border bg-card text-card-foreground shadow"><div class="p-6 pt-0"><ul><li><a href="#ä¸€observable-çš„çµé­‚æ‹·é—®å®ƒåˆ°åº•æƒ³å¹²å•¥">ä¸€ã€Observable çš„çµé­‚æ‹·é—®â€”â€”å®ƒåˆ°åº•æƒ³å¹²å•¥ï¼Ÿ</a></li><li><a href="#äºŒå‰ä¸–ä»Šç”Ÿobservable-çš„é•¿å¾è·¯">äºŒã€å‰ä¸–ä»Šç”Ÿâ€”â€”Observable çš„â€œé•¿å¾è·¯â€</a></li><li><a href="#ä¸‰å°è¯•ç‰›åˆ€eventtargetwhen-åˆä½“éªŒ">ä¸‰ã€å°è¯•ç‰›åˆ€â€”â€”EventTarget.when() åˆä½“éªŒ</a></li><li><a href="#å››ç™»å ‚å…¥å®¤æ ¸å¿ƒ-observable-api-ä¸æ¦‚å¿µ">å››ã€ç™»å ‚å…¥å®¤â€”â€”æ ¸å¿ƒ Observable API ä¸æ¦‚å¿µ</a></li><li><a href="#äº”ç¥å…µåˆ©å™¨ç©è½¬-observable-æ“ä½œç¬¦">äº”ã€ç¥å…µåˆ©å™¨â€”â€”ç©è½¬ Observable æ“ä½œç¬¦</a></li><li><a href="#å…­ä¸‡ç‰©çš†å¯-observableobservablefrom">å…­ã€ä¸‡ç‰©çš†å¯ Observableâ€”â€”Observable.from()</a></li><li><a href="#ä¸ƒèä¼šè´¯é€šå®æˆ˜åœºæ™¯æ¼”ç»ƒ">ä¸ƒã€èä¼šè´¯é€šâ€”â€”å®æˆ˜åœºæ™¯æ¼”ç»ƒ</a></li><li><a href="#å…«ç«™åœ¨å·¨äººè‚©ä¸Šæ€»ç»“ä¸å±•æœ›">å…«ã€ç«™åœ¨å·¨äººè‚©ä¸Šâ€”â€”æ€»ç»“ä¸å±•æœ›</a></li></ul></div></div><!--astro:end--></astro-island> <!-- <TagsCard client:load tags={allTags} />
          <ArchiveCard client:load postsByMonth={postsByMonth} /> --> </div> </template><!--astro:end--></astro-island> <div class="p-6">  <article class="prose dark:prose-invert max-w-none" data-astro-cid-eomsrdgo> <!-- 1. åªåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ --> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="wQqHT" component-url="/_astro/MarkdownRenderer.kxY-DVdT.js" component-export="default" renderer-url="/_astro/client.D0HLj-jK.js" props="{&quot;className&quot;:[0,&quot;md-renderer&quot;],&quot;markdown&quot;:[0,&quot;ä»Šå¤©ï¼Œè·Ÿå¤§å®¶èŠèŠä¸€ä¸ªåœ¨ Web å¹³å°â€œéš¾äº§â€å¤šå¹´ï¼Œä½†æ±Ÿæ¹–ä¸Šæ—©å·²æµä¼ å…¶ä¼ è¯´ã€ä¼—å¤šæ¡†æ¶å’Œåº“é»˜é»˜æ‹¥æŠ±çš„å®¶ä¼™â€”â€”**Observable**ã€‚\n\næ˜¯ä¸æ˜¯æ„Ÿè§‰ `addEventListener` ç”¨å¾—æœ‰ç‚¹è…»æ­ªäº†ï¼Ÿå›è°ƒåœ°ç‹±ã€æ‰‹åŠ¨ç§»é™¤ç›‘å¬ã€ç»„åˆå¤æ‚é€»è¾‘æ—¶çš„æ‰è¥Ÿè§è‚˜â€¦â€¦è¿™äº›ç—›ç‚¹ï¼Œå°±åƒé‹é‡Œçš„å°çŸ³å­ï¼Œæ—¶ä¸æ—¶ç¡Œå¾—æ…Œã€‚Observable ææ¡ˆï¼Œå°±åƒä¸€ä½èº«æ€€ç»æŠ€çš„æ­¦æ—é«˜æ‰‹ï¼Œè¯•å›¾ç”¨ä¸€ç§æ›´ä¼˜é›…ã€æ›´â€œå‡½æ•°å¼â€çš„å§¿æ€ï¼Œæ¥è§£å†³è¿™äº›å‰ç«¯äº‹ä»¶å¤„ç†çš„â€œç–‘éš¾æ‚ç—‡â€ã€‚\n\nè¿™ç¯‡æ–‡ç« ï¼Œä»å®ƒæƒ³è§£å†³çš„é—®é¢˜å‡ºå‘ï¼Œä¸€è·¯æ‰’å¼€å®ƒçš„å‰ä¸–ä»Šç”Ÿã€æ ¸å¿ƒæ¦‚å¿µã€å®æˆ˜æŠ€å·§ï¼Œæœ€åå†ä¸€èµ·ç•…æƒ³ä¸‹å®ƒçš„æœªæ¥ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿå‘è½¦ï¼\n\n## ä¸€ã€Observable çš„çµé­‚æ‹·é—®â€”â€”å®ƒåˆ°åº•æƒ³å¹²å•¥ï¼Ÿ\n\nä»»ä½•æŠ€æœ¯çš„å‡ºç°éƒ½ä¸æ˜¯ç©ºç©´æ¥é£ã€‚Observable æƒ³è§£å†³çš„æ ¸å¿ƒç—›ç‚¹ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸ä¸å¼‚æ­¥äº‹ä»¶æ‰“äº¤é“æ—¶çš„â€œä¸çˆ½â€ã€‚\n\næƒ³æƒ³çœ‹ï¼Œæˆ‘ä»¬ç”¨ `addEventListener` æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼š\n\n```ts\nconst controller = new AbortController();\nconst signal = controller.signal;\n\nfunction handleMouseMove(e) {\n  console.log(\&quot;é¼ æ ‡ç§»åŠ¨:\&quot;, e.clientX, e.clientY);\n}\n\nfunction handleMouseUp(e) {\n  console.log(\&quot;é¼ æ ‡æ¾å¼€ï¼Œåœæ­¢ç›‘å¬ç§»åŠ¨\&quot;);\n  // å…³é”®ï¼šéœ€è¦æ‰‹åŠ¨ç§»é™¤ç›‘å¬\n  element.removeEventListener(\&quot;mousemove\&quot;, handleMouseMove);\n  // å¦‚æœè¿˜æœ‰å…¶ä»–ç›‘å¬ï¼Œä¹Ÿå¾—ä¸€ä¸€ç§»é™¤...\n  document.removeEventListener(\&quot;mouseup\&quot;, handleMouseUp);\n  // æˆ–è€…ç”¨ AbortController æ‰¹é‡å–æ¶ˆï¼Œä½†è¿˜æ˜¯å¾—æ‰‹åŠ¨è°ƒç”¨ abort\n  // controller.abort();\n}\n\nelement.addEventListener(\n  \&quot;mousedown\&quot;,\n  (e) =&gt; {\n    console.log(\&quot;é¼ æ ‡æŒ‰ä¸‹ï¼Œå¼€å§‹ç›‘å¬ç§»åŠ¨å’Œæ¾å¼€\&quot;);\n    element.addEventListener(\&quot;mousemove\&quot;, handleMouseMove, { signal });\n    document.addEventListener(\&quot;mouseup\&quot;, handleMouseUp, { signal });\n  },\n  { signal },\n);\n\n// æƒ³åœ¨æŸä¸ªæ¡ä»¶ä¸‹åœæ­¢æ‰€æœ‰ç›‘å¬ï¼Ÿ\n// controller.abort();\n```\n\nè¿™æ®µä»£ç çœ¼ç†Ÿå§ï¼Ÿæ˜¯ä¸æ˜¯æœ‰å†…å‘³å„¿äº†ï¼Ÿ\n\n1.  **å‘½ä»¤å¼ (Imperative)**: ä½ å¾—ä¸€æ­¥æ­¥å‘Šè¯‰æµè§ˆå™¨â€œåšä»€ä¹ˆâ€ï¼ˆæ·»åŠ ç›‘å¬ã€ç§»é™¤ç›‘å¬ï¼‰ã€‚\n2.  **çŠ¶æ€ç®¡ç†å¤æ‚**: éœ€è¦æ‰‹åŠ¨ç®¡ç†ç›‘å¬å™¨çš„æ·»åŠ å’Œç§»é™¤ï¼Œå°¤å…¶æ˜¯æ¶‰åŠå¤šä¸ªäº‹ä»¶ã€éœ€è¦æ¡ä»¶æ€§å–æ¶ˆæ—¶ï¼Œå¾ˆå®¹æ˜“é—æ¼ï¼Œé€ æˆå†…å­˜æ³„æ¼æˆ–é€»è¾‘é”™è¯¯ã€‚\n3.  **ç»„åˆå›°éš¾**: æƒ³å®ç°â€œå½“ A äº‹ä»¶å‘ç”Ÿåï¼Œç›‘å¬ B äº‹ä»¶ï¼Œç›´åˆ° C äº‹ä»¶å‘ç”Ÿâ€è¿™ç§é€»è¾‘ï¼Œå¾€å¾€éœ€è¦åµŒå¥—å›è°ƒï¼Œä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ç›´çº¿ä¸‹é™ã€‚\n\n**Observable çš„å“²å­¦ï¼šæŠŠäº‹ä»¶æµå½“æˆä¸€ç­‰å…¬æ°‘**\n\nObservable è¯´ï¼šâ€œåˆ«é‚£ä¹ˆéº»çƒ¦äº†ï¼å’±æ¢ä¸ªæ€è·¯ã€‚â€ å®ƒå€Ÿé‰´äº†å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹çš„æ€æƒ³ï¼ŒæŠŠ**éšæ—¶é—´å‘ç”Ÿçš„ã€å¯èƒ½å¤šæ¬¡çš„äº‹ä»¶ï¼Œçœ‹ä½œæ˜¯ä¸€ä¸ªæ•°æ®æµï¼ˆStreamï¼‰**ã€‚è¿™ä¸ªæµï¼Œå°±åƒæ•°ç»„ä¸€æ ·ï¼Œä½ å¯ä»¥å¯¹å®ƒè¿›è¡Œå„ç§æ“ä½œï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€ç»„åˆâ€¦â€¦ï¼‰ï¼Œè€Œä¸”è¿™äº›æ“ä½œæ˜¯**å£°æ˜å¼ (Declarative)**çš„ã€‚\n\nä½ ä¸å†å…³å¿ƒå…·ä½“æ€ä¹ˆæ·»åŠ ã€ç§»é™¤ç›‘å¬å™¨ï¼Œè€Œæ˜¯**æè¿°**ä½ æƒ³è¦ä»€ä¹ˆæ ·çš„äº‹ä»¶æµï¼Œä»¥åŠå½“æµä¸­æœ‰æ•°æ®ï¼ˆäº‹ä»¶ï¼‰æˆ–è€…æµç»“æŸæ—¶ï¼Œä½ æƒ³åšä»€ä¹ˆã€‚\n\n**æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“ï¼š**\n\n- **å¯ç»„åˆ (Composable)**: åƒé“¾å¼è°ƒç”¨ `.filter().map()` ä¸€æ ·å¤„ç†äº‹ä»¶æµã€‚\n- **æ˜¾å¼ç»ˆæ­¢ (Explicit Termination)**: æ¸…æ™°åœ°å®šä¹‰äº‹ä»¶æµä½•æ—¶å¼€å§‹ã€ä½•æ—¶ç»“æŸï¼Œä»¥åŠç»“æŸåçš„æ¸…ç†é€»è¾‘ã€‚\n- **æ›´æ¸…æ™°çš„ä»£ç **: å£°æ˜å¼çš„ä»£ç å¾€å¾€æ›´æ˜“è¯»ã€æ›´æ˜“æ‡‚ã€‚\n\nçœ‹çœ‹ç”¨ Observable ï¼ˆå‡è®¾çš„ `.when()` APIï¼‰æ”¹å†™æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼š\n\n```ts\n// æè¿°ï¼šç›‘å¬é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œå¯¹äºæ¯æ¬¡æŒ‰ä¸‹ï¼š\nelement.when(\&quot;mousedown\&quot;).subscribe(() =&gt; {\n  console.log(\&quot;é¼ æ ‡æŒ‰ä¸‹ï¼Œå¼€å§‹ç›‘å¬ç§»åŠ¨å’Œæ¾å¼€\&quot;);\n  // æè¿°ï¼šç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼Œç›´åˆ°é¼ æ ‡æ¾å¼€äº‹ä»¶å‘ç”Ÿ\n  element\n    .when(\&quot;mousemove\&quot;)\n    .takeUntil(document.when(\&quot;mouseup\&quot;)) // å…³é”®ï¼šå£°æ˜å¼ç»ˆæ­¢\n    .subscribe({\n      next: (e) =&gt; console.log(\&quot;é¼ æ ‡ç§»åŠ¨:\&quot;, e.clientX, e.clientY),\n      complete: () =&gt; console.log(\&quot;é¼ æ ‡æ¾å¼€ï¼Œç§»åŠ¨ç›‘å¬è‡ªåŠ¨åœæ­¢\&quot;), // æµå®Œæˆ\n    });\n});\n```\n\næ˜¯ä¸æ˜¯æ„Ÿè§‰æ¸…çˆ½å¤šäº†ï¼Ÿ`takeUntil` å°±åƒç»™äº‹ä»¶æµè®¾äº†ä¸ªâ€œæˆªæ­¢é˜€â€ï¼Œä¸€æ—¦ `document` çš„ `mouseup` äº‹ä»¶å‘ç”Ÿï¼Œ`mousemove` äº‹ä»¶æµå°±è‡ªåŠ¨åœæ­¢å¹¶æ¸…ç†ï¼Œæ— éœ€æ‰‹åŠ¨ `removeEventListener`ã€‚è¿™å°±æ˜¯ Observable è§£å†³é—®é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼š**ç”¨å£°æ˜å¼çš„æ–¹å¼ï¼Œä¼˜é›…åœ°ç®¡ç†å’Œç»„åˆå¼‚æ­¥äº‹ä»¶æµã€‚**\n\n## äºŒã€å‰ä¸–ä»Šç”Ÿâ€”â€”Observable çš„â€œé•¿å¾è·¯â€\n\näº†è§£ä¸€é¡¹æŠ€æœ¯ï¼Œä¸èƒ½åªçœ‹å®ƒå…‰é²œäº®ä¸½çš„ APIï¼Œè¿˜å¾—çŸ¥é“å®ƒèƒŒåé‚£ç‚¹â€œé™ˆèŠéº»çƒ‚è°·å­â€çš„æ•…äº‹ã€‚Observable çš„è¯ç”Ÿå’Œæ ‡å‡†åŒ–ä¹‹è·¯ï¼Œå¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼Œå……æ»¡äº†æŠ€æœ¯å¤§ä½¬ä»¬çš„æ€è€ƒå’Œåšå¼ˆã€‚\n\n1.  **TC39 çš„èŒèŠ½ä¸å—æŒ«**: æœ€æ—©ï¼ŒObservable æ˜¯åœ¨ TC39ï¼ˆECMAScript æ ‡å‡†å§”å‘˜ä¼šï¼‰è¢«æå‡ºçš„ï¼ˆå¤§çº¦ 2015 å¹´ï¼‰ï¼Œç”± Ben Leshï¼ˆRxJS çš„æ ¸å¿ƒå¼€å‘è€…ï¼‰ç­‰äººæ¨åŠ¨ã€‚å½“æ—¶çš„è®¾æƒ³æ˜¯æŠŠå®ƒä½œä¸º JavaScript è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒ Promise ä¸€æ ·ã€‚ä½†ææ¡ˆåœ¨ TC39 å¡åœ¨äº† Stage 1 å¾ˆé•¿æ—¶é—´ã€‚åå¯¹çš„å£°éŸ³è®¤ä¸ºï¼ŒObservable ä¼¼ä¹æ›´åƒæ˜¯ä¸€ä¸ªâ€œåº“çº§â€çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯è¯­è¨€æ ¸å¿ƒå¿…å¤‡çš„ï¼›è€Œä¸”å®ƒæ²¡æœ‰å¼•å…¥æ–°çš„è¯­æ³•ï¼Œæ›´ä¾èµ–äº API è®¾è®¡ï¼Œè¿™è®©ä¸€äº›å§”å‘˜è§‰å¾—å®ƒä¸å¤Ÿâ€œåº•å±‚â€ã€‚\n\n2.  **è½¬æˆ˜ WHATWG**: çœ¼çœ‹ TC39 æ­¤è·¯ä¸é€šï¼Œå¤§ä½¬ä»¬ï¼ˆå°¤å…¶æ˜¯ Google å›¢é˜Ÿçš„ Ben Leshï¼‰æ”¹å˜ç­–ç•¥ï¼Œå°è¯•å°† Observable ä½œä¸º Web å¹³å°ï¼ˆDOMï¼‰çš„ä¸€éƒ¨åˆ†æ¥æ ‡å‡†åŒ–ï¼ˆå¤§çº¦ 2017 å¹´åº•ï¼Œå°±æ˜¯ GitHub Issue #544 çš„å¼€ç«¯ï¼‰ã€‚ç†ç”±æ˜¯ï¼šWeb å¹³å°å……æ»¡äº†äº‹ä»¶ï¼ˆDOM äº‹ä»¶ã€ç½‘ç»œäº‹ä»¶ç­‰ï¼‰ï¼Œ`EventTarget` æ˜¯äº‹å®æ ‡å‡†ï¼ŒObservable ä¸ `EventTarget` ç»“åˆèƒ½å‘æŒ¥æœ€å¤§ä»·å€¼ï¼Œè§£å†³ Web å¼€å‘è€…çš„å®é™…ç—›ç‚¹ã€‚è¿™ä¼¼ä¹æ›´æœ‰è¯´æœåŠ›ã€‚\n\n3.  **æ¼«é•¿çš„è®¨è®ºä¸æ¼”è¿›**: åœ¨ WHATWG çš„è®¨è®ºï¼ˆIssue #544 é‡Œå¯ä»¥çœ‹åˆ°å¤§é‡è®¨è®ºç»†èŠ‚ï¼‰ä¸­ï¼ŒAPI çš„å½¢æ€ä¹Ÿå‡ ç»å˜åŒ–ï¼š\n    - æœ€åˆå« `on()`ï¼Œåæ¥ä¸ºäº†é¿å…ä¸ç°æœ‰å±æ€§å†²çªæˆ–æ­§ä¹‰ï¼Œæ”¹æˆäº† `when()`ã€‚\n    - å…³äº `subscribe()` æ–¹æ³•çš„å‚æ•°å½¢æ€ï¼ˆå‡½æ•°é‡è½½ vs. å¯¹è±¡ï¼‰ï¼ŒWeb IDL çš„é™åˆ¶å¼•å‘äº†è®¨è®ºï¼ˆDomenic çš„è§£é‡Šï¼‰ã€‚\n    - `preventDefault()` çš„é—®é¢˜è¢«åå¤æåŠï¼ˆAnne van Kesteren ç­‰äººæå‡ºï¼‰ï¼Œå› ä¸º Promise çš„å¾®ä»»åŠ¡è°ƒåº¦æœºåˆ¶å¯èƒ½å¯¼è‡´åœ¨ `then()` ä¸­è°ƒç”¨ `preventDefault()` å¤±æ•ˆï¼Œè¿™ä¿ƒä½¿å¤§å®¶æ€è€ƒåŒæ­¥æ‰§è¡Œçš„é‡è¦æ€§ã€‚\n    - ä¸ `AbortController`/`AbortSignal` çš„é›†æˆï¼Œæˆä¸ºå–æ¶ˆè®¢é˜…ï¼ˆunsubscriptionï¼‰çš„æ ‡å‡†æ–¹å¼ï¼Œè¿™å¤§å¤§å¢å¼ºäº†å®ƒçš„å®ç”¨æ€§ã€‚\n\n4.  **ç”¨æˆ·æ€çš„ç¹è£**: æ ‡å‡†åŒ–è¿›å±•ç¼“æ…¢ï¼Œä½†æŒ¡ä¸ä½äººæ°‘ç¾¤ä¼—ï¼ˆå¼€å‘è€…ï¼‰çš„éœ€æ±‚å•Šï¼ä»¥ RxJS ä¸ºé¦–çš„å„ç§ Observable å®ç°åº“åœ¨ç¤¾åŒºå¤§è¡Œå…¶é“ï¼Œæ¯å‘¨å‡ åƒä¸‡ç”šè‡³ä¸Šäº¿çš„ä¸‹è½½é‡ï¼ˆREADME ä¸­ Ben Lesh æåˆ° RxJS æ¯å‘¨ 4700 ä¸‡+ä¸‹è½½é‡ï¼‰ï¼Œä»¥åŠä¼—å¤šæ¡†æ¶ï¼ˆAngularã€Vue (vue-rx)ã€Svelteã€XState ç­‰ï¼‰å¯¹ Observable çš„å†…ç½®æ”¯æŒæˆ–è‰¯å¥½é›†æˆï¼Œéƒ½è¯æ˜äº†å…¶ä»·å€¼å’Œå¼€å‘è€…å¯¹å…¶çš„ä¾èµ–ã€‚è¿™åè¿‡æ¥ä¹Ÿç»™æ ‡å‡†åŒ–æä¾›äº†å¼ºå¤§çš„åŠ¨åŠ›å’Œäº‹å®ä¾æ®â€”â€”å¤§å®¶éƒ½è¿™ä¹ˆç”¨äº†ï¼Œæ ‡å‡†æ˜¯ä¸æ˜¯è¯¥è·Ÿä¸Šäº†ï¼Ÿ\n\n5.  **WICG çš„å†å‡ºå‘**: ç›®å‰ï¼ŒObservable çš„æ ‡å‡†åŒ–å·¥ä½œä¸»è¦åœ¨ WICGï¼ˆWeb Platform Incubator Community Groupï¼‰è¿›è¡Œï¼Œç”± Dominic Farolino (Google) ç­‰äººç»§ç»­æ¨è¿›ã€‚ç›®æ ‡æ˜¯å¸å–è¿‡å»çš„ç»éªŒæ•™è®­ï¼Œæ•´åˆç¤¾åŒºçš„æœ€ä½³å®è·µï¼Œæœ€ç»ˆæ‹¿å‡ºä¸€ä¸ªæµè§ˆå™¨å‚å•†æ„¿æ„å®ç°ã€å¼€å‘è€…ç”¨ç€é¡ºæ‰‹çš„æ ‡å‡† APIã€‚\n\nå¯ä»¥è¯´ï¼ŒObservable çš„å†å²ï¼Œå°±æ˜¯ä¸€éƒ¨åœ¨è¯­è¨€æ ¸å¿ƒä¸å¹³å°ç‰¹æ€§ä¹‹é—´ä¸æ–­æ¢ç´¢ã€åœ¨ç¤¾åŒºå®è·µä¸æ ‡å‡†åŒ–åšå¼ˆä¹‹é—´ä¸æ–­æ¼”è¿›çš„å†å²ã€‚\n\n## ä¸‰ã€å°è¯•ç‰›åˆ€â€”â€”`EventTarget.when()` åˆä½“éªŒ\n\nè¯´äº†è¿™ä¹ˆå¤šèƒŒæ™¯ï¼Œæ˜¯æ—¶å€™ä¸Šæ‰‹æ„Ÿå—ä¸€ä¸‹äº†ã€‚Observable ææ¡ˆçš„æ ¸å¿ƒå…¥å£ï¼Œå°±æ˜¯ç»™ `EventTarget` (æˆ‘ä»¬ç†Ÿæ‚‰çš„ `element`, `document`, `window` ç­‰çš„è€ç¥–å®—) æ·»åŠ äº†ä¸€ä¸ªæ–°æ–¹æ³•ï¼š`.when()`ã€‚\n\n`.when(eventType, options)` æ–¹æ³•è¿”å›ä¸€ä¸ª Observable å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†æŒ‡å®šç±»å‹çš„äº‹ä»¶æµã€‚\n\n**åŸºç¡€ç”¨æ³•ï¼šæ›¿ä»£ `addEventListener`**\n\n```ts\nconst clicks = element.when(\&quot;click\&quot;); // è¿”å›ä¸€ä¸ªä»£è¡¨ç‚¹å‡»äº‹ä»¶çš„ Observable\n\n// è®¢é˜…è¿™ä¸ª Observableï¼Œå¼€å§‹ç›‘å¬\nconst subscription = clicks.subscribe({\n  next: (event) =&gt; {\n    // æ¯å½“ç‚¹å‡»äº‹ä»¶å‘ç”Ÿï¼Œnext å›è°ƒè¢«è§¦å‘\n    console.log(\&quot;Element clicked!\&quot;, event.target);\n  },\n  error: (err) =&gt; {\n    // å¦‚æœ Observable å†…éƒ¨å‡ºé”™ï¼ˆè™½ç„¶ DOM äº‹ä»¶ä¸€èˆ¬ä¸ä¼šï¼‰\n    console.error(\&quot;Something went wrong:\&quot;, err);\n  },\n  complete: () =&gt; {\n    // å¦‚æœäº‹ä»¶æµæ­£å¸¸ç»“æŸï¼ˆDOM äº‹ä»¶æµé€šå¸¸ä¸ä¼šè‡ªç„¶ç»“æŸï¼‰\n    console.log(\&quot;Click stream completed.\&quot;);\n  },\n});\n\n// æƒ³åœæ­¢ç›‘å¬ï¼Ÿå–æ¶ˆè®¢é˜…å³å¯\n// subscription.abort(); // å‡è®¾ subscribe è¿”å›å¸¦æœ‰ abort æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨ AbortSignal\n```\n\n**é“¾å¼æ“ä½œï¼šè¿‡æ»¤ä¸æ˜ å°„**\n\nè¿™æ‰æ˜¯ Observable çš„é­…åŠ›æ‰€åœ¨ï¼å‡è®¾æˆ‘ä»¬åªæƒ³å¤„ç†ç‚¹å‡»åˆ°ç‰¹å®šå­å…ƒç´  `.foo` çš„äº‹ä»¶ï¼Œå¹¶ä¸”åªå…³å¿ƒç‚¹å‡»çš„åæ ‡ï¼š\n\n```ts\nelement\n  .when(\&quot;click\&quot;)\n  .filter((e) =&gt; e.target.matches(\&quot;.foo\&quot;)) // è¿‡æ»¤ï¼šåªä¿ç•™ç›®æ ‡åŒ¹é… &#39;.foo&#39; çš„äº‹ä»¶\n  .map((e) =&gt; ({ x: e.clientX, y: e.clientY })) // æ˜ å°„ï¼šå°†äº‹ä»¶å¯¹è±¡è½¬æ¢ä¸ºåæ ‡å¯¹è±¡\n  .subscribe({\n    next: (point) =&gt; {\n      // è¿™é‡Œæ”¶åˆ°çš„å°±æ˜¯åæ ‡å¯¹è±¡äº†\n      console.log(\&quot;Clicked on .foo at:\&quot;, point);\n      handleClickAtPoint(point); // è°ƒç”¨ä½ çš„å¤„ç†å‡½æ•°\n    },\n  });\n```\n\nå¯¹æ¯”ä¸€ä¸‹ç”¨ `addEventListener` å®ç°ç›¸åŒé€»è¾‘ï¼š\n\n```ts\nelement.addEventListener(\&quot;click\&quot;, (e) =&gt; {\n  if (e.target.matches(\&quot;.foo\&quot;)) {\n    const point = { x: e.clientX, y: e.clientY };\n    console.log(\&quot;Clicked on .foo at:\&quot;, point);\n    handleClickAtPoint(point);\n  }\n});\n// æ¸…ç†ï¼Ÿè¿˜å¾—æ‰‹åŠ¨ removeEventListener...\n```\n\næ˜¯ä¸æ˜¯é«˜ä¸‹ç«‹åˆ¤ï¼ŸObservable çš„é“¾å¼è°ƒç”¨ï¼ŒæŠŠäº‹ä»¶çš„å¤„ç†æµç¨‹ï¼ˆè¿‡æ»¤ã€è½¬æ¢ï¼‰æ¸…æ™°åœ°è¡¨è¾¾äº†å‡ºæ¥ï¼Œä»£ç æ›´å…·å£°æ˜æ€§ã€‚\n\n## å››ã€ç™»å ‚å…¥å®¤â€”â€”æ ¸å¿ƒ Observable API ä¸æ¦‚å¿µ\n\nè¦çœŸæ­£æŒæ¡ Observableï¼Œå…‰ä¼šç”¨ `.when()` è¿˜ä¸å¤Ÿï¼Œå¾—æ·±å…¥ç†è§£å…¶æ ¸å¿ƒ API å’Œè¿ä½œæœºåˆ¶ã€‚\n\n**1. `new Observable(subscribeFn)` æ„é€ å‡½æ•°**\n\nè™½ç„¶ææ¡ˆçš„æ ¸å¿ƒæ˜¯é›†æˆ `EventTarget`ï¼Œä½† Observable æœ¬èº«ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºã€‚æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª**è®¢é˜…å‡½æ•° (subscribe function)** `subscribeFn` ä½œä¸ºå‚æ•°ã€‚\n\n```ts\nconst myObservable = new Observable((subscriber) =&gt; {\n  // è¿™ä¸ªå‡½æ•°åœ¨æ¯æ¬¡è°ƒç”¨ myObservable.subscribe() æ—¶æ‰§è¡Œ\n  console.log(\&quot;Subscription started!\&quot;);\n  let i = 0;\n  const intervalId = setInterval(() =&gt; {\n    if (i &lt; 5) {\n      subscriber.next(i++); // å‘é€ä¸‹ä¸€ä¸ªå€¼\n    } else {\n      subscriber.complete(); // å‘é€å®Œæˆä¿¡å·ï¼Œæµç»“æŸ\n      clearInterval(intervalId);\n    }\n  }, 1000);\n\n  // --- æ¸…ç†é€»è¾‘ (Teardown) ---\n  // è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–ä½¿ç”¨ subscriber.addTeardown()\n  // è¿™ä¸ªå‡½æ•°ä¼šåœ¨å–æ¶ˆè®¢é˜…æˆ–æµå®Œæˆ/é”™è¯¯æ—¶æ‰§è¡Œ\n  const teardown = () =&gt; {\n    console.log(\&quot;Subscription teardown: Clearing interval.\&quot;);\n    clearInterval(intervalId);\n  };\n  subscriber.addTeardown(teardown); // æ¨èæ–¹å¼\n\n  // æˆ–è€… return teardown; // è€å¼ API å¯èƒ½è¿™æ ·\n});\n\nconsole.log(\&quot;Observable created.\&quot;);\n\nconst subscription = myObservable.subscribe({\n  next: (value) =&gt; console.log(\&quot;Received:\&quot;, value),\n  complete: () =&gt; console.log(\&quot;Stream complete!\&quot;),\n  error: (err) =&gt; console.error(\&quot;Stream error:\&quot;, err),\n});\n\nconsole.log(\&quot;Subscribed.\&quot;);\n\n// ç¨åå–æ¶ˆè®¢é˜…\nsetTimeout(() =&gt; {\n  console.log(\&quot;Aborting subscription...\&quot;);\n  subscription.abort(); // å‡è®¾è¿”å›çš„å¯¹è±¡æœ‰ abort æˆ–ä½¿ç”¨ signal\n}, 3500);\n```\n\n**å…³é”®ç‚¹ï¼š**\n\n- **è®¢é˜…å‡½æ•° (`subscribeFn`)**: å®šä¹‰äº†å½“æœ‰äººè®¢é˜…æ—¶ï¼Œå¦‚ä½•äº§ç”Ÿæ•°æ®å¹¶å‘ç»™è®¢é˜…è€… (`subscriber`)ã€‚\n- **è®¢é˜…è€… (`subscriber`)**: ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ `next()`, `error()`, `complete()` æ–¹æ³•ï¼Œç”¨æ¥æ¥æ”¶ Observable å‘å‡ºçš„ä¿¡å·ã€‚è¿˜æœ‰ä¸€ä¸ª `addTeardown()` æ–¹æ³•æ³¨å†Œæ¸…ç†é€»è¾‘ã€‚\n- **æƒ°æ€§æ‰§è¡Œ (Lazy Execution)**: `new Observable(...)` åªæ˜¯åˆ›å»ºäº†è“å›¾ï¼Œ`subscribeFn` é‡Œé¢çš„ä»£ç ï¼ˆæ¯”å¦‚ `setInterval`ï¼‰åœ¨è°ƒç”¨ `.subscribe()` ä¹‹å‰**ä¸ä¼š**æ‰§è¡Œã€‚åªæœ‰å½“ `.subscribe()` è¢«è°ƒç”¨æ—¶ï¼Œè®¢é˜…æµç¨‹æ‰çœŸæ­£å¼€å§‹ã€‚å¯ä»¥å¤šæ¬¡è°ƒç”¨ `.subscribe()`ï¼Œæ¯æ¬¡éƒ½ä¼šç‹¬ç«‹æ‰§è¡Œä¸€æ¬¡ `subscribeFn`ã€‚\n- **æ¸…ç†é€»è¾‘ (Teardown)**: è¿™æ˜¯ Observable çš„ç²¾é«“ä¹‹ä¸€ï¼`subscribeFn` å¿…é¡»æä¾›ä¸€ç§æ–¹å¼æ¥æ¸…ç†å®ƒæ‰€å ç”¨çš„èµ„æºï¼ˆæ¯”å¦‚æ¸…é™¤å®šæ—¶å™¨ã€ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€å…³é—­ WebSocket è¿æ¥ç­‰ï¼‰ã€‚è¿™é€šè¿‡ `subscriber.addTeardown()` æ³¨å†Œï¼Œç¡®ä¿åœ¨è®¢é˜…è¢«å–æ¶ˆ (`abort()`) æˆ–æµè‡ªç„¶ç»“æŸ (`complete()` æˆ– `error()`) æ—¶ï¼Œèµ„æºèƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚è¿™è§£å†³äº† `addEventListener` éœ€è¦æ‰‹åŠ¨ `removeEventListener` çš„ç—›ç‚¹ã€‚\n\n**2. åŒæ­¥ä¸å¼‚æ­¥ä¼ é€’ (Synchronous &amp; Asynchronous Delivery)**\n\n- **åŒæ­¥æ€§**: ä¸ Promise ä¸åŒï¼ˆPromise çš„ `.then` å›è°ƒæ€»æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ï¼ŒObservable çš„ `subscriber.next()` è°ƒç”¨**å¯ä»¥æ˜¯åŒæ­¥çš„**ã€‚è¿™æ„å‘³ç€ï¼Œå½“äº‹ä»¶æºï¼ˆå¦‚ `element.click()`ï¼‰åŒæ­¥è§¦å‘äº‹ä»¶æ—¶ï¼Œ`.when(&#39;click&#39;).subscribe({ next: ... })` ä¸­çš„ `next` å›è°ƒä¹Ÿå¯èƒ½**åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ tick ä¸­åŒæ­¥æ‰§è¡Œ**ã€‚\n  - **é‡è¦æ€§**: è¿™å¯¹äºéœ€è¦ç«‹å³å“åº”å¹¶å¯èƒ½è°ƒç”¨ `event.preventDefault()` çš„åœºæ™¯è‡³å…³é‡è¦ã€‚å¦‚æœåƒ Promise é‚£æ ·æ€»æ˜¯å¼‚æ­¥ï¼Œ`preventDefault()` å¯èƒ½å°±å¤ªæ™šäº†ï¼ˆå°¤å…¶æ˜¯åœ¨è„šæœ¬è§¦å‘äº‹ä»¶æ—¶ï¼Œå¦‚ `element.click()`ï¼‰ã€‚è¿™æ˜¯ Observable ç›¸è¾ƒäºåŸºäº Promise çš„äº‹ä»¶å¤„ç†ï¼ˆå¦‚ `element.on(&#39;click&#39;, async () =&gt; ...)` æˆ–ä¸€äº› Promise-returning æ“ä½œç¬¦ï¼‰çš„å…³é”®ä¼˜åŠ¿ä¹‹ä¸€ã€‚\n- **å¼‚æ­¥æ€§**: å½“ç„¶ï¼ŒObservable ä¹Ÿå¯ä»¥å¼‚æ­¥å‘é€æ•°æ®ï¼Œæ¯”å¦‚ä¸Šé¢ `setInterval` çš„ä¾‹å­ã€‚\n\n**3. `AbortController` ä¸å–æ¶ˆè®¢é˜…**\n\nç°ä»£ Observable ææ¡ˆç´§å¯†æ‹¥æŠ±äº† Web å¹³å°çš„ `AbortController` å’Œ `AbortSignal`ã€‚\n\n- **å¤–éƒ¨å–æ¶ˆ**: è°ƒç”¨ `.subscribe(observer, { signal })` æ—¶ä¼ å…¥ä¸€ä¸ª `AbortSignal`ã€‚å½“è¿™ä¸ª `signal` è¢« `abort()` æ—¶ï¼Œè®¢é˜…ä¼šè‡ªåŠ¨å–æ¶ˆï¼Œå¹¶è§¦å‘ teardown é€»è¾‘ã€‚\n- **å†…éƒ¨å–æ¶ˆ/Teardown**: `subscriber` å¯¹è±¡å†…éƒ¨é€šå¸¸ä¼šå…³è”ä¸€ä¸ª `AbortSignal` (`subscriber.signal`)ï¼Œ`subscribeFn` å¯ä»¥ç›‘å¬è¿™ä¸ª signalï¼Œä»¥ä¾¿åœ¨è®¢é˜…è¢«å–æ¶ˆæ—¶åŠæ—¶åœæ­¢å·¥ä½œã€‚`addTeardown` æ³¨å†Œçš„å‡½æ•°ä¹Ÿä¼šåœ¨è¿™ä¸ª signal è¢« abort æ—¶è°ƒç”¨ã€‚\n\n```ts\n// ä¾‹å­ï¼šåŒæ­¥â€œæ•°æ®æ´ªæµâ€ä¸ AbortController\nconst syncObservable = new Observable((subscriber) =&gt; {\n  let i = 0;\n  try {\n    while (true) {\n      subscriber.next(i++);\n      // æ£€æŸ¥è®¢é˜…æ˜¯å¦å·²è¢«å¤–éƒ¨å–æ¶ˆ\n      if (subscriber.signal.aborted) {\n        console.log(\&quot;Subscription aborted internally, breaking loop.\&quot;);\n        break;\n      }\n    }\n  } finally {\n    // ç¡®ä¿æ¸…ç†é€»è¾‘è¢«è°ƒç”¨\n    console.log(\&quot;Sync observable teardown.\&quot;);\n  }\n  // æ³¨æ„ï¼šåŒæ­¥ Observable é€šå¸¸åœ¨å¾ªç¯ç»“æŸåæ‰ complete/error\n  // subscriber.complete(); // å¯èƒ½ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œå¦‚æœè¢« abort\n});\n\nconst controller = new AbortController();\nsyncObservable.subscribe(\n  {\n    next: (data) =&gt; {\n      console.log(\&quot;Sync data:\&quot;, data);\n      if (data &gt; 100) {\n        console.log(\&quot;Data &gt; 100, aborting...\&quot;);\n        controller.abort(); // ä»å¤–éƒ¨å–æ¶ˆè®¢é˜…\n      }\n    },\n    complete: () =&gt; console.log(\&quot;Sync complete.\&quot;), // å¯èƒ½ä¸ä¼šè¢«è°ƒç”¨\n    error: (err) =&gt; console.error(\&quot;Sync error:\&quot;, err),\n  },\n  { signal: controller.signal },\n); // ä¼ å…¥ signal\n```\n\n## äº”ã€ç¥å…µåˆ©å™¨â€”â€”ç©è½¬ Observable æ“ä½œç¬¦\n\nå¦‚æœè¯´ Observable å¯¹è±¡æ˜¯å†…åŠŸå¿ƒæ³•ï¼Œé‚£æ“ä½œç¬¦ (Operators) å°±æ˜¯å„å¼å„æ ·çš„æ­¦åŠŸæ‹›å¼ã€‚å®ƒä»¬æ˜¯è®© Observable å˜å¾—å¼ºå¤§å’Œçµæ´»çš„å…³é”®ã€‚æ“ä½œç¬¦æœ¬è´¨ä¸Šæ˜¯å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ª Observableï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Observableï¼Œä¸­é—´å¯¹æ•°æ®æµè¿›è¡Œå¤„ç†ã€‚\n\nææ¡ˆä¸­å»ºè®®å†…ç½®ä¸€äº›æ ¸å¿ƒä¸”å¸¸ç”¨çš„æ“ä½œç¬¦ï¼Œå¾ˆå¤šéƒ½å€Ÿé‰´è‡ªæ•°ç»„æ–¹æ³•æˆ– TC39 çš„ Iterator Helpers ææ¡ˆï¼Œä¿æŒäº†å¹³å° API çš„ä¸€è‡´æ€§ã€‚\n\n**åˆ†ç±»æ¥çœ‹ï¼š**\n\n1.  **åˆ›å»ºå‹ (Creation)**:\n    - `new Observable()`: åŸºç¡€æ„é€ å™¨ã€‚\n    - `Observable.from()`: ä»å…¶ä»–ç±»å‹è½¬æ¢ï¼ˆåé¢ç»†è¯´ï¼‰ã€‚\n    - `EventTarget.when()`: ä» DOM äº‹ä»¶åˆ›å»ºã€‚\n\n2.  **è½¬æ¢å‹ (Transformation)**:\n    - `map(fn)`: å¯¹æµä¸­çš„æ¯ä¸ªå€¼åº”ç”¨å‡½æ•° `fn`ï¼Œå‘å‡ºè½¬æ¢åçš„å€¼ã€‚\n      ```ts\n      source.map((x) =&gt; x * 2); // æŠŠæ¯ä¸ªå€¼ä¹˜ä»¥ 2\n      ```\n    - `filter(fn)`: åªå‘å‡ºæµä¸­æ»¡è¶³æ¡ä»¶ `fn(value)` ä¸º `true` çš„å€¼ã€‚\n      ```ts\n      source.filter((x) =&gt; x % 2 === 0); // åªä¿ç•™å¶æ•°\n      ```\n    - `flatMap(fn)` / `switchMap(fn)`: `map` çš„å‡çº§ç‰ˆã€‚`fn` éœ€è¦è¿”å›ä¸€ä¸ª Observableã€‚`flatMap` ä¼šè®¢é˜…æ‰€æœ‰è¿”å›çš„å†…éƒ¨ Observable å¹¶åˆå¹¶å®ƒä»¬çš„è¾“å‡ºï¼›`switchMap` åˆ™åªå…³å¿ƒæœ€æ–°çš„å†…éƒ¨ Observableï¼Œå½“å¤–éƒ¨ Observable å‘å‡ºæ–°å€¼æ—¶ï¼Œä¼šå–æ¶ˆè®¢é˜…ä¸Šä¸€ä¸ªå†…éƒ¨ Observableã€‚å¸¸ç”¨äºå¤„ç†å¼‚æ­¥è¯·æ±‚ï¼ˆå¦‚æœç´¢å»ºè®®ï¼‰ã€‚\n      ```ts\n      // æ¯æ¬¡è¾“å…¥ï¼Œå‘èµ·è¯·æ±‚ï¼Œä½†åªå…³å¿ƒæœ€æ–°è¾“å…¥çš„ç»“æœ\n      inputElement\n        .when(\&quot;input\&quot;)\n        .switchMap((e) =&gt;\n          Observable.from(fetch(`/api/search?q=${e.target.value}`)),\n        )\n        .subscribe((results) =&gt; updateUI(results));\n      ```\n\n3.  **è¿‡æ»¤/é™åˆ¶å‹ (Filtering/Limiting)**:\n    - `take(n)`: åªå–æµä¸­çš„å‰ `n` ä¸ªå€¼ï¼Œç„¶åå®Œæˆã€‚\n    - `drop(n)`: è·³è¿‡æµä¸­çš„å‰ `n` ä¸ªå€¼ã€‚\n    - `takeUntil(notifierObservable)`: æŒç»­å‘å‡ºå€¼ï¼Œç›´åˆ° `notifierObservable` å‘å‡ºç¬¬ä¸€ä¸ªå€¼æˆ–å®Œæˆ/é”™è¯¯ï¼Œç„¶åå®Œæˆã€‚è¿™æ˜¯å®ç°**å£°æ˜å¼å–æ¶ˆ**çš„å…³é”®ï¼å¸¸ç”¨äºæ‹–æ‹½ã€æ¸¸æˆåºåˆ—ç­‰ã€‚\n      ```ts\n      // æ‹–æ‹½ç¤ºä¾‹\n      mousedown$\n        .flatMap(() =&gt; mousemove$.takeUntil(mouseup$))\n        .subscribe((pos) =&gt; updateElementPosition(pos));\n      ```\n    - `filter(fn)`: (å‰é¢å·²æ)\n\n4.  **ç»„åˆå‹ (Combination)**: (ææ¡ˆåˆæœŸå¯èƒ½ä¸åŒ…å«ï¼Œä½† userland å¸¸è§)\n    - `merge(obs1, obs2, ...)`: åˆå¹¶å¤šä¸ªæµï¼Œä»»ä½•ä¸€ä¸ªæµå‘å€¼éƒ½å‘å‡ºã€‚\n    - `concat(obs1, obs2, ...)`: æŒ‰é¡ºåºè¿æ¥å¤šä¸ªæµï¼Œç­‰å‰ä¸€ä¸ªå®Œæˆåå†è®¢é˜…ä¸‹ä¸€ä¸ªã€‚\n    - `zip(obs1, obs2, ...)`: å°†å¤šä¸ªæµçš„å€¼æŒ‰é¡ºåºé…å¯¹å‘å‡ºã€‚\n\n5.  **èšåˆ/ç»ˆæ­¢å‹ (Aggregation/Termination)**: è¿™ç±»æ“ä½œç¬¦é€šå¸¸ä¼šæ¶ˆè´¹æ•´ä¸ªï¼ˆæˆ–éƒ¨åˆ†ï¼‰æµï¼Œå¹¶è¿”å›ä¸€ä¸ª**Promise**ã€‚\n    - `reduce(fn, initialValue)`: ç±»ä¼¼æ•°ç»„çš„ reduceï¼Œå¯¹æµä¸­æ‰€æœ‰å€¼è¿›è¡Œç´¯åŠ è®¡ç®—ï¼Œæµå®Œæˆå Promise resolve æœ€ç»ˆç»“æœã€‚\n      ```ts\n      // è®¡ç®—é¼ æ ‡æŒ‰ä¸‹æœŸé—´ Y åæ ‡æœ€å¤§å€¼ (Example 4 from README)\n      const maxY = await element\n        .when(\&quot;mousemove\&quot;)\n        .takeUntil(element.when(\&quot;mouseup\&quot;))\n        .map((e) =&gt; e.clientY)\n        .reduce((max, y) =&gt; Math.max(max, y), 0);\n      ```\n    - `toArray()`: æ”¶é›†æµä¸­æ‰€æœ‰å€¼åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œæµå®Œæˆå Promise resolve è¿™ä¸ªæ•°ç»„ã€‚\n    - `forEach(fn)`: å¯¹æµä¸­æ¯ä¸ªå€¼æ‰§è¡Œ `fn`ï¼Œæµå®Œæˆå Promise resolve `undefined`ã€‚\n    - `first()` / `last()`: è·å–ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªå€¼ï¼Œç„¶åå®Œæˆæµï¼ŒPromise resolve è¯¥å€¼ã€‚\n    - `find(fn)` / `some(fn)` / `every(fn)`: ç±»ä¼¼æ•°ç»„æ–¹æ³•ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„/æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„/æ˜¯å¦æ‰€æœ‰éƒ½æ»¡è¶³æ¡ä»¶ï¼ŒPromise resolve ç»“æœã€‚\n\n**âš ï¸ `preventDefault` çš„å†æ¬¡è­¦ç¤º**\n\nå¯¹äºä¸Šé¢é‚£äº›**è¿”å› Promise** çš„èšåˆ/ç»ˆæ­¢å‹æ“ä½œç¬¦ï¼ˆå¦‚ `reduce`, `find`, `first` ç­‰ï¼‰ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ `preventDefault()` çš„é—®é¢˜ï¼\n\n```ts\n// æ½œåœ¨é—®é¢˜ä»£ç \nelement\n  .when(\&quot;click\&quot;)\n  .first()\n  .then((e) =&gt; {\n    // è¿™ä¸ª then å›è°ƒæ˜¯å¼‚æ­¥ï¼ˆå¾®ä»»åŠ¡ï¼‰æ‰§è¡Œçš„\n    e.preventDefault(); // å¯¹äºè„šæœ¬è§¦å‘çš„ clickï¼Œè¿™é‡Œå¯èƒ½å¤ªæ™šäº†ï¼\n  });\n```\n\nå› ä¸º `.then()` çš„å›è°ƒæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœ `click` äº‹ä»¶æ˜¯ç”±è„šæœ¬ï¼ˆå¦‚ `element.click()`ï¼‰åŒæ­¥è§¦å‘çš„ï¼Œäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºå¯èƒ½åœ¨ `then()` å›è°ƒæ‰§è¡Œå‰å°±å·²ç»å‘ç”Ÿäº†ï¼Œå¯¼è‡´ `preventDefault()` æ— æ•ˆã€‚\n\n**è§£å†³æ–¹æ¡ˆï¼š** åœ¨ Promise äº§ç”Ÿä¹‹å‰ï¼ŒåŒæ­¥åœ°å¤„ç† `preventDefault`ã€‚\n\n```ts\n// æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ map åŒæ­¥å¤„ç†\nelement.when(&#39;click&#39;)\n  .map(e =&gt; {\n    e.preventDefault(); // åœ¨ map ä¸­åŒæ­¥è°ƒç”¨\n    return e; // ä»ç„¶ä¼ é€’äº‹ä»¶å¯¹è±¡\n  })\n  .first() // first ç°åœ¨æ¥æ”¶çš„æ˜¯å·²ç»é˜»æ­¢äº†é»˜è®¤è¡Œä¸ºçš„äº‹ä»¶\n  .then(e =&gt; {\n    // åšå…¶ä»–äº‹æƒ…...\n  });\n\n// æ–¹æ¡ˆäºŒï¼šå¦‚æœææ¡ˆæ”¯æŒ .do() æˆ– tap() æ“ä½œç¬¦ (çº¯å‰¯ä½œç”¨)\nelement.when(&#39;click&#39;)\n  .do(e =&gt; e.preventDefault()) // åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨\n  .first()\n  .then(e =&gt; { ... });\n\n// æ–¹æ¡ˆä¸‰ï¼šå¦‚æœ first() æ”¯æŒä¼ å…¥å›è°ƒ (æ›´ç‰¹å®š)\nelement.when(&#39;click&#39;)\n  .first(e =&gt; e.preventDefault()) // åœ¨ first å†…éƒ¨åŒæ­¥å¤„ç†\n  .then(e =&gt; { ... });\n```\n\nè¿™æ˜¯ä½¿ç”¨ Observable æ—¶éœ€è¦ç‰¢è®°çš„ä¸€ä¸ªé‡è¦ç»†èŠ‚ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ RxJS ç­‰åº“ä¸­å·²å­˜åœ¨å¤šå¹´ï¼Œç¤¾åŒºå·²ç»ä¹ æƒ¯å¹¶æ‰¾åˆ°äº†åº”å¯¹æ–¹æ³•ï¼Œæ‰€ä»¥ä¸å¿…è¿‡äºææ…Œã€‚\n\n## å…­ã€ä¸‡ç‰©çš†å¯ Observableâ€”â€”`Observable.from()`\n\nä¸ºäº†è®© Observable èƒ½æ›´å¥½åœ°èå…¥ç°æœ‰ç”Ÿæ€ï¼Œææ¡ˆæä¾›äº† `Observable.from()` é™æ€æ–¹æ³•ï¼Œå¯ä»¥å°†å¤šç§ç±»å‹çš„å€¼è½¬æ¢æˆ Observableï¼š\n\n```ts\n// 1. ä» Promise åˆ›å»º\nconst promise = fetch(\&quot;/api/data\&quot;).then((res) =&gt; res.json());\nconst promiseObservable = Observable.from(promise);\npromiseObservable.subscribe({\n  next: (data) =&gt; console.log(\&quot;Data from promise:\&quot;, data), // Promise resolve æ—¶è§¦å‘ next å’Œ complete\n  error: (err) =&gt; console.error(\&quot;Fetch error:\&quot;, err), // Promise reject æ—¶è§¦å‘ error\n});\n\n// 2. ä»æ•°ç»„ (Iterable) åˆ›å»º\nconst array = [1, 2, 3];\nconst arrayObservable = Observable.from(array);\narrayObservable.subscribe({\n  next: (value) =&gt; console.log(\&quot;Value from array:\&quot;, value), // åŒæ­¥ä¾æ¬¡å‘å‡º 1, 2, 3\n  complete: () =&gt; console.log(\&quot;Array stream complete.\&quot;),\n});\n\n// 3. ä»å¼‚æ­¥è¿­ä»£å™¨ (AsyncIterable) åˆ›å»º (ä¾‹å¦‚ ReadableStream)\nasync function* asyncGenerator() {\n  yield \&quot;a\&quot;;\n  await new Promise((resolve) =&gt; setTimeout(resolve, 100));\n  yield \&quot;b\&quot;;\n}\nconst asyncObservable = Observable.from(asyncGenerator());\nasyncObservable.subscribe({\n  next: (value) =&gt; console.log(\&quot;Value from async iterable:\&quot;, value), // å¼‚æ­¥å‘å‡º &#39;a&#39;, &#39;b&#39;\n  complete: () =&gt; console.log(\&quot;Async stream complete.\&quot;),\n});\n\n// 4. ä»å¦ä¸€ä¸ª Observable åˆ›å»º (å¹‚ç­‰)\nconst source = Observable.from([10, 20]);\nconst sameObservable = Observable.from(source); // ç›´æ¥è¿”å› source\n```\n\nè¿™ä¸ª `from()` æ–¹æ³•æå¤§åœ°å¢å¼ºäº† Observable çš„é€šç”¨æ€§ï¼Œè®©å®ƒå¯ä»¥æ–¹ä¾¿åœ°æ¡¥æ¥å…¶ä»–å¼‚æ­¥æ¨¡å¼ã€‚\n\n## ä¸ƒã€èä¼šè´¯é€šâ€”â€”å®æˆ˜åœºæ™¯æ¼”ç»ƒ\n\nç†è®ºè¯´äº†ä¸å°‘ï¼Œæ¥çœ‹å‡ ä¸ªæ›´æ¥è¿‘çœŸå®ä¸–ç•Œçš„ä¾‹å­ï¼Œæ„Ÿå— Observable çš„å¨åŠ›ã€‚\n\n**åœºæ™¯ 1ï¼šWebSocket æ¶ˆæ¯å¤šè·¯å¤ç”¨ (Multiplexing)** (æ¥è‡ªå®˜æ–¹ [README](https://github.com/WICG/observable/blob/master/README.md) Example 5)\n\næƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ª WebSocket è¿æ¥éœ€è¦åŒæ—¶å¤„ç†å¤šç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆæ¯”å¦‚ä¸åŒè‚¡ç¥¨çš„æŠ¥ä»·ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›ä¸ºæ¯ç§ç±»å‹çš„æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ Observable æµï¼Œå¹¶ä¸”å½“è®¢é˜…æŸä¸ªæµæ—¶è‡ªåŠ¨å‘é€è®¢é˜…æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼Œå–æ¶ˆè®¢é˜…æ—¶è‡ªåŠ¨å‘é€å–æ¶ˆè®¢é˜…æ¶ˆæ¯ã€‚\n\n```ts\nconst socket = new WebSocket(\&quot;wss://example.com\&quot;);\n\n// é€šç”¨çš„å¤šè·¯å¤ç”¨å‡½æ•°\nfunction multiplex({ startMsg, stopMsg, match }) {\n  // ç­‰å¾… socket è¿æ¥æˆåŠŸ\n  const readyToSend$ =\n    socket.readyState === WebSocket.OPEN\n      ? Observable.from([true]) // å·²è¿æ¥ï¼Œç«‹å³å‘é€\n      : socket\n          .when(\&quot;open\&quot;)\n          .map(() =&gt; true)\n          .take(1); // ç­‰å¾… open äº‹ä»¶\n\n  return readyToSend$.flatMap(() =&gt; {\n    console.log(\&quot;Sending start message:\&quot;, startMsg);\n    socket.send(JSON.stringify(startMsg));\n\n    // è¿”å›ä¸€ä¸ª Observableï¼Œå®ƒï¼š\n    return socket\n      .when(\&quot;message\&quot;) // ç›‘å¬æ‰€æœ‰æ¶ˆæ¯\n      .map((e) =&gt; JSON.parse(e.data)) // è§£æ JSON æ•°æ®\n      .filter(match) // è¿‡æ»¤å‡ºåŒ¹é…çš„æ¶ˆæ¯\n      .takeUntil(socket.when(\&quot;close\&quot;)) // å½“ socket å…³é—­æ—¶åœæ­¢\n      .takeUntil(socket.when(\&quot;error\&quot;)) // å½“ socket é”™è¯¯æ—¶åœæ­¢\n      .finally(() =&gt; {\n        // æ— è®ºå¦‚ä½•ç»“æŸï¼Œéƒ½æ‰§è¡Œæ¸…ç†\n        // æ¸…ç†é€»è¾‘ï¼šå‘é€åœæ­¢æ¶ˆæ¯\n        if (socket.readyState === WebSocket.OPEN) {\n          console.log(\&quot;Sending stop message:\&quot;, stopMsg);\n          socket.send(JSON.stringify(stopMsg));\n        }\n      });\n  });\n}\n\n// ç‰¹å®šè‚¡ç¥¨æµçš„å·¥å‚å‡½æ•°\nfunction streamStock(ticker) {\n  return multiplex({\n    startMsg: { ticker, type: \&quot;sub\&quot; },\n    stopMsg: { ticker, type: \&quot;unsub\&quot; },\n    match: (data) =&gt; data.ticker === ticker, // åŒ¹é…å¯¹åº” ticker çš„æ•°æ®\n  });\n}\n\n// åˆ›å»ºä¸åŒè‚¡ç¥¨çš„æµ\nconst googTrades$ = streamStock(\&quot;GOOG\&quot;);\nconst nflxTrades$ = streamStock(\&quot;NFLX\&quot;);\n\n// è®¢é˜… GOOG è‚¡ç¥¨æµ\nconst googSubscription = googTrades$.subscribe({ next: updateGoogView });\n// è®¢é˜… NFLX è‚¡ç¥¨æµ\nconst nflxSubscription = nflxTrades$.subscribe({ next: updateNflxView });\n\n// ç¨åï¼Œç”¨æˆ·ä¸æƒ³çœ‹ GOOG äº†\ngoogSubscription.abort(); // å–æ¶ˆè®¢é˜…ï¼Œä¼šè‡ªåŠ¨è§¦å‘ finally å‘é€ unsub æ¶ˆæ¯\n\n// å¦‚æœ socket æ„å¤–å…³é—­æˆ–å‡ºé”™ï¼Œæ‰€æœ‰æµä¹Ÿä¼šè‡ªåŠ¨åœæ­¢å¹¶å°è¯•å‘é€ unsub\n```\n\nè¿™ä¸ªä¾‹å­å±•ç¤ºäº† Observable å¦‚ä½•ä¼˜é›…åœ°å¤„ç†ï¼š\n\n- å¼‚æ­¥ä¾èµ–ï¼ˆç­‰å¾… socket openï¼‰\n- äº‹ä»¶æµçš„è¿‡æ»¤å’Œè½¬æ¢\n- å¤šä¸ªç»ˆæ­¢æ¡ä»¶ (`takeUntil`)\n- èµ„æºæ¸…ç† (`finally`ï¼Œç¡®ä¿å‘é€å–æ¶ˆè®¢é˜…æ¶ˆæ¯)\n\n**åœºæ™¯ 2ï¼šå®ç°â€œç§˜å¯†æŒ‡ä»¤â€è¾“å…¥æ£€æµ‹** (æ¥è‡ªå®˜æ–¹ [README](https://github.com/WICG/observable/blob/master/README.md) Example 6)\n\næ£€æµ‹ç”¨æˆ·æ˜¯å¦æŒ‰é¡ºåºè¾“å…¥äº†ä¸€ç³»åˆ—ç‰¹å®šçš„æŒ‰é”®ï¼ˆæ¯”å¦‚ç»å…¸çš„ Konami Codeï¼‰ã€‚\n\n```ts\nconst konamiCode = [\n  \&quot;ArrowUp\&quot;,\n  \&quot;ArrowUp\&quot;,\n  \&quot;ArrowDown\&quot;,\n  \&quot;ArrowDown\&quot;,\n  \&quot;ArrowLeft\&quot;,\n  \&quot;ArrowRight\&quot;,\n  \&quot;ArrowLeft\&quot;,\n  \&quot;ArrowRight\&quot;,\n  \&quot;b\&quot;,\n  \&quot;a\&quot;,\n  \&quot;Enter\&quot;,\n];\n\nconst keydown$ = document.when(\&quot;keydown\&quot;).map((e) =&gt; e.key);\n\nkeydown$\n  .bufferCount(konamiCode.length, 1) // åˆ›å»ºä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œæ¯æ¬¡åŒ…å« 11 ä¸ªæŒ‰é”®\n  // .buffer(keydown$.debounceTime(1000)) // æˆ–è€…ç”¨ buffer + debounceTime æ£€æµ‹è¿ç»­æŒ‰é”®åºåˆ—\n  .filter((keys) =&gt; keys.every((key, i) =&gt; key === konamiCode[i])) // æ£€æŸ¥çª—å£å†…å®¹æ˜¯å¦åŒ¹é…\n  .subscribe(() =&gt; {\n    console.log(\&quot;Konami Code Entered! ğŸ‰\&quot;);\n    // æ‰§è¡Œä½ çš„å½©è›‹é€»è¾‘...\n  });\n\n// RxJS å¯èƒ½æœ‰æ›´ç›´æ¥çš„æ“ä½œç¬¦å¦‚ sequenceEqual æˆ– window/buffer ç»„åˆ\n// ä¸Šé¢çš„ bufferCount æ˜¯ä¸€ä¸ªç®€åŒ–çš„æ€è·¯ï¼Œå®é™…å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘\n// æ¯”å¦‚ RxJS çš„ï¼š\n// keydown$.windowCount(konamiCode.length, 1)\n//   .flatMap(window =&gt; window.sequenceEqual(Observable.from(konamiCode)))\n//   .filter(matches =&gt; matches)\n//   .subscribe(() =&gt; console.log(&#39;Konami Code Entered! ğŸ‰&#39;));\n```\n\n_(æ³¨ï¼šåŸç”Ÿ Observable ææ¡ˆåˆæœŸå¯èƒ½ä¸åŒ…å« `bufferCount`ã€`windowCount`ã€`sequenceEqual` ç­‰é«˜çº§æ“ä½œç¬¦ï¼Œè¿™é‡Œä»…ä½œç¤ºä¾‹ã€‚ä½†è¿™ä¸ªä¾‹å­å±•ç¤ºäº† Observable åœ¨å¤„ç†åºåˆ—æ¨¡å¼åŒ¹é…æ–¹é¢çš„æ½œåŠ›ã€‚)_\n\nè¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé€šè¿‡ç»„åˆæ“ä½œç¬¦ï¼ŒObservable å¯ä»¥ç”¨æ¥è¯†åˆ«å’Œå“åº”å¤æ‚çš„äº‹ä»¶æ¨¡å¼ã€‚\n\n## å…«ã€ç«™åœ¨å·¨äººè‚©ä¸Šâ€”â€”æ€»ç»“ä¸å±•æœ›\n\nå¥½äº†ï¼Œå…³äº Observableï¼Œæˆ‘ä»¬ä»ç†å¿µåˆ°å®è·µï¼ŒèŠäº†ä¸å°‘ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç«™åœ¨å¼€å‘è€…å’Œææ¡ˆè€…çš„è§’åº¦ï¼Œåšä¸ªæ€»ç»“å’Œå±•æœ›ã€‚\n\n**å¼€å‘è€…è§†è§’ï¼šObservable å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿ**\n\n1.  **ä»£ç æ›´ä¼˜é›…**: å£°æ˜å¼çš„é“¾å¼è°ƒç”¨ï¼Œè®©å¤æ‚çš„å¼‚æ­¥äº‹ä»¶å¤„ç†é€»è¾‘ï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€ç»„åˆã€èŠ‚æµã€é˜²æŠ–ã€å–æ¶ˆï¼‰å˜å¾—æ›´æ¸…æ™°ã€æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤ã€‚\n2.  **è§£æ”¾åŒæ‰‹**: è‡ªåŠ¨çš„èµ„æºç®¡ç†ï¼ˆTeardown æœºåˆ¶ï¼‰ï¼Œè®©ä½ å‘Šåˆ«æ‰‹åŠ¨ `removeEventListener` çš„çƒ¦æ¼å’Œæ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚\n3.  **ç»Ÿä¸€æ¨¡å‹**: æœ‰æœ›æä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€å¼ºå¤§çš„æ¨¡å‹æ¥å¤„ç†å„ç§å¼‚æ­¥æ•°æ®æµï¼Œä¸ä»…ä»…æ˜¯ DOM äº‹ä»¶ï¼Œè¿˜åŒ…æ‹¬åŠ¨ç”»ã€ç½‘ç»œè¯·æ±‚ã€ç”¨æˆ·è¾“å…¥ç­‰ã€‚\n4.  **æ€§èƒ½æ½œåŠ›**: åŸç”Ÿå®ç°é€šå¸¸æ¯”ç”¨æˆ·æ€åº“æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥æ›´å¥½åœ°ä¸æµè§ˆå™¨ DevTools é›†æˆï¼Œæä¾›æ›´å¥½çš„è°ƒè¯•ä½“éªŒã€‚\n5.  **æ½œåœ¨çš„ Bundle Size å‡å°**: å¦‚æœ Observable æˆä¸ºåŸç”Ÿ APIï¼Œé‚£ä¹ˆåƒ RxJS è¿™æ ·çš„åº“å¯ä»¥åšå¾—æ›´å°ï¼ˆåªæä¾›åŸç”Ÿä¸åŒ…å«çš„æ“ä½œç¬¦ï¼‰ï¼Œæˆ–è€…å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨åŸç”Ÿ APIï¼Œå‡å°‘é¡¹ç›®ä¾èµ–ä½“ç§¯ã€‚\n6.  **éœ€è¦æ³¨æ„çš„å‘**: ä¸»è¦æ˜¯ Promise-returning æ“ä½œç¬¦ä¸ `preventDefault()` çš„äº¤äº’é—®é¢˜ï¼Œéœ€è¦å…»æˆè‰¯å¥½çš„å¤„ç†ä¹ æƒ¯ã€‚\n\n**ææ¡ˆè€…è§†è§’ï¼šé“é˜»ä¸”é•¿ï¼Œè¡Œåˆ™å°†è‡³**\n\n1.  **æ¼«æ¼«é•¿è·¯**: Observable çš„æ ‡å‡†åŒ–ä¹‹è·¯å¼‚å¸¸åå·ï¼Œåæ˜ äº†åœ¨ Web å¹³å°æ·»åŠ æ–°åŸºç¡€åŸè¯­çš„å¤æ‚æ€§å’ŒæŒ‘æˆ˜æ€§ï¼ˆè¯­è¨€ vs. å¹³å°ï¼ŒAPI è®¾è®¡ç»†èŠ‚ï¼Œå‚å•†åè°ƒç­‰ï¼‰ã€‚\n2.  **ç¤¾åŒºåŠ›é‡**: ç”¨æˆ·æ€åº“çš„å·¨å¤§æˆåŠŸå’Œå¹¿æ³›åº”ç”¨ï¼Œæ˜¯æ¨åŠ¨å…¶æ ‡å‡†åŒ–çš„æœ€æœ‰åŠ›æ­¦å™¨ã€‚å®ƒè¯æ˜äº†å¼€å‘è€…ç¡®å®éœ€è¦è¿™æ ·çš„å·¥å…·ã€‚\n3.  **å¹³å°æ•´åˆ**: å°† Observable ä¸ `EventTarget`ã€`AbortController` ç­‰ç°æœ‰å¹³å°ç‰¹æ€§æ·±åº¦æ•´åˆï¼Œæ˜¯å…¶æœ€ç»ˆæˆåŠŸçš„å…³é”®ã€‚å®ƒä¸æ˜¯å­¤ç«‹çš„ APIï¼Œè€Œæ˜¯ Web å¼‚æ­¥å¤„ç†ç”Ÿæ€çš„ä¸€éƒ¨åˆ†ã€‚\n4.  **æœªæ¥å¯æœŸ**: éšç€ææ¡ˆåœ¨ WICG çš„æ¨è¿›ï¼Œä»¥åŠ Chrome 135 å·²ç»ä¸Šæ¶äº† Observable APIï¼Œï¼Œæˆ‘ä»¬æœ‰ç†ç”±æœŸå¾…ï¼Œåœ¨ä¸ä¹…çš„å°†æ¥ï¼Œæˆ–è®¸å°±èƒ½åœ¨æ›´å¤šçš„æµè§ˆå™¨ä¸­åŸç”Ÿä½¿ç”¨ `Observable` äº†ã€‚\n\n**æ€»ç»“**\n\nObservable ä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒç¡®å®ä¸ºæˆ‘ä»¬å¤„ç† Web å¼‚æ­¥äº‹ä»¶æµæä¾›äº†ä¸€å¥—å¼ºå¤§è€Œä¼˜é›…çš„èŒƒå¼ã€‚å®ƒé¼“åŠ±æˆ‘ä»¬ç”¨**å£°æ˜å¼**çš„æ€ç»´å»æ„å»º**å¯ç»„åˆ**ã€**æ˜“äºç®¡ç†**çš„äº‹ä»¶å¤„ç†é€»è¾‘ã€‚è™½ç„¶å®ƒçš„æ ‡å‡†åŒ–å†ç¨‹å……æ»¡æ³¢æŠ˜ï¼Œä½†å…¶èƒŒåè•´å«çš„å“åº”å¼ç¼–ç¨‹æ€æƒ³ï¼Œä»¥åŠåœ¨ç¤¾åŒºä¸­å±•ç°å‡ºçš„å¼ºå¤§ç”Ÿå‘½åŠ›ï¼Œéƒ½é¢„ç¤ºç€å®ƒå¯èƒ½æ˜¯ Web å¼€å‘çš„ä¸‹ä¸€ä¸ªé‡è¦åŸºçŸ³ã€‚\n\nå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ æ­å¼€ Observable çš„ç¥ç§˜é¢çº±ã€‚ä½†æ˜¯ç›®å‰å¹¶æ²¡æœ‰éå¸¸é è°±çš„ [observable-polyfill](https://github.com/keithamus/observable-polyfill) ï¼Œä½†å› ä¸ºè¿™ä¸ªææ¡ˆæœ¬èº«å°±æ˜¯ä»ç¤¾åŒºä¸­è·µè¡Œæ¼”åŒ–å‡ºæ¥çš„ï¼Œä½ å¯ä»¥åœ¨å®˜æ–¹ [README/userland-libraries](https://github.com/WICG/observable/blob/master/README.md#userland-libraries) æ‰¾åˆ°ä¸€äº›ç›¸ä¼¼çš„åº“ï¼Œæå‰æ„Ÿå—å“åº”å¼ç¼–ç¨‹çš„é­…åŠ›å§ï¼&quot;],&quot;data-astro-cid-eomsrdgo&quot;:[0,true]}" ssr client="only" opts="{&quot;name&quot;:&quot;MarkdownRenderer&quot;,&quot;value&quot;:true}"></astro-island> <!-- 2. æ—  JS æ—¶çš„å›é€€ --> <div class="fallback-content" data-astro-cid-eomsrdgo> <p>ä»Šå¤©ï¼Œè·Ÿå¤§å®¶èŠèŠä¸€ä¸ªåœ¨ Web å¹³å°â€œéš¾äº§â€å¤šå¹´ï¼Œä½†æ±Ÿæ¹–ä¸Šæ—©å·²æµä¼ å…¶ä¼ è¯´ã€ä¼—å¤šæ¡†æ¶å’Œåº“é»˜é»˜æ‹¥æŠ±çš„å®¶ä¼™â€”â€”<strong>Observable</strong>ã€‚</p>
<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰ <code>addEventListener</code> ç”¨å¾—æœ‰ç‚¹è…»æ­ªäº†ï¼Ÿå›è°ƒåœ°ç‹±ã€æ‰‹åŠ¨ç§»é™¤ç›‘å¬ã€ç»„åˆå¤æ‚é€»è¾‘æ—¶çš„æ‰è¥Ÿè§è‚˜â€¦â€¦è¿™äº›ç—›ç‚¹ï¼Œå°±åƒé‹é‡Œçš„å°çŸ³å­ï¼Œæ—¶ä¸æ—¶ç¡Œå¾—æ…Œã€‚Observable ææ¡ˆï¼Œå°±åƒä¸€ä½èº«æ€€ç»æŠ€çš„æ­¦æ—é«˜æ‰‹ï¼Œè¯•å›¾ç”¨ä¸€ç§æ›´ä¼˜é›…ã€æ›´â€œå‡½æ•°å¼â€çš„å§¿æ€ï¼Œæ¥è§£å†³è¿™äº›å‰ç«¯äº‹ä»¶å¤„ç†çš„â€œç–‘éš¾æ‚ç—‡â€ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ï¼Œä»å®ƒæƒ³è§£å†³çš„é—®é¢˜å‡ºå‘ï¼Œä¸€è·¯æ‰’å¼€å®ƒçš„å‰ä¸–ä»Šç”Ÿã€æ ¸å¿ƒæ¦‚å¿µã€å®æˆ˜æŠ€å·§ï¼Œæœ€åå†ä¸€èµ·ç•…æƒ³ä¸‹å®ƒçš„æœªæ¥ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿå‘è½¦ï¼</p>
<h2 id="ä¸€observable-çš„çµé­‚æ‹·é—®å®ƒåˆ°åº•æƒ³å¹²å•¥">ä¸€ã€Observable çš„çµé­‚æ‹·é—®â€”â€”å®ƒåˆ°åº•æƒ³å¹²å•¥ï¼Ÿ</h2>
<p>ä»»ä½•æŠ€æœ¯çš„å‡ºç°éƒ½ä¸æ˜¯ç©ºç©´æ¥é£ã€‚Observable æƒ³è§£å†³çš„æ ¸å¿ƒç—›ç‚¹ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸ä¸å¼‚æ­¥äº‹ä»¶æ‰“äº¤é“æ—¶çš„â€œä¸çˆ½â€ã€‚</p>
<p>æƒ³æƒ³çœ‹ï¼Œæˆ‘ä»¬ç”¨ <code>addEventListener</code> æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> controller</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> AbortController</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> signal</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> controller.signal;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> handleMouseMove</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"é¼ æ ‡ç§»åŠ¨:"</span><span style="color:#E1E4E8">, e.clientX, e.clientY);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> handleMouseUp</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"é¼ æ ‡æ¾å¼€ï¼Œåœæ­¢ç›‘å¬ç§»åŠ¨"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">  // å…³é”®ï¼šéœ€è¦æ‰‹åŠ¨ç§»é™¤ç›‘å¬</span></span>
<span class="line"><span style="color:#E1E4E8">  element.</span><span style="color:#B392F0">removeEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mousemove"</span><span style="color:#E1E4E8">, handleMouseMove);</span></span>
<span class="line"><span style="color:#6A737D">  // å¦‚æœè¿˜æœ‰å…¶ä»–ç›‘å¬ï¼Œä¹Ÿå¾—ä¸€ä¸€ç§»é™¤...</span></span>
<span class="line"><span style="color:#E1E4E8">  document.</span><span style="color:#B392F0">removeEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mouseup"</span><span style="color:#E1E4E8">, handleMouseUp);</span></span>
<span class="line"><span style="color:#6A737D">  // æˆ–è€…ç”¨ AbortController æ‰¹é‡å–æ¶ˆï¼Œä½†è¿˜æ˜¯å¾—æ‰‹åŠ¨è°ƒç”¨ abort</span></span>
<span class="line"><span style="color:#6A737D">  // controller.abort();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">element.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  "mousedown"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"é¼ æ ‡æŒ‰ä¸‹ï¼Œå¼€å§‹ç›‘å¬ç§»åŠ¨å’Œæ¾å¼€"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    element.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mousemove"</span><span style="color:#E1E4E8">, handleMouseMove, { signal });</span></span>
<span class="line"><span style="color:#E1E4E8">    document.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mouseup"</span><span style="color:#E1E4E8">, handleMouseUp, { signal });</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { signal },</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æƒ³åœ¨æŸä¸ªæ¡ä»¶ä¸‹åœæ­¢æ‰€æœ‰ç›‘å¬ï¼Ÿ</span></span>
<span class="line"><span style="color:#6A737D">// controller.abort();</span></span></code></pre>
<p>è¿™æ®µä»£ç çœ¼ç†Ÿå§ï¼Ÿæ˜¯ä¸æ˜¯æœ‰å†…å‘³å„¿äº†ï¼Ÿ</p>
<ol>
<li><strong>å‘½ä»¤å¼ (Imperative)</strong>: ä½ å¾—ä¸€æ­¥æ­¥å‘Šè¯‰æµè§ˆå™¨â€œåšä»€ä¹ˆâ€ï¼ˆæ·»åŠ ç›‘å¬ã€ç§»é™¤ç›‘å¬ï¼‰ã€‚</li>
<li><strong>çŠ¶æ€ç®¡ç†å¤æ‚</strong>: éœ€è¦æ‰‹åŠ¨ç®¡ç†ç›‘å¬å™¨çš„æ·»åŠ å’Œç§»é™¤ï¼Œå°¤å…¶æ˜¯æ¶‰åŠå¤šä¸ªäº‹ä»¶ã€éœ€è¦æ¡ä»¶æ€§å–æ¶ˆæ—¶ï¼Œå¾ˆå®¹æ˜“é—æ¼ï¼Œé€ æˆå†…å­˜æ³„æ¼æˆ–é€»è¾‘é”™è¯¯ã€‚</li>
<li><strong>ç»„åˆå›°éš¾</strong>: æƒ³å®ç°â€œå½“ A äº‹ä»¶å‘ç”Ÿåï¼Œç›‘å¬ B äº‹ä»¶ï¼Œç›´åˆ° C äº‹ä»¶å‘ç”Ÿâ€è¿™ç§é€»è¾‘ï¼Œå¾€å¾€éœ€è¦åµŒå¥—å›è°ƒï¼Œä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ç›´çº¿ä¸‹é™ã€‚</li>
</ol>
<p><strong>Observable çš„å“²å­¦ï¼šæŠŠäº‹ä»¶æµå½“æˆä¸€ç­‰å…¬æ°‘</strong></p>
<p>Observable è¯´ï¼šâ€œåˆ«é‚£ä¹ˆéº»çƒ¦äº†ï¼å’±æ¢ä¸ªæ€è·¯ã€‚â€ å®ƒå€Ÿé‰´äº†å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹çš„æ€æƒ³ï¼ŒæŠŠ<strong>éšæ—¶é—´å‘ç”Ÿçš„ã€å¯èƒ½å¤šæ¬¡çš„äº‹ä»¶ï¼Œçœ‹ä½œæ˜¯ä¸€ä¸ªæ•°æ®æµï¼ˆStreamï¼‰</strong>ã€‚è¿™ä¸ªæµï¼Œå°±åƒæ•°ç»„ä¸€æ ·ï¼Œä½ å¯ä»¥å¯¹å®ƒè¿›è¡Œå„ç§æ“ä½œï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€ç»„åˆâ€¦â€¦ï¼‰ï¼Œè€Œä¸”è¿™äº›æ“ä½œæ˜¯**å£°æ˜å¼ (Declarative)**çš„ã€‚</p>
<p>ä½ ä¸å†å…³å¿ƒå…·ä½“æ€ä¹ˆæ·»åŠ ã€ç§»é™¤ç›‘å¬å™¨ï¼Œè€Œæ˜¯<strong>æè¿°</strong>ä½ æƒ³è¦ä»€ä¹ˆæ ·çš„äº‹ä»¶æµï¼Œä»¥åŠå½“æµä¸­æœ‰æ•°æ®ï¼ˆäº‹ä»¶ï¼‰æˆ–è€…æµç»“æŸæ—¶ï¼Œä½ æƒ³åšä»€ä¹ˆã€‚</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“ï¼š</strong></p>
<ul>
<li><strong>å¯ç»„åˆ (Composable)</strong>: åƒé“¾å¼è°ƒç”¨ <code>.filter().map()</code> ä¸€æ ·å¤„ç†äº‹ä»¶æµã€‚</li>
<li><strong>æ˜¾å¼ç»ˆæ­¢ (Explicit Termination)</strong>: æ¸…æ™°åœ°å®šä¹‰äº‹ä»¶æµä½•æ—¶å¼€å§‹ã€ä½•æ—¶ç»“æŸï¼Œä»¥åŠç»“æŸåçš„æ¸…ç†é€»è¾‘ã€‚</li>
<li><strong>æ›´æ¸…æ™°çš„ä»£ç </strong>: å£°æ˜å¼çš„ä»£ç å¾€å¾€æ›´æ˜“è¯»ã€æ›´æ˜“æ‡‚ã€‚</li>
</ul>
<p>çœ‹çœ‹ç”¨ Observable ï¼ˆå‡è®¾çš„ <code>.when()</code> APIï¼‰æ”¹å†™æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// æè¿°ï¼šç›‘å¬é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œå¯¹äºæ¯æ¬¡æŒ‰ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8">element.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mousedown"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"é¼ æ ‡æŒ‰ä¸‹ï¼Œå¼€å§‹ç›‘å¬ç§»åŠ¨å’Œæ¾å¼€"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">  // æè¿°ï¼šç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼Œç›´åˆ°é¼ æ ‡æ¾å¼€äº‹ä»¶å‘ç”Ÿ</span></span>
<span class="line"><span style="color:#E1E4E8">  element</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mousemove"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">takeUntil</span><span style="color:#E1E4E8">(document.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mouseup"</span><span style="color:#E1E4E8">)) </span><span style="color:#6A737D">// å…³é”®ï¼šå£°æ˜å¼ç»ˆæ­¢</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">      next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"é¼ æ ‡ç§»åŠ¨:"</span><span style="color:#E1E4E8">, e.clientX, e.clientY),</span></span>
<span class="line"><span style="color:#B392F0">      complete</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"é¼ æ ‡æ¾å¼€ï¼Œç§»åŠ¨ç›‘å¬è‡ªåŠ¨åœæ­¢"</span><span style="color:#E1E4E8">), </span><span style="color:#6A737D">// æµå®Œæˆ</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰æ¸…çˆ½å¤šäº†ï¼Ÿ<code>takeUntil</code> å°±åƒç»™äº‹ä»¶æµè®¾äº†ä¸ªâ€œæˆªæ­¢é˜€â€ï¼Œä¸€æ—¦ <code>document</code> çš„ <code>mouseup</code> äº‹ä»¶å‘ç”Ÿï¼Œ<code>mousemove</code> äº‹ä»¶æµå°±è‡ªåŠ¨åœæ­¢å¹¶æ¸…ç†ï¼Œæ— éœ€æ‰‹åŠ¨ <code>removeEventListener</code>ã€‚è¿™å°±æ˜¯ Observable è§£å†³é—®é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼š<strong>ç”¨å£°æ˜å¼çš„æ–¹å¼ï¼Œä¼˜é›…åœ°ç®¡ç†å’Œç»„åˆå¼‚æ­¥äº‹ä»¶æµã€‚</strong></p>
<h2 id="äºŒå‰ä¸–ä»Šç”Ÿobservable-çš„é•¿å¾è·¯">äºŒã€å‰ä¸–ä»Šç”Ÿâ€”â€”Observable çš„â€œé•¿å¾è·¯â€</h2>
<p>äº†è§£ä¸€é¡¹æŠ€æœ¯ï¼Œä¸èƒ½åªçœ‹å®ƒå…‰é²œäº®ä¸½çš„ APIï¼Œè¿˜å¾—çŸ¥é“å®ƒèƒŒåé‚£ç‚¹â€œé™ˆèŠéº»çƒ‚è°·å­â€çš„æ•…äº‹ã€‚Observable çš„è¯ç”Ÿå’Œæ ‡å‡†åŒ–ä¹‹è·¯ï¼Œå¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼Œå……æ»¡äº†æŠ€æœ¯å¤§ä½¬ä»¬çš„æ€è€ƒå’Œåšå¼ˆã€‚</p>
<ol>
<li>
<p><strong>TC39 çš„èŒèŠ½ä¸å—æŒ«</strong>: æœ€æ—©ï¼ŒObservable æ˜¯åœ¨ TC39ï¼ˆECMAScript æ ‡å‡†å§”å‘˜ä¼šï¼‰è¢«æå‡ºçš„ï¼ˆå¤§çº¦ 2015 å¹´ï¼‰ï¼Œç”± Ben Leshï¼ˆRxJS çš„æ ¸å¿ƒå¼€å‘è€…ï¼‰ç­‰äººæ¨åŠ¨ã€‚å½“æ—¶çš„è®¾æƒ³æ˜¯æŠŠå®ƒä½œä¸º JavaScript è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒ Promise ä¸€æ ·ã€‚ä½†ææ¡ˆåœ¨ TC39 å¡åœ¨äº† Stage 1 å¾ˆé•¿æ—¶é—´ã€‚åå¯¹çš„å£°éŸ³è®¤ä¸ºï¼ŒObservable ä¼¼ä¹æ›´åƒæ˜¯ä¸€ä¸ªâ€œåº“çº§â€çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯è¯­è¨€æ ¸å¿ƒå¿…å¤‡çš„ï¼›è€Œä¸”å®ƒæ²¡æœ‰å¼•å…¥æ–°çš„è¯­æ³•ï¼Œæ›´ä¾èµ–äº API è®¾è®¡ï¼Œè¿™è®©ä¸€äº›å§”å‘˜è§‰å¾—å®ƒä¸å¤Ÿâ€œåº•å±‚â€ã€‚</p>
</li>
<li>
<p><strong>è½¬æˆ˜ WHATWG</strong>: çœ¼çœ‹ TC39 æ­¤è·¯ä¸é€šï¼Œå¤§ä½¬ä»¬ï¼ˆå°¤å…¶æ˜¯ Google å›¢é˜Ÿçš„ Ben Leshï¼‰æ”¹å˜ç­–ç•¥ï¼Œå°è¯•å°† Observable ä½œä¸º Web å¹³å°ï¼ˆDOMï¼‰çš„ä¸€éƒ¨åˆ†æ¥æ ‡å‡†åŒ–ï¼ˆå¤§çº¦ 2017 å¹´åº•ï¼Œå°±æ˜¯ GitHub Issue #544 çš„å¼€ç«¯ï¼‰ã€‚ç†ç”±æ˜¯ï¼šWeb å¹³å°å……æ»¡äº†äº‹ä»¶ï¼ˆDOM äº‹ä»¶ã€ç½‘ç»œäº‹ä»¶ç­‰ï¼‰ï¼Œ<code>EventTarget</code> æ˜¯äº‹å®æ ‡å‡†ï¼ŒObservable ä¸ <code>EventTarget</code> ç»“åˆèƒ½å‘æŒ¥æœ€å¤§ä»·å€¼ï¼Œè§£å†³ Web å¼€å‘è€…çš„å®é™…ç—›ç‚¹ã€‚è¿™ä¼¼ä¹æ›´æœ‰è¯´æœåŠ›ã€‚</p>
</li>
<li>
<p><strong>æ¼«é•¿çš„è®¨è®ºä¸æ¼”è¿›</strong>: åœ¨ WHATWG çš„è®¨è®ºï¼ˆIssue #544 é‡Œå¯ä»¥çœ‹åˆ°å¤§é‡è®¨è®ºç»†èŠ‚ï¼‰ä¸­ï¼ŒAPI çš„å½¢æ€ä¹Ÿå‡ ç»å˜åŒ–ï¼š</p>
<ul>
<li>æœ€åˆå« <code>on()</code>ï¼Œåæ¥ä¸ºäº†é¿å…ä¸ç°æœ‰å±æ€§å†²çªæˆ–æ­§ä¹‰ï¼Œæ”¹æˆäº† <code>when()</code>ã€‚</li>
<li>å…³äº <code>subscribe()</code> æ–¹æ³•çš„å‚æ•°å½¢æ€ï¼ˆå‡½æ•°é‡è½½ vs. å¯¹è±¡ï¼‰ï¼ŒWeb IDL çš„é™åˆ¶å¼•å‘äº†è®¨è®ºï¼ˆDomenic çš„è§£é‡Šï¼‰ã€‚</li>
<li><code>preventDefault()</code> çš„é—®é¢˜è¢«åå¤æåŠï¼ˆAnne van Kesteren ç­‰äººæå‡ºï¼‰ï¼Œå› ä¸º Promise çš„å¾®ä»»åŠ¡è°ƒåº¦æœºåˆ¶å¯èƒ½å¯¼è‡´åœ¨ <code>then()</code> ä¸­è°ƒç”¨ <code>preventDefault()</code> å¤±æ•ˆï¼Œè¿™ä¿ƒä½¿å¤§å®¶æ€è€ƒåŒæ­¥æ‰§è¡Œçš„é‡è¦æ€§ã€‚</li>
<li>ä¸ <code>AbortController</code>/<code>AbortSignal</code> çš„é›†æˆï¼Œæˆä¸ºå–æ¶ˆè®¢é˜…ï¼ˆunsubscriptionï¼‰çš„æ ‡å‡†æ–¹å¼ï¼Œè¿™å¤§å¤§å¢å¼ºäº†å®ƒçš„å®ç”¨æ€§ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç”¨æˆ·æ€çš„ç¹è£</strong>: æ ‡å‡†åŒ–è¿›å±•ç¼“æ…¢ï¼Œä½†æŒ¡ä¸ä½äººæ°‘ç¾¤ä¼—ï¼ˆå¼€å‘è€…ï¼‰çš„éœ€æ±‚å•Šï¼ä»¥ RxJS ä¸ºé¦–çš„å„ç§ Observable å®ç°åº“åœ¨ç¤¾åŒºå¤§è¡Œå…¶é“ï¼Œæ¯å‘¨å‡ åƒä¸‡ç”šè‡³ä¸Šäº¿çš„ä¸‹è½½é‡ï¼ˆREADME ä¸­ Ben Lesh æåˆ° RxJS æ¯å‘¨ 4700 ä¸‡+ä¸‹è½½é‡ï¼‰ï¼Œä»¥åŠä¼—å¤šæ¡†æ¶ï¼ˆAngularã€Vue (vue-rx)ã€Svelteã€XState ç­‰ï¼‰å¯¹ Observable çš„å†…ç½®æ”¯æŒæˆ–è‰¯å¥½é›†æˆï¼Œéƒ½è¯æ˜äº†å…¶ä»·å€¼å’Œå¼€å‘è€…å¯¹å…¶çš„ä¾èµ–ã€‚è¿™åè¿‡æ¥ä¹Ÿç»™æ ‡å‡†åŒ–æä¾›äº†å¼ºå¤§çš„åŠ¨åŠ›å’Œäº‹å®ä¾æ®â€”â€”å¤§å®¶éƒ½è¿™ä¹ˆç”¨äº†ï¼Œæ ‡å‡†æ˜¯ä¸æ˜¯è¯¥è·Ÿä¸Šäº†ï¼Ÿ</p>
</li>
<li>
<p><strong>WICG çš„å†å‡ºå‘</strong>: ç›®å‰ï¼ŒObservable çš„æ ‡å‡†åŒ–å·¥ä½œä¸»è¦åœ¨ WICGï¼ˆWeb Platform Incubator Community Groupï¼‰è¿›è¡Œï¼Œç”± Dominic Farolino (Google) ç­‰äººç»§ç»­æ¨è¿›ã€‚ç›®æ ‡æ˜¯å¸å–è¿‡å»çš„ç»éªŒæ•™è®­ï¼Œæ•´åˆç¤¾åŒºçš„æœ€ä½³å®è·µï¼Œæœ€ç»ˆæ‹¿å‡ºä¸€ä¸ªæµè§ˆå™¨å‚å•†æ„¿æ„å®ç°ã€å¼€å‘è€…ç”¨ç€é¡ºæ‰‹çš„æ ‡å‡† APIã€‚</p>
</li>
</ol>
<p>å¯ä»¥è¯´ï¼ŒObservable çš„å†å²ï¼Œå°±æ˜¯ä¸€éƒ¨åœ¨è¯­è¨€æ ¸å¿ƒä¸å¹³å°ç‰¹æ€§ä¹‹é—´ä¸æ–­æ¢ç´¢ã€åœ¨ç¤¾åŒºå®è·µä¸æ ‡å‡†åŒ–åšå¼ˆä¹‹é—´ä¸æ–­æ¼”è¿›çš„å†å²ã€‚</p>
<h2 id="ä¸‰å°è¯•ç‰›åˆ€eventtargetwhen-åˆä½“éªŒ">ä¸‰ã€å°è¯•ç‰›åˆ€â€”â€”<code>EventTarget.when()</code> åˆä½“éªŒ</h2>
<p>è¯´äº†è¿™ä¹ˆå¤šèƒŒæ™¯ï¼Œæ˜¯æ—¶å€™ä¸Šæ‰‹æ„Ÿå—ä¸€ä¸‹äº†ã€‚Observable ææ¡ˆçš„æ ¸å¿ƒå…¥å£ï¼Œå°±æ˜¯ç»™ <code>EventTarget</code> (æˆ‘ä»¬ç†Ÿæ‚‰çš„ <code>element</code>, <code>document</code>, <code>window</code> ç­‰çš„è€ç¥–å®—) æ·»åŠ äº†ä¸€ä¸ªæ–°æ–¹æ³•ï¼š<code>.when()</code>ã€‚</p>
<p><code>.when(eventType, options)</code> æ–¹æ³•è¿”å›ä¸€ä¸ª Observable å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†æŒ‡å®šç±»å‹çš„äº‹ä»¶æµã€‚</p>
<p><strong>åŸºç¡€ç”¨æ³•ï¼šæ›¿ä»£ <code>addEventListener</code></strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> clicks</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> element.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"click"</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// è¿”å›ä¸€ä¸ªä»£è¡¨ç‚¹å‡»äº‹ä»¶çš„ Observable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// è®¢é˜…è¿™ä¸ª Observableï¼Œå¼€å§‹ç›‘å¬</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> subscription</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> clicks.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">event</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // æ¯å½“ç‚¹å‡»äº‹ä»¶å‘ç”Ÿï¼Œnext å›è°ƒè¢«è§¦å‘</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Element clicked!"</span><span style="color:#E1E4E8">, event.target);</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#B392F0">  error</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // å¦‚æœ Observable å†…éƒ¨å‡ºé”™ï¼ˆè™½ç„¶ DOM äº‹ä»¶ä¸€èˆ¬ä¸ä¼šï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Something went wrong:"</span><span style="color:#E1E4E8">, err);</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#B392F0">  complete</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // å¦‚æœäº‹ä»¶æµæ­£å¸¸ç»“æŸï¼ˆDOM äº‹ä»¶æµé€šå¸¸ä¸ä¼šè‡ªç„¶ç»“æŸï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Click stream completed."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æƒ³åœæ­¢ç›‘å¬ï¼Ÿå–æ¶ˆè®¢é˜…å³å¯</span></span>
<span class="line"><span style="color:#6A737D">// subscription.abort(); // å‡è®¾ subscribe è¿”å›å¸¦æœ‰ abort æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨ AbortSignal</span></span></code></pre>
<p><strong>é“¾å¼æ“ä½œï¼šè¿‡æ»¤ä¸æ˜ å°„</strong></p>
<p>è¿™æ‰æ˜¯ Observable çš„é­…åŠ›æ‰€åœ¨ï¼å‡è®¾æˆ‘ä»¬åªæƒ³å¤„ç†ç‚¹å‡»åˆ°ç‰¹å®šå­å…ƒç´  <code>.foo</code> çš„äº‹ä»¶ï¼Œå¹¶ä¸”åªå…³å¿ƒç‚¹å‡»çš„åæ ‡ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">element</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"click"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> e.target.</span><span style="color:#B392F0">matches</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">".foo"</span><span style="color:#E1E4E8">)) </span><span style="color:#6A737D">// è¿‡æ»¤ï¼šåªä¿ç•™ç›®æ ‡åŒ¹é… '.foo' çš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ x: e.clientX, y: e.clientY })) </span><span style="color:#6A737D">// æ˜ å°„ï¼šå°†äº‹ä»¶å¯¹è±¡è½¬æ¢ä¸ºåæ ‡å¯¹è±¡</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">    next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">point</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // è¿™é‡Œæ”¶åˆ°çš„å°±æ˜¯åæ ‡å¯¹è±¡äº†</span></span>
<span class="line"><span style="color:#E1E4E8">      console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Clicked on .foo at:"</span><span style="color:#E1E4E8">, point);</span></span>
<span class="line"><span style="color:#B392F0">      handleClickAtPoint</span><span style="color:#E1E4E8">(point); </span><span style="color:#6A737D">// è°ƒç”¨ä½ çš„å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span></code></pre>
<p>å¯¹æ¯”ä¸€ä¸‹ç”¨ <code>addEventListener</code> å®ç°ç›¸åŒé€»è¾‘ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">element.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"click"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (e.target.</span><span style="color:#B392F0">matches</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">".foo"</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> point</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { x: e.clientX, y: e.clientY };</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Clicked on .foo at:"</span><span style="color:#E1E4E8">, point);</span></span>
<span class="line"><span style="color:#B392F0">    handleClickAtPoint</span><span style="color:#E1E4E8">(point);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#6A737D">// æ¸…ç†ï¼Ÿè¿˜å¾—æ‰‹åŠ¨ removeEventListener...</span></span></code></pre>
<p>æ˜¯ä¸æ˜¯é«˜ä¸‹ç«‹åˆ¤ï¼ŸObservable çš„é“¾å¼è°ƒç”¨ï¼ŒæŠŠäº‹ä»¶çš„å¤„ç†æµç¨‹ï¼ˆè¿‡æ»¤ã€è½¬æ¢ï¼‰æ¸…æ™°åœ°è¡¨è¾¾äº†å‡ºæ¥ï¼Œä»£ç æ›´å…·å£°æ˜æ€§ã€‚</p>
<h2 id="å››ç™»å ‚å…¥å®¤æ ¸å¿ƒ-observable-api-ä¸æ¦‚å¿µ">å››ã€ç™»å ‚å…¥å®¤â€”â€”æ ¸å¿ƒ Observable API ä¸æ¦‚å¿µ</h2>
<p>è¦çœŸæ­£æŒæ¡ Observableï¼Œå…‰ä¼šç”¨ <code>.when()</code> è¿˜ä¸å¤Ÿï¼Œå¾—æ·±å…¥ç†è§£å…¶æ ¸å¿ƒ API å’Œè¿ä½œæœºåˆ¶ã€‚</p>
<p><strong>1. <code>new Observable(subscribeFn)</code> æ„é€ å‡½æ•°</strong></p>
<p>è™½ç„¶ææ¡ˆçš„æ ¸å¿ƒæ˜¯é›†æˆ <code>EventTarget</code>ï¼Œä½† Observable æœ¬èº«ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºã€‚æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª<strong>è®¢é˜…å‡½æ•° (subscribe function)</strong> <code>subscribeFn</code> ä½œä¸ºå‚æ•°ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> myObservable</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Observable</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">subscriber</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // è¿™ä¸ªå‡½æ•°åœ¨æ¯æ¬¡è°ƒç”¨ myObservable.subscribe() æ—¶æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Subscription started!"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> intervalId</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> setInterval</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">      subscriber.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// å‘é€ä¸‹ä¸€ä¸ªå€¼</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      subscriber.</span><span style="color:#B392F0">complete</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// å‘é€å®Œæˆä¿¡å·ï¼Œæµç»“æŸ</span></span>
<span class="line"><span style="color:#B392F0">      clearInterval</span><span style="color:#E1E4E8">(intervalId);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }, </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // --- æ¸…ç†é€»è¾‘ (Teardown) ---</span></span>
<span class="line"><span style="color:#6A737D">  // è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–ä½¿ç”¨ subscriber.addTeardown()</span></span>
<span class="line"><span style="color:#6A737D">  // è¿™ä¸ªå‡½æ•°ä¼šåœ¨å–æ¶ˆè®¢é˜…æˆ–æµå®Œæˆ/é”™è¯¯æ—¶æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> teardown</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Subscription teardown: Clearing interval."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    clearInterval</span><span style="color:#E1E4E8">(intervalId);</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">  subscriber.</span><span style="color:#B392F0">addTeardown</span><span style="color:#E1E4E8">(teardown); </span><span style="color:#6A737D">// æ¨èæ–¹å¼</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // æˆ–è€… return teardown; // è€å¼ API å¯èƒ½è¿™æ ·</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Observable created."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> subscription</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> myObservable.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Received:"</span><span style="color:#E1E4E8">, value),</span></span>
<span class="line"><span style="color:#B392F0">  complete</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Stream complete!"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#B392F0">  error</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Stream error:"</span><span style="color:#E1E4E8">, err),</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Subscribed."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ç¨åå–æ¶ˆè®¢é˜…</span></span>
<span class="line"><span style="color:#B392F0">setTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Aborting subscription..."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  subscription.</span><span style="color:#B392F0">abort</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// å‡è®¾è¿”å›çš„å¯¹è±¡æœ‰ abort æˆ–ä½¿ç”¨ signal</span></span>
<span class="line"><span style="color:#E1E4E8">}, </span><span style="color:#79B8FF">3500</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è®¢é˜…å‡½æ•° (<code>subscribeFn</code>)</strong>: å®šä¹‰äº†å½“æœ‰äººè®¢é˜…æ—¶ï¼Œå¦‚ä½•äº§ç”Ÿæ•°æ®å¹¶å‘ç»™è®¢é˜…è€… (<code>subscriber</code>)ã€‚</li>
<li><strong>è®¢é˜…è€… (<code>subscriber</code>)</strong>: ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ <code>next()</code>, <code>error()</code>, <code>complete()</code> æ–¹æ³•ï¼Œç”¨æ¥æ¥æ”¶ Observable å‘å‡ºçš„ä¿¡å·ã€‚è¿˜æœ‰ä¸€ä¸ª <code>addTeardown()</code> æ–¹æ³•æ³¨å†Œæ¸…ç†é€»è¾‘ã€‚</li>
<li><strong>æƒ°æ€§æ‰§è¡Œ (Lazy Execution)</strong>: <code>new Observable(...)</code> åªæ˜¯åˆ›å»ºäº†è“å›¾ï¼Œ<code>subscribeFn</code> é‡Œé¢çš„ä»£ç ï¼ˆæ¯”å¦‚ <code>setInterval</code>ï¼‰åœ¨è°ƒç”¨ <code>.subscribe()</code> ä¹‹å‰<strong>ä¸ä¼š</strong>æ‰§è¡Œã€‚åªæœ‰å½“ <code>.subscribe()</code> è¢«è°ƒç”¨æ—¶ï¼Œè®¢é˜…æµç¨‹æ‰çœŸæ­£å¼€å§‹ã€‚å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>.subscribe()</code>ï¼Œæ¯æ¬¡éƒ½ä¼šç‹¬ç«‹æ‰§è¡Œä¸€æ¬¡ <code>subscribeFn</code>ã€‚</li>
<li><strong>æ¸…ç†é€»è¾‘ (Teardown)</strong>: è¿™æ˜¯ Observable çš„ç²¾é«“ä¹‹ä¸€ï¼<code>subscribeFn</code> å¿…é¡»æä¾›ä¸€ç§æ–¹å¼æ¥æ¸…ç†å®ƒæ‰€å ç”¨çš„èµ„æºï¼ˆæ¯”å¦‚æ¸…é™¤å®šæ—¶å™¨ã€ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€å…³é—­ WebSocket è¿æ¥ç­‰ï¼‰ã€‚è¿™é€šè¿‡ <code>subscriber.addTeardown()</code> æ³¨å†Œï¼Œç¡®ä¿åœ¨è®¢é˜…è¢«å–æ¶ˆ (<code>abort()</code>) æˆ–æµè‡ªç„¶ç»“æŸ (<code>complete()</code> æˆ– <code>error()</code>) æ—¶ï¼Œèµ„æºèƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚è¿™è§£å†³äº† <code>addEventListener</code> éœ€è¦æ‰‹åŠ¨ <code>removeEventListener</code> çš„ç—›ç‚¹ã€‚</li>
</ul>
<p><strong>2. åŒæ­¥ä¸å¼‚æ­¥ä¼ é€’ (Synchronous &#x26; Asynchronous Delivery)</strong></p>
<ul>
<li><strong>åŒæ­¥æ€§</strong>: ä¸ Promise ä¸åŒï¼ˆPromise çš„ <code>.then</code> å›è°ƒæ€»æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ï¼ŒObservable çš„ <code>subscriber.next()</code> è°ƒç”¨<strong>å¯ä»¥æ˜¯åŒæ­¥çš„</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå½“äº‹ä»¶æºï¼ˆå¦‚ <code>element.click()</code>ï¼‰åŒæ­¥è§¦å‘äº‹ä»¶æ—¶ï¼Œ<code>.when('click').subscribe({ next: ... })</code> ä¸­çš„ <code>next</code> å›è°ƒä¹Ÿå¯èƒ½<strong>åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ tick ä¸­åŒæ­¥æ‰§è¡Œ</strong>ã€‚
<ul>
<li><strong>é‡è¦æ€§</strong>: è¿™å¯¹äºéœ€è¦ç«‹å³å“åº”å¹¶å¯èƒ½è°ƒç”¨ <code>event.preventDefault()</code> çš„åœºæ™¯è‡³å…³é‡è¦ã€‚å¦‚æœåƒ Promise é‚£æ ·æ€»æ˜¯å¼‚æ­¥ï¼Œ<code>preventDefault()</code> å¯èƒ½å°±å¤ªæ™šäº†ï¼ˆå°¤å…¶æ˜¯åœ¨è„šæœ¬è§¦å‘äº‹ä»¶æ—¶ï¼Œå¦‚ <code>element.click()</code>ï¼‰ã€‚è¿™æ˜¯ Observable ç›¸è¾ƒäºåŸºäº Promise çš„äº‹ä»¶å¤„ç†ï¼ˆå¦‚ <code>element.on('click', async () => ...)</code> æˆ–ä¸€äº› Promise-returning æ“ä½œç¬¦ï¼‰çš„å…³é”®ä¼˜åŠ¿ä¹‹ä¸€ã€‚</li>
</ul>
</li>
<li><strong>å¼‚æ­¥æ€§</strong>: å½“ç„¶ï¼ŒObservable ä¹Ÿå¯ä»¥å¼‚æ­¥å‘é€æ•°æ®ï¼Œæ¯”å¦‚ä¸Šé¢ <code>setInterval</code> çš„ä¾‹å­ã€‚</li>
</ul>
<p><strong>3. <code>AbortController</code> ä¸å–æ¶ˆè®¢é˜…</strong></p>
<p>ç°ä»£ Observable ææ¡ˆç´§å¯†æ‹¥æŠ±äº† Web å¹³å°çš„ <code>AbortController</code> å’Œ <code>AbortSignal</code>ã€‚</p>
<ul>
<li><strong>å¤–éƒ¨å–æ¶ˆ</strong>: è°ƒç”¨ <code>.subscribe(observer, { signal })</code> æ—¶ä¼ å…¥ä¸€ä¸ª <code>AbortSignal</code>ã€‚å½“è¿™ä¸ª <code>signal</code> è¢« <code>abort()</code> æ—¶ï¼Œè®¢é˜…ä¼šè‡ªåŠ¨å–æ¶ˆï¼Œå¹¶è§¦å‘ teardown é€»è¾‘ã€‚</li>
<li><strong>å†…éƒ¨å–æ¶ˆ/Teardown</strong>: <code>subscriber</code> å¯¹è±¡å†…éƒ¨é€šå¸¸ä¼šå…³è”ä¸€ä¸ª <code>AbortSignal</code> (<code>subscriber.signal</code>)ï¼Œ<code>subscribeFn</code> å¯ä»¥ç›‘å¬è¿™ä¸ª signalï¼Œä»¥ä¾¿åœ¨è®¢é˜…è¢«å–æ¶ˆæ—¶åŠæ—¶åœæ­¢å·¥ä½œã€‚<code>addTeardown</code> æ³¨å†Œçš„å‡½æ•°ä¹Ÿä¼šåœ¨è¿™ä¸ª signal è¢« abort æ—¶è°ƒç”¨ã€‚</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// ä¾‹å­ï¼šåŒæ­¥â€œæ•°æ®æ´ªæµâ€ä¸ AbortController</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> syncObservable</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Observable</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">subscriber</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">      subscriber.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // æ£€æŸ¥è®¢é˜…æ˜¯å¦å·²è¢«å¤–éƒ¨å–æ¶ˆ</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (subscriber.signal.aborted) {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Subscription aborted internally, breaking loop."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">        break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  } </span><span style="color:#F97583">finally</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // ç¡®ä¿æ¸…ç†é€»è¾‘è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sync observable teardown."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#6A737D">  // æ³¨æ„ï¼šåŒæ­¥ Observable é€šå¸¸åœ¨å¾ªç¯ç»“æŸåæ‰ complete/error</span></span>
<span class="line"><span style="color:#6A737D">  // subscriber.complete(); // å¯èƒ½ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œå¦‚æœè¢« abort</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> controller</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> AbortController</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">syncObservable.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#B392F0">    next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sync data:"</span><span style="color:#E1E4E8">, data);</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (data </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Data > 100, aborting..."</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        controller.</span><span style="color:#B392F0">abort</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// ä»å¤–éƒ¨å–æ¶ˆè®¢é˜…</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#B392F0">    complete</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sync complete."</span><span style="color:#E1E4E8">), </span><span style="color:#6A737D">// å¯èƒ½ä¸ä¼šè¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#B392F0">    error</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sync error:"</span><span style="color:#E1E4E8">, err),</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { signal: controller.signal },</span></span>
<span class="line"><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// ä¼ å…¥ signal</span></span></code></pre>
<h2 id="äº”ç¥å…µåˆ©å™¨ç©è½¬-observable-æ“ä½œç¬¦">äº”ã€ç¥å…µåˆ©å™¨â€”â€”ç©è½¬ Observable æ“ä½œç¬¦</h2>
<p>å¦‚æœè¯´ Observable å¯¹è±¡æ˜¯å†…åŠŸå¿ƒæ³•ï¼Œé‚£æ“ä½œç¬¦ (Operators) å°±æ˜¯å„å¼å„æ ·çš„æ­¦åŠŸæ‹›å¼ã€‚å®ƒä»¬æ˜¯è®© Observable å˜å¾—å¼ºå¤§å’Œçµæ´»çš„å…³é”®ã€‚æ“ä½œç¬¦æœ¬è´¨ä¸Šæ˜¯å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ª Observableï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Observableï¼Œä¸­é—´å¯¹æ•°æ®æµè¿›è¡Œå¤„ç†ã€‚</p>
<p>ææ¡ˆä¸­å»ºè®®å†…ç½®ä¸€äº›æ ¸å¿ƒä¸”å¸¸ç”¨çš„æ“ä½œç¬¦ï¼Œå¾ˆå¤šéƒ½å€Ÿé‰´è‡ªæ•°ç»„æ–¹æ³•æˆ– TC39 çš„ Iterator Helpers ææ¡ˆï¼Œä¿æŒäº†å¹³å° API çš„ä¸€è‡´æ€§ã€‚</p>
<p><strong>åˆ†ç±»æ¥çœ‹ï¼š</strong></p>
<ol>
<li>
<p><strong>åˆ›å»ºå‹ (Creation)</strong>:</p>
<ul>
<li><code>new Observable()</code>: åŸºç¡€æ„é€ å™¨ã€‚</li>
<li><code>Observable.from()</code>: ä»å…¶ä»–ç±»å‹è½¬æ¢ï¼ˆåé¢ç»†è¯´ï¼‰ã€‚</li>
<li><code>EventTarget.when()</code>: ä» DOM äº‹ä»¶åˆ›å»ºã€‚</li>
</ul>
</li>
<li>
<p><strong>è½¬æ¢å‹ (Transformation)</strong>:</p>
<ul>
<li><code>map(fn)</code>: å¯¹æµä¸­çš„æ¯ä¸ªå€¼åº”ç”¨å‡½æ•° <code>fn</code>ï¼Œå‘å‡ºè½¬æ¢åçš„å€¼ã€‚
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">source.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// æŠŠæ¯ä¸ªå€¼ä¹˜ä»¥ 2</span></span></code></pre>
</li>
<li><code>filter(fn)</code>: åªå‘å‡ºæµä¸­æ»¡è¶³æ¡ä»¶ <code>fn(value)</code> ä¸º <code>true</code> çš„å€¼ã€‚
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">source.</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> ===</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// åªä¿ç•™å¶æ•°</span></span></code></pre>
</li>
<li><code>flatMap(fn)</code> / <code>switchMap(fn)</code>: <code>map</code> çš„å‡çº§ç‰ˆã€‚<code>fn</code> éœ€è¦è¿”å›ä¸€ä¸ª Observableã€‚<code>flatMap</code> ä¼šè®¢é˜…æ‰€æœ‰è¿”å›çš„å†…éƒ¨ Observable å¹¶åˆå¹¶å®ƒä»¬çš„è¾“å‡ºï¼›<code>switchMap</code> åˆ™åªå…³å¿ƒæœ€æ–°çš„å†…éƒ¨ Observableï¼Œå½“å¤–éƒ¨ Observable å‘å‡ºæ–°å€¼æ—¶ï¼Œä¼šå–æ¶ˆè®¢é˜…ä¸Šä¸€ä¸ªå†…éƒ¨ Observableã€‚å¸¸ç”¨äºå¤„ç†å¼‚æ­¥è¯·æ±‚ï¼ˆå¦‚æœç´¢å»ºè®®ï¼‰ã€‚
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// æ¯æ¬¡è¾“å…¥ï¼Œå‘èµ·è¯·æ±‚ï¼Œä½†åªå…³å¿ƒæœ€æ–°è¾“å…¥çš„ç»“æœ</span></span>
<span class="line"><span style="color:#E1E4E8">inputElement</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"input"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">switchMap</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span></span>
<span class="line"><span style="color:#E1E4E8">    Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`/api/search?q=${</span><span style="color:#E1E4E8">e</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">target</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">value</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">)),</span></span>
<span class="line"><span style="color:#E1E4E8">  )</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">results</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> updateUI</span><span style="color:#E1E4E8">(results));</span></span></code></pre>
</li>
</ul>
</li>
<li>
<p><strong>è¿‡æ»¤/é™åˆ¶å‹ (Filtering/Limiting)</strong>:</p>
<ul>
<li><code>take(n)</code>: åªå–æµä¸­çš„å‰ <code>n</code> ä¸ªå€¼ï¼Œç„¶åå®Œæˆã€‚</li>
<li><code>drop(n)</code>: è·³è¿‡æµä¸­çš„å‰ <code>n</code> ä¸ªå€¼ã€‚</li>
<li><code>takeUntil(notifierObservable)</code>: æŒç»­å‘å‡ºå€¼ï¼Œç›´åˆ° <code>notifierObservable</code> å‘å‡ºç¬¬ä¸€ä¸ªå€¼æˆ–å®Œæˆ/é”™è¯¯ï¼Œç„¶åå®Œæˆã€‚è¿™æ˜¯å®ç°<strong>å£°æ˜å¼å–æ¶ˆ</strong>çš„å…³é”®ï¼å¸¸ç”¨äºæ‹–æ‹½ã€æ¸¸æˆåºåˆ—ç­‰ã€‚
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// æ‹–æ‹½ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#E1E4E8">mousedown$</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">flatMap</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> mousemove$.</span><span style="color:#B392F0">takeUntil</span><span style="color:#E1E4E8">(mouseup$))</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">pos</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> updateElementPosition</span><span style="color:#E1E4E8">(pos));</span></span></code></pre>
</li>
<li><code>filter(fn)</code>: (å‰é¢å·²æ)</li>
</ul>
</li>
<li>
<p><strong>ç»„åˆå‹ (Combination)</strong>: (ææ¡ˆåˆæœŸå¯èƒ½ä¸åŒ…å«ï¼Œä½† userland å¸¸è§)</p>
<ul>
<li><code>merge(obs1, obs2, ...)</code>: åˆå¹¶å¤šä¸ªæµï¼Œä»»ä½•ä¸€ä¸ªæµå‘å€¼éƒ½å‘å‡ºã€‚</li>
<li><code>concat(obs1, obs2, ...)</code>: æŒ‰é¡ºåºè¿æ¥å¤šä¸ªæµï¼Œç­‰å‰ä¸€ä¸ªå®Œæˆåå†è®¢é˜…ä¸‹ä¸€ä¸ªã€‚</li>
<li><code>zip(obs1, obs2, ...)</code>: å°†å¤šä¸ªæµçš„å€¼æŒ‰é¡ºåºé…å¯¹å‘å‡ºã€‚</li>
</ul>
</li>
<li>
<p><strong>èšåˆ/ç»ˆæ­¢å‹ (Aggregation/Termination)</strong>: è¿™ç±»æ“ä½œç¬¦é€šå¸¸ä¼šæ¶ˆè´¹æ•´ä¸ªï¼ˆæˆ–éƒ¨åˆ†ï¼‰æµï¼Œå¹¶è¿”å›ä¸€ä¸ª<strong>Promise</strong>ã€‚</p>
<ul>
<li><code>reduce(fn, initialValue)</code>: ç±»ä¼¼æ•°ç»„çš„ reduceï¼Œå¯¹æµä¸­æ‰€æœ‰å€¼è¿›è¡Œç´¯åŠ è®¡ç®—ï¼Œæµå®Œæˆå Promise resolve æœ€ç»ˆç»“æœã€‚
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// è®¡ç®—é¼ æ ‡æŒ‰ä¸‹æœŸé—´ Y åæ ‡æœ€å¤§å€¼ (Example 4 from README)</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> maxY</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> element</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mousemove"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">takeUntil</span><span style="color:#E1E4E8">(element.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mouseup"</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> e.clientY)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">reduce</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">max</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">max</span><span style="color:#E1E4E8">(max, y), </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span></code></pre>
</li>
<li><code>toArray()</code>: æ”¶é›†æµä¸­æ‰€æœ‰å€¼åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œæµå®Œæˆå Promise resolve è¿™ä¸ªæ•°ç»„ã€‚</li>
<li><code>forEach(fn)</code>: å¯¹æµä¸­æ¯ä¸ªå€¼æ‰§è¡Œ <code>fn</code>ï¼Œæµå®Œæˆå Promise resolve <code>undefined</code>ã€‚</li>
<li><code>first()</code> / <code>last()</code>: è·å–ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªå€¼ï¼Œç„¶åå®Œæˆæµï¼ŒPromise resolve è¯¥å€¼ã€‚</li>
<li><code>find(fn)</code> / <code>some(fn)</code> / <code>every(fn)</code>: ç±»ä¼¼æ•°ç»„æ–¹æ³•ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„/æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„/æ˜¯å¦æ‰€æœ‰éƒ½æ»¡è¶³æ¡ä»¶ï¼ŒPromise resolve ç»“æœã€‚</li>
</ul>
</li>
</ol>
<p><strong>âš ï¸ <code>preventDefault</code> çš„å†æ¬¡è­¦ç¤º</strong></p>
<p>å¯¹äºä¸Šé¢é‚£äº›<strong>è¿”å› Promise</strong> çš„èšåˆ/ç»ˆæ­¢å‹æ“ä½œç¬¦ï¼ˆå¦‚ <code>reduce</code>, <code>find</code>, <code>first</code> ç­‰ï¼‰ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ <code>preventDefault()</code> çš„é—®é¢˜ï¼</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// æ½œåœ¨é—®é¢˜ä»£ç </span></span>
<span class="line"><span style="color:#E1E4E8">element</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"click"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">first</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // è¿™ä¸ª then å›è°ƒæ˜¯å¼‚æ­¥ï¼ˆå¾®ä»»åŠ¡ï¼‰æ‰§è¡Œçš„</span></span>
<span class="line"><span style="color:#E1E4E8">    e.</span><span style="color:#B392F0">preventDefault</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// å¯¹äºè„šæœ¬è§¦å‘çš„ clickï¼Œè¿™é‡Œå¯èƒ½å¤ªæ™šäº†ï¼</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span></code></pre>
<p>å› ä¸º <code>.then()</code> çš„å›è°ƒæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœ <code>click</code> äº‹ä»¶æ˜¯ç”±è„šæœ¬ï¼ˆå¦‚ <code>element.click()</code>ï¼‰åŒæ­¥è§¦å‘çš„ï¼Œäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºå¯èƒ½åœ¨ <code>then()</code> å›è°ƒæ‰§è¡Œå‰å°±å·²ç»å‘ç”Ÿäº†ï¼Œå¯¼è‡´ <code>preventDefault()</code> æ— æ•ˆã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> åœ¨ Promise äº§ç”Ÿä¹‹å‰ï¼ŒåŒæ­¥åœ°å¤„ç† <code>preventDefault</code>ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ map åŒæ­¥å¤„ç†</span></span>
<span class="line"><span style="color:#E1E4E8">element.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'click'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    e.</span><span style="color:#B392F0">preventDefault</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// åœ¨ map ä¸­åŒæ­¥è°ƒç”¨</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> e; </span><span style="color:#6A737D">// ä»ç„¶ä¼ é€’äº‹ä»¶å¯¹è±¡</span></span>
<span class="line"><span style="color:#E1E4E8">  })</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">first</span><span style="color:#E1E4E8">() </span><span style="color:#6A737D">// first ç°åœ¨æ¥æ”¶çš„æ˜¯å·²ç»é˜»æ­¢äº†é»˜è®¤è¡Œä¸ºçš„äº‹ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // åšå…¶ä»–äº‹æƒ…...</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ–¹æ¡ˆäºŒï¼šå¦‚æœææ¡ˆæ”¯æŒ .do() æˆ– tap() æ“ä½œç¬¦ (çº¯å‰¯ä½œç”¨)</span></span>
<span class="line"><span style="color:#E1E4E8">element.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'click'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">do</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> e.</span><span style="color:#B392F0">preventDefault</span><span style="color:#E1E4E8">()) </span><span style="color:#6A737D">// åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">first</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">...</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ–¹æ¡ˆä¸‰ï¼šå¦‚æœ first() æ”¯æŒä¼ å…¥å›è°ƒ (æ›´ç‰¹å®š)</span></span>
<span class="line"><span style="color:#E1E4E8">element.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'click'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">first</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> e.</span><span style="color:#B392F0">preventDefault</span><span style="color:#E1E4E8">()) </span><span style="color:#6A737D">// åœ¨ first å†…éƒ¨åŒæ­¥å¤„ç†</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">e</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">...</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<p>è¿™æ˜¯ä½¿ç”¨ Observable æ—¶éœ€è¦ç‰¢è®°çš„ä¸€ä¸ªé‡è¦ç»†èŠ‚ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ RxJS ç­‰åº“ä¸­å·²å­˜åœ¨å¤šå¹´ï¼Œç¤¾åŒºå·²ç»ä¹ æƒ¯å¹¶æ‰¾åˆ°äº†åº”å¯¹æ–¹æ³•ï¼Œæ‰€ä»¥ä¸å¿…è¿‡äºææ…Œã€‚</p>
<h2 id="å…­ä¸‡ç‰©çš†å¯-observableobservablefrom">å…­ã€ä¸‡ç‰©çš†å¯ Observableâ€”â€”<code>Observable.from()</code></h2>
<p>ä¸ºäº†è®© Observable èƒ½æ›´å¥½åœ°èå…¥ç°æœ‰ç”Ÿæ€ï¼Œææ¡ˆæä¾›äº† <code>Observable.from()</code> é™æ€æ–¹æ³•ï¼Œå¯ä»¥å°†å¤šç§ç±»å‹çš„å€¼è½¬æ¢æˆ Observableï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6A737D">// 1. ä» Promise åˆ›å»º</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"/api/data"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promiseObservable</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(promise);</span></span>
<span class="line"><span style="color:#E1E4E8">promiseObservable.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Data from promise:"</span><span style="color:#E1E4E8">, data), </span><span style="color:#6A737D">// Promise resolve æ—¶è§¦å‘ next å’Œ complete</span></span>
<span class="line"><span style="color:#B392F0">  error</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Fetch error:"</span><span style="color:#E1E4E8">, err), </span><span style="color:#6A737D">// Promise reject æ—¶è§¦å‘ error</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 2. ä»æ•°ç»„ (Iterable) åˆ›å»º</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> array</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> arrayObservable</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(array);</span></span>
<span class="line"><span style="color:#E1E4E8">arrayObservable.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Value from array:"</span><span style="color:#E1E4E8">, value), </span><span style="color:#6A737D">// åŒæ­¥ä¾æ¬¡å‘å‡º 1, 2, 3</span></span>
<span class="line"><span style="color:#B392F0">  complete</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Array stream complete."</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 3. ä»å¼‚æ­¥è¿­ä»£å™¨ (AsyncIterable) åˆ›å»º (ä¾‹å¦‚ ReadableStream)</span></span>
<span class="line"><span style="color:#F97583">async</span><span style="color:#F97583"> function*</span><span style="color:#B392F0"> asyncGenerator</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#9ECBFF"> "a"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> setTimeout</span><span style="color:#E1E4E8">(resolve, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#9ECBFF"> "b"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> asyncObservable</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">asyncGenerator</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">asyncObservable.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Value from async iterable:"</span><span style="color:#E1E4E8">, value), </span><span style="color:#6A737D">// å¼‚æ­¥å‘å‡º 'a', 'b'</span></span>
<span class="line"><span style="color:#B392F0">  complete</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Async stream complete."</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 4. ä»å¦ä¸€ä¸ª Observable åˆ›å»º (å¹‚ç­‰)</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> source</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">([</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> sameObservable</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(source); </span><span style="color:#6A737D">// ç›´æ¥è¿”å› source</span></span></code></pre>
<p>è¿™ä¸ª <code>from()</code> æ–¹æ³•æå¤§åœ°å¢å¼ºäº† Observable çš„é€šç”¨æ€§ï¼Œè®©å®ƒå¯ä»¥æ–¹ä¾¿åœ°æ¡¥æ¥å…¶ä»–å¼‚æ­¥æ¨¡å¼ã€‚</p>
<h2 id="ä¸ƒèä¼šè´¯é€šå®æˆ˜åœºæ™¯æ¼”ç»ƒ">ä¸ƒã€èä¼šè´¯é€šâ€”â€”å®æˆ˜åœºæ™¯æ¼”ç»ƒ</h2>
<p>ç†è®ºè¯´äº†ä¸å°‘ï¼Œæ¥çœ‹å‡ ä¸ªæ›´æ¥è¿‘çœŸå®ä¸–ç•Œçš„ä¾‹å­ï¼Œæ„Ÿå— Observable çš„å¨åŠ›ã€‚</p>
<p><strong>åœºæ™¯ 1ï¼šWebSocket æ¶ˆæ¯å¤šè·¯å¤ç”¨ (Multiplexing)</strong> (æ¥è‡ªå®˜æ–¹ <a href="https://github.com/WICG/observable/blob/master/README.md">README</a> Example 5)</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ª WebSocket è¿æ¥éœ€è¦åŒæ—¶å¤„ç†å¤šç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆæ¯”å¦‚ä¸åŒè‚¡ç¥¨çš„æŠ¥ä»·ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›ä¸ºæ¯ç§ç±»å‹çš„æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ Observable æµï¼Œå¹¶ä¸”å½“è®¢é˜…æŸä¸ªæµæ—¶è‡ªåŠ¨å‘é€è®¢é˜…æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼Œå–æ¶ˆè®¢é˜…æ—¶è‡ªåŠ¨å‘é€å–æ¶ˆè®¢é˜…æ¶ˆæ¯ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> socket</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> WebSocket</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"wss://example.com"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// é€šç”¨çš„å¤šè·¯å¤ç”¨å‡½æ•°</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> multiplex</span><span style="color:#E1E4E8">({ </span><span style="color:#FFAB70">startMsg</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">stopMsg</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">match</span><span style="color:#E1E4E8"> }) {</span></span>
<span class="line"><span style="color:#6A737D">  // ç­‰å¾… socket è¿æ¥æˆåŠŸ</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> readyToSend$</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#E1E4E8">    socket.readyState </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> WebSocket.</span><span style="color:#79B8FF">OPEN</span></span>
<span class="line"><span style="color:#F97583">      ?</span><span style="color:#E1E4E8"> Observable.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">([</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">]) </span><span style="color:#6A737D">// å·²è¿æ¥ï¼Œç«‹å³å‘é€</span></span>
<span class="line"><span style="color:#F97583">      :</span><span style="color:#E1E4E8"> socket</span></span>
<span class="line"><span style="color:#E1E4E8">          .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"open"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">          .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">          .</span><span style="color:#B392F0">take</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// ç­‰å¾… open äº‹ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> readyToSend$.</span><span style="color:#B392F0">flatMap</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sending start message:"</span><span style="color:#E1E4E8">, startMsg);</span></span>
<span class="line"><span style="color:#E1E4E8">    socket.</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(startMsg));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // è¿”å›ä¸€ä¸ª Observableï¼Œå®ƒï¼š</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> socket</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// ç›‘å¬æ‰€æœ‰æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">parse</span><span style="color:#E1E4E8">(e.data)) </span><span style="color:#6A737D">// è§£æ JSON æ•°æ®</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">(match) </span><span style="color:#6A737D">// è¿‡æ»¤å‡ºåŒ¹é…çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">takeUntil</span><span style="color:#E1E4E8">(socket.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"close"</span><span style="color:#E1E4E8">)) </span><span style="color:#6A737D">// å½“ socket å…³é—­æ—¶åœæ­¢</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">takeUntil</span><span style="color:#E1E4E8">(socket.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"error"</span><span style="color:#E1E4E8">)) </span><span style="color:#6A737D">// å½“ socket é”™è¯¯æ—¶åœæ­¢</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">finally</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">        // æ— è®ºå¦‚ä½•ç»“æŸï¼Œéƒ½æ‰§è¡Œæ¸…ç†</span></span>
<span class="line"><span style="color:#6A737D">        // æ¸…ç†é€»è¾‘ï¼šå‘é€åœæ­¢æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (socket.readyState </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> WebSocket.</span><span style="color:#79B8FF">OPEN</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">          console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sending stop message:"</span><span style="color:#E1E4E8">, stopMsg);</span></span>
<span class="line"><span style="color:#E1E4E8">          socket.</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(stopMsg));</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ç‰¹å®šè‚¡ç¥¨æµçš„å·¥å‚å‡½æ•°</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> streamStock</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ticker</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> multiplex</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    startMsg: { ticker, type: </span><span style="color:#9ECBFF">"sub"</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">    stopMsg: { ticker, type: </span><span style="color:#9ECBFF">"unsub"</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#B392F0">    match</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> data.ticker </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> ticker, </span><span style="color:#6A737D">// åŒ¹é…å¯¹åº” ticker çš„æ•°æ®</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// åˆ›å»ºä¸åŒè‚¡ç¥¨çš„æµ</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> googTrades$</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> streamStock</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"GOOG"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> nflxTrades$</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> streamStock</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"NFLX"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// è®¢é˜… GOOG è‚¡ç¥¨æµ</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> googSubscription</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> googTrades$.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({ next: updateGoogView });</span></span>
<span class="line"><span style="color:#6A737D">// è®¢é˜… NFLX è‚¡ç¥¨æµ</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> nflxSubscription</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> nflxTrades$.</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">({ next: updateNflxView });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ç¨åï¼Œç”¨æˆ·ä¸æƒ³çœ‹ GOOG äº†</span></span>
<span class="line"><span style="color:#E1E4E8">googSubscription.</span><span style="color:#B392F0">abort</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// å–æ¶ˆè®¢é˜…ï¼Œä¼šè‡ªåŠ¨è§¦å‘ finally å‘é€ unsub æ¶ˆæ¯</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// å¦‚æœ socket æ„å¤–å…³é—­æˆ–å‡ºé”™ï¼Œæ‰€æœ‰æµä¹Ÿä¼šè‡ªåŠ¨åœæ­¢å¹¶å°è¯•å‘é€ unsub</span></span></code></pre>
<p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº† Observable å¦‚ä½•ä¼˜é›…åœ°å¤„ç†ï¼š</p>
<ul>
<li>å¼‚æ­¥ä¾èµ–ï¼ˆç­‰å¾… socket openï¼‰</li>
<li>äº‹ä»¶æµçš„è¿‡æ»¤å’Œè½¬æ¢</li>
<li>å¤šä¸ªç»ˆæ­¢æ¡ä»¶ (<code>takeUntil</code>)</li>
<li>èµ„æºæ¸…ç† (<code>finally</code>ï¼Œç¡®ä¿å‘é€å–æ¶ˆè®¢é˜…æ¶ˆæ¯)</li>
</ul>
<p><strong>åœºæ™¯ 2ï¼šå®ç°â€œç§˜å¯†æŒ‡ä»¤â€è¾“å…¥æ£€æµ‹</strong> (æ¥è‡ªå®˜æ–¹ <a href="https://github.com/WICG/observable/blob/master/README.md">README</a> Example 6)</p>
<p>æ£€æµ‹ç”¨æˆ·æ˜¯å¦æŒ‰é¡ºåºè¾“å…¥äº†ä¸€ç³»åˆ—ç‰¹å®šçš„æŒ‰é”®ï¼ˆæ¯”å¦‚ç»å…¸çš„ Konami Codeï¼‰ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> konamiCode</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowUp"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowUp"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowDown"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowDown"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowLeft"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowRight"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowLeft"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ArrowRight"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "b"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "a"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "Enter"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> keydown$</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">when</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"keydown"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> e.key);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">keydown$</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">bufferCount</span><span style="color:#E1E4E8">(konamiCode.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// åˆ›å»ºä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œæ¯æ¬¡åŒ…å« 11 ä¸ªæŒ‰é”®</span></span>
<span class="line"><span style="color:#6A737D">  // .buffer(keydown$.debounceTime(1000)) // æˆ–è€…ç”¨ buffer + debounceTime æ£€æµ‹è¿ç»­æŒ‰é”®åºåˆ—</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">keys</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> keys.</span><span style="color:#B392F0">every</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">key</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">i</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> konamiCode[i])) </span><span style="color:#6A737D">// æ£€æŸ¥çª—å£å†…å®¹æ˜¯å¦åŒ¹é…</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">subscribe</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Konami Code Entered! ğŸ‰"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">    // æ‰§è¡Œä½ çš„å½©è›‹é€»è¾‘...</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// RxJS å¯èƒ½æœ‰æ›´ç›´æ¥çš„æ“ä½œç¬¦å¦‚ sequenceEqual æˆ– window/buffer ç»„åˆ</span></span>
<span class="line"><span style="color:#6A737D">// ä¸Šé¢çš„ bufferCount æ˜¯ä¸€ä¸ªç®€åŒ–çš„æ€è·¯ï¼Œå®é™…å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#6A737D">// æ¯”å¦‚ RxJS çš„ï¼š</span></span>
<span class="line"><span style="color:#6A737D">// keydown$.windowCount(konamiCode.length, 1)</span></span>
<span class="line"><span style="color:#6A737D">//   .flatMap(window => window.sequenceEqual(Observable.from(konamiCode)))</span></span>
<span class="line"><span style="color:#6A737D">//   .filter(matches => matches)</span></span>
<span class="line"><span style="color:#6A737D">//   .subscribe(() => console.log('Konami Code Entered! ğŸ‰'));</span></span></code></pre>
<p><em>(æ³¨ï¼šåŸç”Ÿ Observable ææ¡ˆåˆæœŸå¯èƒ½ä¸åŒ…å« <code>bufferCount</code>ã€<code>windowCount</code>ã€<code>sequenceEqual</code> ç­‰é«˜çº§æ“ä½œç¬¦ï¼Œè¿™é‡Œä»…ä½œç¤ºä¾‹ã€‚ä½†è¿™ä¸ªä¾‹å­å±•ç¤ºäº† Observable åœ¨å¤„ç†åºåˆ—æ¨¡å¼åŒ¹é…æ–¹é¢çš„æ½œåŠ›ã€‚)</em></p>
<p>è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé€šè¿‡ç»„åˆæ“ä½œç¬¦ï¼ŒObservable å¯ä»¥ç”¨æ¥è¯†åˆ«å’Œå“åº”å¤æ‚çš„äº‹ä»¶æ¨¡å¼ã€‚</p>
<h2 id="å…«ç«™åœ¨å·¨äººè‚©ä¸Šæ€»ç»“ä¸å±•æœ›">å…«ã€ç«™åœ¨å·¨äººè‚©ä¸Šâ€”â€”æ€»ç»“ä¸å±•æœ›</h2>
<p>å¥½äº†ï¼Œå…³äº Observableï¼Œæˆ‘ä»¬ä»ç†å¿µåˆ°å®è·µï¼ŒèŠäº†ä¸å°‘ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç«™åœ¨å¼€å‘è€…å’Œææ¡ˆè€…çš„è§’åº¦ï¼Œåšä¸ªæ€»ç»“å’Œå±•æœ›ã€‚</p>
<p><strong>å¼€å‘è€…è§†è§’ï¼šObservable å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li><strong>ä»£ç æ›´ä¼˜é›…</strong>: å£°æ˜å¼çš„é“¾å¼è°ƒç”¨ï¼Œè®©å¤æ‚çš„å¼‚æ­¥äº‹ä»¶å¤„ç†é€»è¾‘ï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€ç»„åˆã€èŠ‚æµã€é˜²æŠ–ã€å–æ¶ˆï¼‰å˜å¾—æ›´æ¸…æ™°ã€æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤ã€‚</li>
<li><strong>è§£æ”¾åŒæ‰‹</strong>: è‡ªåŠ¨çš„èµ„æºç®¡ç†ï¼ˆTeardown æœºåˆ¶ï¼‰ï¼Œè®©ä½ å‘Šåˆ«æ‰‹åŠ¨ <code>removeEventListener</code> çš„çƒ¦æ¼å’Œæ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚</li>
<li><strong>ç»Ÿä¸€æ¨¡å‹</strong>: æœ‰æœ›æä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€å¼ºå¤§çš„æ¨¡å‹æ¥å¤„ç†å„ç§å¼‚æ­¥æ•°æ®æµï¼Œä¸ä»…ä»…æ˜¯ DOM äº‹ä»¶ï¼Œè¿˜åŒ…æ‹¬åŠ¨ç”»ã€ç½‘ç»œè¯·æ±‚ã€ç”¨æˆ·è¾“å…¥ç­‰ã€‚</li>
<li><strong>æ€§èƒ½æ½œåŠ›</strong>: åŸç”Ÿå®ç°é€šå¸¸æ¯”ç”¨æˆ·æ€åº“æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥æ›´å¥½åœ°ä¸æµè§ˆå™¨ DevTools é›†æˆï¼Œæä¾›æ›´å¥½çš„è°ƒè¯•ä½“éªŒã€‚</li>
<li><strong>æ½œåœ¨çš„ Bundle Size å‡å°</strong>: å¦‚æœ Observable æˆä¸ºåŸç”Ÿ APIï¼Œé‚£ä¹ˆåƒ RxJS è¿™æ ·çš„åº“å¯ä»¥åšå¾—æ›´å°ï¼ˆåªæä¾›åŸç”Ÿä¸åŒ…å«çš„æ“ä½œç¬¦ï¼‰ï¼Œæˆ–è€…å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨åŸç”Ÿ APIï¼Œå‡å°‘é¡¹ç›®ä¾èµ–ä½“ç§¯ã€‚</li>
<li><strong>éœ€è¦æ³¨æ„çš„å‘</strong>: ä¸»è¦æ˜¯ Promise-returning æ“ä½œç¬¦ä¸ <code>preventDefault()</code> çš„äº¤äº’é—®é¢˜ï¼Œéœ€è¦å…»æˆè‰¯å¥½çš„å¤„ç†ä¹ æƒ¯ã€‚</li>
</ol>
<p><strong>ææ¡ˆè€…è§†è§’ï¼šé“é˜»ä¸”é•¿ï¼Œè¡Œåˆ™å°†è‡³</strong></p>
<ol>
<li><strong>æ¼«æ¼«é•¿è·¯</strong>: Observable çš„æ ‡å‡†åŒ–ä¹‹è·¯å¼‚å¸¸åå·ï¼Œåæ˜ äº†åœ¨ Web å¹³å°æ·»åŠ æ–°åŸºç¡€åŸè¯­çš„å¤æ‚æ€§å’ŒæŒ‘æˆ˜æ€§ï¼ˆè¯­è¨€ vs. å¹³å°ï¼ŒAPI è®¾è®¡ç»†èŠ‚ï¼Œå‚å•†åè°ƒç­‰ï¼‰ã€‚</li>
<li><strong>ç¤¾åŒºåŠ›é‡</strong>: ç”¨æˆ·æ€åº“çš„å·¨å¤§æˆåŠŸå’Œå¹¿æ³›åº”ç”¨ï¼Œæ˜¯æ¨åŠ¨å…¶æ ‡å‡†åŒ–çš„æœ€æœ‰åŠ›æ­¦å™¨ã€‚å®ƒè¯æ˜äº†å¼€å‘è€…ç¡®å®éœ€è¦è¿™æ ·çš„å·¥å…·ã€‚</li>
<li><strong>å¹³å°æ•´åˆ</strong>: å°† Observable ä¸ <code>EventTarget</code>ã€<code>AbortController</code> ç­‰ç°æœ‰å¹³å°ç‰¹æ€§æ·±åº¦æ•´åˆï¼Œæ˜¯å…¶æœ€ç»ˆæˆåŠŸçš„å…³é”®ã€‚å®ƒä¸æ˜¯å­¤ç«‹çš„ APIï¼Œè€Œæ˜¯ Web å¼‚æ­¥å¤„ç†ç”Ÿæ€çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><strong>æœªæ¥å¯æœŸ</strong>: éšç€ææ¡ˆåœ¨ WICG çš„æ¨è¿›ï¼Œä»¥åŠ Chrome 135 å·²ç»ä¸Šæ¶äº† Observable APIï¼Œï¼Œæˆ‘ä»¬æœ‰ç†ç”±æœŸå¾…ï¼Œåœ¨ä¸ä¹…çš„å°†æ¥ï¼Œæˆ–è®¸å°±èƒ½åœ¨æ›´å¤šçš„æµè§ˆå™¨ä¸­åŸç”Ÿä½¿ç”¨ <code>Observable</code> äº†ã€‚</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<p>Observable ä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒç¡®å®ä¸ºæˆ‘ä»¬å¤„ç† Web å¼‚æ­¥äº‹ä»¶æµæä¾›äº†ä¸€å¥—å¼ºå¤§è€Œä¼˜é›…çš„èŒƒå¼ã€‚å®ƒé¼“åŠ±æˆ‘ä»¬ç”¨<strong>å£°æ˜å¼</strong>çš„æ€ç»´å»æ„å»º<strong>å¯ç»„åˆ</strong>ã€<strong>æ˜“äºç®¡ç†</strong>çš„äº‹ä»¶å¤„ç†é€»è¾‘ã€‚è™½ç„¶å®ƒçš„æ ‡å‡†åŒ–å†ç¨‹å……æ»¡æ³¢æŠ˜ï¼Œä½†å…¶èƒŒåè•´å«çš„å“åº”å¼ç¼–ç¨‹æ€æƒ³ï¼Œä»¥åŠåœ¨ç¤¾åŒºä¸­å±•ç°å‡ºçš„å¼ºå¤§ç”Ÿå‘½åŠ›ï¼Œéƒ½é¢„ç¤ºç€å®ƒå¯èƒ½æ˜¯ Web å¼€å‘çš„ä¸‹ä¸€ä¸ªé‡è¦åŸºçŸ³ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ æ­å¼€ Observable çš„ç¥ç§˜é¢çº±ã€‚ä½†æ˜¯ç›®å‰å¹¶æ²¡æœ‰éå¸¸é è°±çš„ <a href="https://github.com/keithamus/observable-polyfill">observable-polyfill</a> ï¼Œä½†å› ä¸ºè¿™ä¸ªææ¡ˆæœ¬èº«å°±æ˜¯ä»ç¤¾åŒºä¸­è·µè¡Œæ¼”åŒ–å‡ºæ¥çš„ï¼Œä½ å¯ä»¥åœ¨å®˜æ–¹ <a href="https://github.com/WICG/observable/blob/master/README.md#userland-libraries">README/userland-libraries</a> æ‰¾åˆ°ä¸€äº›ç›¸ä¼¼çš„åº“ï¼Œæå‰æ„Ÿå—å“åº”å¼ç¼–ç¨‹çš„é­…åŠ›å§ï¼</p> </div> </article>  </div> </main> <aside class="hidden lg:block sticky top-0 h-screen w-64 flex-shrink-0 py-8 pl-8"> <div class="space-y-4"> <div class="rounded-xl border bg-card text-card-foreground shadow"><div class="p-6 pt-0"><ul><li><a href="#ä¸€observable-çš„çµé­‚æ‹·é—®å®ƒåˆ°åº•æƒ³å¹²å•¥">ä¸€ã€Observable çš„çµé­‚æ‹·é—®â€”â€”å®ƒåˆ°åº•æƒ³å¹²å•¥ï¼Ÿ</a></li><li><a href="#äºŒå‰ä¸–ä»Šç”Ÿobservable-çš„é•¿å¾è·¯">äºŒã€å‰ä¸–ä»Šç”Ÿâ€”â€”Observable çš„â€œé•¿å¾è·¯â€</a></li><li><a href="#ä¸‰å°è¯•ç‰›åˆ€eventtargetwhen-åˆä½“éªŒ">ä¸‰ã€å°è¯•ç‰›åˆ€â€”â€”EventTarget.when() åˆä½“éªŒ</a></li><li><a href="#å››ç™»å ‚å…¥å®¤æ ¸å¿ƒ-observable-api-ä¸æ¦‚å¿µ">å››ã€ç™»å ‚å…¥å®¤â€”â€”æ ¸å¿ƒ Observable API ä¸æ¦‚å¿µ</a></li><li><a href="#äº”ç¥å…µåˆ©å™¨ç©è½¬-observable-æ“ä½œç¬¦">äº”ã€ç¥å…µåˆ©å™¨â€”â€”ç©è½¬ Observable æ“ä½œç¬¦</a></li><li><a href="#å…­ä¸‡ç‰©çš†å¯-observableobservablefrom">å…­ã€ä¸‡ç‰©çš†å¯ Observableâ€”â€”Observable.from()</a></li><li><a href="#ä¸ƒèä¼šè´¯é€šå®æˆ˜åœºæ™¯æ¼”ç»ƒ">ä¸ƒã€èä¼šè´¯é€šâ€”â€”å®æˆ˜åœºæ™¯æ¼”ç»ƒ</a></li><li><a href="#å…«ç«™åœ¨å·¨äººè‚©ä¸Šæ€»ç»“ä¸å±•æœ›">å…«ã€ç«™åœ¨å·¨äººè‚©ä¸Šâ€”â€”æ€»ç»“ä¸å±•æœ›</a></li></ul></div></div> <div class="rounded-xl border bg-card text-card-foreground shadow"><div class="flex flex-col space-y-1.5 p-6"><div class="font-semibold leading-none tracking-tight">Tags</div></div><div class="p-6 pt-0"><div class="flex flex-wrap gap-2"><a href="/tags/article" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">article</a><a href="/tags/event" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">event</a><a href="/tags/rust" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">rust</a><a href="/tags/iced" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">iced</a><a href="/tags/gui" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">gui</a><a href="/tags/multiplatform" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">multiplatform</a><a href="/tags/mobile" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">mobile</a><a href="/tags/web" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">web</a><a href="/tags/Kotlin" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">Kotlin</a><a href="/tags/linux" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">linux</a><a href="/tags/dns" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">dns</a><a href="/tags/javascript" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">javascript</a><a href="/tags/async" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">async</a><a href="/tags/reactive" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">reactive</a><a href="/tags/html&amp;css" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">html&amp;css</a><a href="/tags/cogitation" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">cogitation</a><a href="/tags/tools" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">tools</a><a href="/tags/efficiency" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">efficiency</a><a href="/tags/trivial" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">trivial</a><a href="/tags/lift" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">lift</a><a href="/tags/C++" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">C++</a></div></div></div> <div class="rounded-xl border bg-card text-card-foreground shadow"><div class="flex flex-col space-y-1.5 p-6"><div class="font-semibold leading-none tracking-tight">Archive</div></div><div class="p-6 pt-0"><ul><li><a href="/archive/2025/09">2025-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2025/06">2025-06<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2025/05">2025-05<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2025/04">2025-04<!-- --> (<!-- -->12<!-- -->)</a></li><li><a href="/archive/2025/03">2025-03<!-- --> (<!-- -->9<!-- -->)</a></li><li><a href="/archive/2024/05">2024-05<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2024/04">2024-04<!-- --> (<!-- -->3<!-- -->)</a></li><li><a href="/archive/2023/05">2023-05<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2023/04">2023-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2023/03">2023-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2022/10">2022-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2022/04">2022-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2021/12">2021-12<!-- --> (<!-- -->3<!-- -->)</a></li><li><a href="/archive/2021/07">2021-07<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2021/04">2021-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/10">2020-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/09">2020-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/05">2020-05<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2020/04">2020-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/03">2020-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2018/07">2018-07<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2017/10">2017-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2017/03">2017-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/10">2016-10<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2016/09">2016-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/08">2016-08<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/07">2016-07<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/05">2016-05<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/03">2016-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/02">2016-02<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2015/02">2015-02<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2014/09">2014-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2014/04">2014-04<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2014/03">2014-03<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2014/02">2014-02<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2014/01">2014-01<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2013/12">2013-12<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/10">2013-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/09">2013-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/08">2013-08<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2013/07">2013-07<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2013/06">2013-06<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/05">2013-05<!-- --> (<!-- -->4<!-- -->)</a></li></ul></div></div> </div> </aside> </div> <astro-island uid="twXPy" prefix="r12" component-url="/_astro/Footer.DbUwA-sc.js" component-export="default" renderer-url="/_astro/client.D0HLj-jK.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;Footer&quot;,&quot;value&quot;:true}" await-children><footer class="border-t border-zinc-200 dark:border-zinc-700 mt-12 pt-8 pb-12"><div class="flex items-center justify-center space-x-6 text-sm text-zinc-600 dark:text-zinc-400"><a href="https://github.com/gaubee/gaubee.com" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-2 transition-colors hover:text-zinc-900 dark:hover:text-zinc-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span>Source Code</span></a><a href="https://beian.miit.gov.cn/#/Integrated/recordQuery" target="_blank" rel="noopener noreferrer" class="transition-colors hover:text-zinc-900 dark:hover:text-zinc-100">é—½ICPå¤‡17026139å·-1</a></div></footer><!--astro:end--></astro-island> <astro-island uid="Tziuc" prefix="r13" component-url="/_astro/BackToTop.CO3miaR6.js" component-export="default" renderer-url="/_astro/client.D0HLj-jK.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;BackToTop&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Back to top" class="fixed right-8 bottom-8 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-zinc-900/20 text-white shadow-lg backdrop-blur-sm backdrop-saturate-200 transition-opacity duration-300 hover:bg-zinc-700 dark:bg-zinc-100/20 dark:text-zinc-900 dark:hover:bg-zinc-300 opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up" aria-hidden="true"><path d="m5 12 7-7 7 7"></path><path d="M12 19V5"></path></svg></button><!--astro:end--></astro-island>  </body></html> 