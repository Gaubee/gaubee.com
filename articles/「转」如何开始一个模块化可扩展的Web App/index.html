<!doctype html><html lang=zh-CN><meta charset=utf-8><title>「转」如何开始一个模块化可扩展的Web App · Gaubee</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/css/main.css rel=stylesheet><link href=/webmanifest.json rel=manifest><meta content=#ec407a name=theme-color><link href=/articles.atom rel=alternate title="Gaubee's Articles Atom feed" type=application/atom+xml><link href=/events.atom rel=alternate title="Gaubee's Events Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><header id=header><h1><a href=/ >Gaubee</a></h1><a href=#navigation-toggle id=nav-toggle>显示导航 Show navigation</a><nav><ul><li><a href=/ >主页 Home</a><li class=current><a href=/articles>文章 Articles</a><li><a href=/events>小事件 Events</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>「转」如何开始一个模块化可扩展的Web App</h1><p class=meta>发布于 <time datetime=7/2/2013 itemprop=datePublished>7/2/2013</time> · 最后修改时间 <time datetime=7/2/2013 itemprop=dateModified>7/2/2013</time> · 标签： <a href=/blog/tags/javascript class=tag>javascript</a> <a href=/blog/tags/cogitation class=tag>cogitation</a> <a href=/blog/tags/efficiency class=tag>efficiency</a></header><div itemprop=articleBody><p>原文地址：<a href=http://avnpc.com/pages/start-a-modular-extensible-webapp>http://avnpc.com/pages/start-a-modular-extensible-webapp</a><br>作者：<a href=https://plus.google.com/104171418568283484752/posts>Allo Vince</a><p>虽然从没有认为自己是一个前端开发者，但不知不觉中也积累下了一些前端开发的经验。正巧之前碰到一道面试题，于是就顺便梳理了一下自己关于Web App的一些思路并整理为本文。<p>对于很多简单的网站或Web应用来说，引入jQuery以及一些插件，在当前页面内写入简单逻辑已经可以满足大部分需要。但是如果一旦多人开发，应用的复杂程度上升，就会有很多问题开始暴露出来：<ul><li>数据源一般都与页面分离，那么App启动一般都需要等待数据源读入。<li>UI交互复杂时，需要将逻辑通过面向对象抽象后才能更好的复用。<li>功能间一般都存在依赖关系，需要引入支持依赖关系的模块加载器。</ul><p>那么如何解决这些问题，就以一个简单的订餐App为例，从零开始一个<a href=http://avnpc.com/pages/start-a-modular-extensible-webapp>模块化可扩展Web App</a>。<p>这个简单的App基于HTML5 Boilerplate、requireJS、jQuery Mobile、Underscore.js，后端逻辑用<a href=http://www.jstorage.info/ >jStorage</a>模拟实现。完成后的<a href=http://allovince.github.com/webapp-startup/ >成品</a>在此。所有代码可以<a href=https://github.com/AlloVince/webapp-startup>在github查看</a>。下文将逐一介绍实现的思路与方法。<h2 id=%E4%BB%8E%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E5%A5%BD%E6%A8%A1%E6%9D%BF%E5%BC%80%E5%A7%8B tabindex=-1><a href=#%E4%BB%8E%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E5%A5%BD%E6%A8%A1%E6%9D%BF%E5%BC%80%E5%A7%8B class=header-anchor>从选择一个好模板开始</a></h2><p>开始一个Web项目，HTML的书写总是重中之重，一个好的HTML能从根源上规避大量潜在问题，所以Web App应该全部应用一个标准化的高质量HTML模板，而不是将所有页面交由开发人员自由发挥。<p>这里推荐使用<a href=http://html5boilerplate.com/ >HTML5 Boilerplate项目</a>作为App的默认模板以及文件路径规范，无论是网站或者富UI的App，都可以采用这个模板作为起步。<p>可以使用<pre><code>git clone git://github.com/h5bp/html5-boilerplate.git
</code></pre><p>或者直接下载<a href=https://github.com/h5bp/html5-boilerplate>HTML5 Boilerplate项目代码</a>。HTML5 Boilerplate的文件结构如下，<pre><code>.
├── css
│   ├── main.css
│   └── normalize.css
├── doc
├── img
├── js
│   ├── main.js
│   ├── plugins.js
│   └── vendor
│       ├── jquery.min.js
│       └── modernizr.min.js
├── .htaccess
├── 404.html
├── index.html
├── humans.txt
├── robots.txt
├── crossdomain.xml
├── favicon.ico
└── [apple-touch-icons]
</code></pre><p>从上向下看<ul><li><code>css</code> 用于存放css文件，并内置了<a href=https://github.com/necolas/normalize.css>Normalize.css</a>作为默认CSS重置手段（其实Normalize.css不能算是CSS reset）。<li><code>doc</code> 存放项目文档<li><code>img</code> 存放项目图片<li><code>js</code> 存放javascript文件，其中第三方类库推荐放在<code>vendor</code>下<li><code>.htaccess</code> 内置了很多对于静态文件在Apache下的优化策略，如果Web服务器不是Apache则可以参考<a href=https://github.com/h5bp/server-configs>其他Web服务器配置优化</a>。<li><code>404.html</code> 默认的404页面，<li><code>index.html</code> 项目模板<li><code>humans.txt</code> 相对于面向机器人的<code>robots.txt</code>，humans.txt更像是小幽默，这在里可以写关于项目/团队的介绍，或者放置一些彩蛋给那些喜欢对你的应用刨根问底的用户们。<li><code>robots.txt</code> 用于告诉搜索引擎蜘蛛爬行规则<li><code>crossdomain.xml</code> 用于配置<a href=http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html>Flash的跨域策略</a><li><code>favicon.ico</code> <code>apple-touch-icon.png</code>等小图标。</ul><p>如果是一个主要面向移动设备，还有更具针对性的<a href=http://html5boilerplate.com/mobile/ >Mobile Boilerplate</a>可供参考。<h2 id=%E5%88%B6%E5%AE%9A%E7%BB%9F%E4%B8%80%E7%9A%84%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83 tabindex=-1><a href=#%E5%88%B6%E5%AE%9A%E7%BB%9F%E4%B8%80%E7%9A%84%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83 class=header-anchor>制定统一的编码规范</a></h2><p>在正式开始编码之前，无论是多大规模的应用，多少人的团队，一定要有一个统一的规范，才能保证后续的开发不会乱套。<p>前端规范其实又要分为三部分：HTML、CSS、Javascript应该分别有自己的规范。HTML/CSS主要约定id/class的命名规则、属性的书写顺序。JavaScript可能需要细化到缩进、编码风格、面向对象写法等等。<p>最省事的方法当然还是参考已有的规范，比如<a href=http://google-styleguide.googlecode.com/svn/trunk/htmlcssguide.xml>Google的HTML/CSS风格指南</a>、<a href=http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml>Google的Javascript编码指南</a>等等。<h2 id=html%E7%AF%87 tabindex=-1><a href=#html%E7%AF%87 class=header-anchor>HTML篇</a></h2><p>HTML5 Boilerplate的模板核心部分不过30行，但是每一行都可谓千锤百炼，可以用最小的消耗解决一些前端的顽固问题：<h3 id=%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6%E6%B3%A8%E9%87%8A%E5%8C%BA%E5%88%86ie%E6%B5%8F%E8%A7%88%E5%99%A8 tabindex=-1><a href=#%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6%E6%B3%A8%E9%87%8A%E5%8C%BA%E5%88%86ie%E6%B5%8F%E8%A7%88%E5%99%A8 class=header-anchor>使用条件注释区分IE浏览器</a></h3><pre class=language-html><code class=language-html><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token comment">&lt;!--[if lt IE 7]>      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"> &lt;![endif]--></span><br><span class="token comment">&lt;!--[if IE 7]>         &lt;html class="no-js lt-ie9 lt-ie8"> &lt;![endif]--></span><br><span class="token comment">&lt;!--[if IE 8]>         &lt;html class="no-js lt-ie9"> &lt;![endif]--></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!--[if</span> <span class="token attr-name">gt</span> <span class="token attr-name">IE</span> <span class="token attr-name">8]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!--</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--&lt;![endif]--></span></code></pre><p>之所以要这样写<ul><li>可以使用class作为全局条件区分低版本的IE浏览器并进行调整，这显然要优于使用CSS Hack。<li>可以避免<a href=http://webforscher.wordpress.com/2010/05/20/ie-6-slowing-down-ie-8/ >IE6条件注释引起的高版本IE文件阻塞问题</a>，原文的解决方法是在前面加一个空白的条件注释，但是这里显然将原本无用空白的条件注释变得有意义了。<li>仍然可以通过HTML验证。<li>与Modernizr等特征检测类库使用相同的class，更具备通用性。</ul><p><code>no-js</code>标签是需要与Modernizr等类库配合使用的，如果你不想在项目中引入Modernizr，需要在Head部分加入一行使<code>no-js</code>标签变为<code>js</code>，代码来自<a href=http://paulirish.com/2009/avoiding-the-fouc-v3/ >Avoiding the FOUC</a>：<pre class=language-html><code class=language-html> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">H</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token constant">H</span><span class="token punctuation">.</span>className<span class="token operator">=</span><span class="token constant">H</span><span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">\bno-js\b</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token string">'js'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>通过上面的条件注释，就可以在CSS中针对不同情况分别处理<pre><code>.lt-ie7 {} /* IE6等版本时 */
.no-js {} /* JavaScript没有启用时 */
</code></pre><h3 id=meta%E6%A0%87%E7%AD%BE%E7%9A%84%E4%B9%A6%E5%86%99%E9%A1%BA%E5%BA%8F tabindex=-1><a href=#meta%E6%A0%87%E7%AD%BE%E7%9A%84%E4%B9%A6%E5%86%99%E9%A1%BA%E5%BA%8F class=header-anchor>meta标签的书写顺序</a></h3><p>为了让浏览器识别正确的编码，meta charset标签应该先于title标签出现。<p>meta X-UA-Compatible标签可以指定IE8以上版本浏览器以最高级模式渲染文档，同时如果已经安装<a href="http://www.google.com/chromeframe?quickenable=true">Google Chrome Frame</a>则直接使用Chrome Frame渲染。而指定渲染模式的<a href=http://msdn.microsoft.com/en-us/library/cc288325%28VS.85%29.aspx>meta X-UA-Compatible标签同样需要优先出现</a><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge,chrome=1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></code></pre><h3 id=%E8%AE%BE%E7%BD%AE%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E6%98%BE%E7%A4%BA%E7%AA%97%E5%8F%A3%E5%AE%BD%E5%BA%A6 tabindex=-1><a href=#%E8%AE%BE%E7%BD%AE%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E6%98%BE%E7%A4%BA%E7%AA%97%E5%8F%A3%E5%AE%BD%E5%BA%A6 class=header-anchor>设置移动设备显示窗口宽度</a></h3><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>这是移动设备专属的标签，具体设置需要根据项目实际情况调整。<h3 id=%E4%BD%BF%E7%94%A8modernizr%E5%81%9A%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%AE%E5%BC%82%E6%A3%80%E6%B5%8B tabindex=-1><a href=#%E4%BD%BF%E7%94%A8modernizr%E5%81%9A%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%AE%E5%BC%82%E6%A3%80%E6%B5%8B class=header-anchor>使用Modernizr做浏览器差异检测</a></h3><p><a href=http://modernizr.com/ >Modernizr</a>常做前端的应该都不陌生。引入Modernizr后，html标签的<code>no-js</code>将会被自动替换为<code>js</code>，同时Modernizr会向html标签添加代表版本检测结果的class。<p>对于低版本浏览器的向上兼容需要根据项目实际需求处理，Modernizr也非常周到的给出的<a href=https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills>绝大多数HTML5功能的兼容方法</a>。<h2 id=css%E7%AF%87 tabindex=-1><a href=#css%E7%AF%87 class=header-anchor>CSS篇</a></h2><h3 id=css%E9%87%8D%E7%BD%AE%E5%8F%8A%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD tabindex=-1><a href=#css%E9%87%8D%E7%BD%AE%E5%8F%8A%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD class=header-anchor>CSS重置及增强功能</a></h3><p>HTML5 Boilerplate选择<a href=https://github.com/necolas/normalize.css>Normalize.css</a>重置CSS。如果项目计划引入Twitter Bootstrap、YUI 3这些前端框架的话则可以移除，因为这些框架已经内置了Normalize.css。<p>同时HTML5 Boilerplate又引入了一个main.css，内置了一些基本的排版样式以及打印样式。<h3 id=%E4%BD%BF%E7%94%A8less%E6%88%96sass%E7%94%9F%E6%88%90css tabindex=-1><a href=#%E4%BD%BF%E7%94%A8less%E6%88%96sass%E7%94%9F%E6%88%90css class=header-anchor>使用LESS或Sass生成CSS</a></h3><p>在复杂应用中，如果还手写CSS的话将是一件痛苦的事情，大量的class前缀，复用样式需要来回copy等等。为了更好的扩展性，这里建议在项目中引入<a href=http://lesscss.org/ >LESS</a>或<a href=http://sass-lang.com/ >Sass</a>。这代表着：<ul><li>支持变量与简单运算<li>支持CSS片段复用<li>class/id样式嵌套</ul><p>等一些更像是编程语言的特性。这对于提高开发效率是效果非常明显的。<p>以LESS为例，简单介绍一下LESS在Windows下如何应用到这个项目中：<ul><li>下载<a href=http://nodejs.org/ >Nodejs</a>并安装，nodejs会自动将自己加入系统路径。<li>在cmd运行</ul><pre><code>npm install -g less
</code></pre><ul><li>然后就可以通过lessc指令将less源文件编译为css</ul><pre><code>lessc avnpc.less avnpc.css
</code></pre><ul><li>如果不使用nodeJs作为后端，最好在写LESS时采用watch模式，每次保存自动编译为css。这里需要安装一个辅助模块recess：</ul><pre><code>npm install -g recess
</code></pre><p>然后运行watch<pre><code>recess avnpc.less:avnpc.css --watch
</code></pre><h2 id=javascript%E7%AF%87 tabindex=-1><a href=#javascript%E7%AF%87 class=header-anchor>Javascript篇</a></h2><h3 id=%E4%BD%BF%E7%94%A8requirejs%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD tabindex=-1><a href=#%E4%BD%BF%E7%94%A8requirejs%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD class=header-anchor>使用requireJS按需加载</a></h3><p>模块加载器的概念可能稍微接触过前端开发的童鞋都不会陌生，通过模块加载器可以有效的解决这些问题：<ul><li>JS文件的依赖关系。<li>通过异步加载优化script标签引起的阻塞问题<li>可以简单的以文件为单位将功能模块化并实现复用</ul><p>主流的JS模块加载器有<a href=http://requirejs.org/ >requireJS</a>，<a href=http://seajs.org/docs/ >SeaJS</a>等，加载器之间可能会因为遵循的规范不同有微妙的差别，从纯用户的角度出发，之所以选requireJS而不是SeaJS主要是因为：<ul><li>功能实现上两者相差无几，没有明显的性能差异或重大问题。<li>文档丰富程度上，requireJS远远好于SeaJS，就拿最简单的加载jQuery和jQuery插件这回事，虽然两者的实现方法相差无几，但requireJS就有可以直接拿来用的Demo，SeaJS还要读文档自己慢慢折腾。一些问题的解决上，requireJS为关键词也更容易找到答案。</ul><h4 id=requirejs-%E5%8A%A0%E8%BD%BDjquery-%2B-jquery%E6%8F%92%E4%BB%B6 tabindex=-1><a href=#requirejs-%E5%8A%A0%E8%BD%BDjquery-%2B-jquery%E6%8F%92%E4%BB%B6 class=header-anchor>requireJS 加载jQuery + jQuery插件</a></h4><p>可能对于一般Web App来说，引入jQuery及相关插件的概率是最大的，requireJS也亲切的给出了相应的解决方案及<a href=http://requirejs.org/docs/jquery.html>动态加载jQuery及插件</a>的文档及<a href=http://requirejs.org/docs/download.html#samplejquery>实例代码</a>。<p>在最新的jQuery1.9.X中，jQuery已经在最后直接将自己注册为一个<a href=https://github.com/amdjs/amdjs-api/wiki/AMD>AMD模块</a>，即是说可以直接被requireJS作为模块加载。如果是加载旧版的jQuery有两种方法：<p><strong>1. 让jQuery先于requireJS加载</strong><p><strong>2. 对jQuery代码稍做一点处理，在jQuery代码包裹一句：</strong><pre class=language-js><code class=language-js><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// $ is guaranteed to be jQuery now */</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>requireJS的示例中，直接将requireJS与jQuery合并为一个文件，如果是采用jQuery作为核心库的话推荐这种做法。<p>同样对于jQuery插件来说也有两种方法<p><strong>1. 在插件外包裹代码</strong><pre class=language-js><code class=language-js><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>     <span class="token comment">// Put here the plugin code. </span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>2. 在使用reuqireJS代码加载前注册插件（比如在main.js）中</strong><pre class=language-js><code class=language-js>requirejs<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token property string-property">"shim"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property string-property">"jquery-cookie"</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id=requirejs%E5%8A%A0%E8%BD%BD%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B1%BB%E5%BA%93 tabindex=-1><a href=#requirejs%E5%8A%A0%E8%BD%BD%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B1%BB%E5%BA%93 class=header-anchor>requireJS加载第三方类库</a></h4><p>在实例的App中还用到了jQuery以外的第三方类库，如果类库不是一个标准的AMD模块而又不想更改这些类库的代码，同样需要提前进行定义：<pre class=language-js><code class=language-js>require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      <span class="token property literal-property">paths</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token property string-property">'underscore'</span><span class="token operator">:</span> <span class="token string">'vendor/underscore'</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token property literal-property">shim</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>          <span class="token property literal-property">underscore</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>              <span class="token property literal-property">exports</span><span class="token operator">:</span> <span class="token string">'_'</span><br>          <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id=css%E6%96%87%E4%BB%B6%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%A4%84%E7%90%86 tabindex=-1><a href=#css%E6%96%87%E4%BB%B6%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%A4%84%E7%90%86 class=header-anchor>CSS文件的模块化处理</a></h4><p>在requireJS中，模块的概念仅限于JS文件，如果需要加载图片、JSON等非JS文件，requireJS实现了一系列<a href=http://requirejs.org/docs/plugins.html>加载插件</a>。<p>但是遗憾的是requireJS官方没有对CSS进行模块化处理，而我们在实际项目中却往往能遇到一些场景，比如一个轮播的图片展示栏，比如高级编辑器等等。几乎所有的富UI组件都会由JS与CSS两部分构成，而CSS之间也存在着模块的概念以及依赖关系。<p>为了更好的与requireJS整合，这里采用<a href=https://github.com/guybedford/require-css>require-css</a>来解决CSS的模块化与依赖问题。<p>require-css是一个requireJS插件，下载后将<code>css.js</code>与<code>normalize.js</code>放于main.js同级即可默认被加载，比如在我们的项目中需要加载jQuery Mobile的css文件，那么可以直接这样调用：<pre class=language-js><code class=language-js><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'css!../css/jquery.mobile-1.3.0.min.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>不过由于这个CSS本质上是属于jQuery Mobile模块的一部分，更好的做法是将这个CSS文件的定义放在jQuery Mobile的依赖关系中，最终我们的requireJS定义部分为：<pre class=language-js><code class=language-js>require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      <span class="token property literal-property">paths</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token property string-property">'jquerymobile'</span><span class="token operator">:</span> <span class="token string">'vendor/jquery.mobile-1.3.0'</span><span class="token punctuation">,</span><br>            <span class="token property string-property">'jstorage'</span> <span class="token operator">:</span> <span class="token string">'vendor/jstorage'</span><span class="token punctuation">,</span><br>            <span class="token property string-property">'underscore'</span><span class="token operator">:</span> <span class="token string">'vendor/underscore'</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token property literal-property">shim</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>          <span class="token property literal-property">jquerymobile</span> <span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token property literal-property">deps</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">'css!../css/jquery.mobile-1.3.0.min.css'</span><br>            <span class="token punctuation">]</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>          <span class="token property literal-property">underscore</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>              <span class="token property literal-property">exports</span><span class="token operator">:</span> <span class="token string">'_'</span><br>          <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在使用模块时，只需要：<pre class=language-js><code class=language-js><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'underscore'</span><span class="token punctuation">,</span> <span class="token string">'jquerymobile'</span><span class="token punctuation">,</span> <span class="token string">'jstorage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$<span class="token punctuation">,</span> _</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>jQuery Mobile的CSS文件就会被自动加载，这样CSS与JS就被整合为一个模块了。同理其他有复杂依赖关系的模块也可以做类似处理，requireJS会解决依赖关系的逻辑。<h3 id=%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%B8%8E%E7%AD%89%E5%BE%85 tabindex=-1><a href=#%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%B8%8E%E7%AD%89%E5%BE%85 class=header-anchor>数据源的加载与等待</a></h3><p>Web App一般都会动态加载后端的数据，数据格式一般可以是JSON、JSONP也可以直接是一个JS变量。这里以JS变量为例<pre class=language-js><code class=language-js><span class="token keyword">var</span> restaurants <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>        <span class="token property string-property">"name"</span><span class="token operator">:</span> <span class="token string">"KFC"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>        <span class="token property string-property">"name"</span><span class="token operator">:</span> <span class="token string">"7-11"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>        <span class="token property string-property">"name"</span><span class="token operator">:</span> <span class="token string">"成都小吃"</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>载入这段数据:<pre class=language-js><code class=language-js>$<span class="token punctuation">.</span><span class="token function">getScript</span><span class="token punctuation">(</span><span class="token string">'data/restaurants.json'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>    <span class="token keyword">var</span> data <span class="token operator">=</span> window<span class="token punctuation">.</span>restaurants<span class="token punctuation">;</span><br>    <span class="token function">alert</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//KFC</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>单一的数据源确实很简单，但是往往一个应用中会有多个数据源，比如在这个实例App中UI就需要载入用户信息、餐厅信息、订餐信息三种数据后才能工作。如果仅仅靠多层嵌套回调函数的话，可能代码的耦合就非常重了。<p>为了解决多个数据加载的问题，我习惯的解决方法是构造一个dataReady事件响应机制。<pre class=language-js><code class=language-js><span class="token keyword">var</span> foodOrder <span class="token operator">=</span> <span class="token punctuation">{</span><br><br>    <span class="token comment">//数据载入后要执行的函数暂存在这里</span><br>    <span class="token property literal-property">dataReadyFunc</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><br>    <span class="token comment">//数据源URL及载入状态</span><br>    <span class="token punctuation">,</span> <span class="token property literal-property">dataSource</span> <span class="token operator">:</span> <span class="token punctuation">[</span><br>        <span class="token punctuation">{</span> <span class="token property literal-property">url</span> <span class="token operator">:</span> <span class="token string">'data/restaurants.json'</span><span class="token punctuation">,</span> <span class="token property literal-property">ready</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token property literal-property">data</span> <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">{</span> <span class="token property literal-property">url</span> <span class="token operator">:</span> <span class="token string">'data/users.json'</span><span class="token punctuation">,</span> <span class="token property literal-property">ready</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token property literal-property">data</span> <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">{</span> <span class="token property literal-property">url</span> <span class="token operator">:</span> <span class="token string">'data/foods.json'</span><span class="token punctuation">,</span> <span class="token property literal-property">ready</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token property literal-property">data</span> <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br><br>    <span class="token comment">//检查数据源是否全部载入完毕</span><br>    <span class="token punctuation">,</span> <span class="token function function-variable">isReady</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token keyword">var</span> isReady <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span><br>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>ready <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>                isReady <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> isReady<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">//数据源全部加载完毕，则逐一运行dataReadyFunc中存放的函数</span><br>    <span class="token punctuation">,</span> <span class="token function function-variable">callReady</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataReadyFunc<span class="token punctuation">)</span><span class="token punctuation">{</span><br>                <span class="token keyword">this</span><span class="token punctuation">.</span>dataReadyFunc<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">//供外部调用，会将外部输入的函数暂存在dataReadyFunc中</span><br>    <span class="token punctuation">,</span> <span class="token function function-variable">dataReady</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> func <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <br>        <span class="token keyword">this</span><span class="token punctuation">.</span>dataReadyFunc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token punctuation">,</span> <span class="token function function-variable">init</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>        <span class="token keyword">var</span> <span class="token function function-variable">_initElement</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>            $<span class="token punctuation">.</span><span class="token function">getScript</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>                <span class="token comment">//每次载入数据后，将数据存放于dataSource中，将ready状态置为true，并调用callReady</span><br>                self<span class="token punctuation">.</span>dataSource<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>data <span class="token operator">=</span> window<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span><br>                self<span class="token punctuation">.</span>dataSource<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>                self<span class="token punctuation">.</span><span class="token function">callReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span><br>            <span class="token function">_initElement</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>用法为<pre class=language-js><code class=language-js>foodOrder<span class="token punctuation">.</span><span class="token function">dataReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>foodOrder<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>dataReady内的alert将会在所有数据载入完毕后开始执行。<p>这段处理的逻辑并不复杂，将所有要执行的方法通过dataReady暂存起来，等待数据全部加载完毕后再执行，更加复杂的场景此方法仍然通用。<h3 id=%E4%BD%BF%E7%94%A8js%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E tabindex=-1><a href=#%E4%BD%BF%E7%94%A8js%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E class=header-anchor>使用JS模板引擎</a></h3><p>数据载入后，最终都会以某种形式显示在页面上。简单情况，我们可能会这样做：<pre class=language-js><code class=language-js><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'&lt;div>'</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'&lt;/div>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果页面逻辑一旦复杂，比如需要有if判断或者多层循环时，这种连接字符串的方式就相形见绌了，而这也就催生出了JS模板引擎。<p>主流的JS模板引擎有<a href=http://documentcloud.github.com/underscore/ >underscore.js</a>，<a href=http://jade-lang.com/ >Jade</a>，<a href=http://embeddedjs.com/ >EJS</a>等等，可以<a href=http://engineering.linkedin.com/frontend/client-side-templating-throwdown-mustache-handlebars-dustjs-and-more>横向对比一下这些JS模板引擎的优缺点</a>。<p>对于相对简单的页面逻辑（只需要支持if和for/each）来说，我更倾向选用轻巧的underscore.js或者<a href=https://github.com/blueimp/JavaScript-Templates>JavaScript Templates</a>。<p>在当前例子中，使用underscore.js生成列表就非常简单了，页面模板为：<pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">data-role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>listview<span class="token punctuation">"</span></span> <span class="token attr-name">data-inset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tmpl-restaurants<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>    <span class="token operator">&lt;</span><span class="token operator">%</span> _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">restaurant</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span><br>        <span class="token operator">&lt;</span>li<span class="token operator">></span><br>            <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"#"</span> data<span class="token operator">-</span>rel<span class="token operator">=</span><span class="token string">"back"</span> data<span class="token operator">-</span>value<span class="token operator">=</span><span class="token string">"&lt;%- restaurant.name%>"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> restaurant<span class="token punctuation">.</span>name<span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre><p>调用引擎<pre class=language-js><code class=language-js><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#tmpl-restaurants"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span><br>    _<span class="token punctuation">.</span><span class="token function">template</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#tmpl-restaurants"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>        <span class="token property literal-property">data</span> <span class="token operator">:</span> restaurants<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id=%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%8C%96 tabindex=-1><a href=#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%8C%96 class=header-anchor>面向对象与模块化</a></h3><p>通过上面这些工具的组合，我们有了模块的概念，有了模板引擎，有数据的加载。最终还是要通过javascript将这一切组织在一起并加入应用所需要的逻辑。为了能最大限度的复用代码，用面向对象的方式去组织内容是比较好的选择。<p>JavaScript虽然原生并不支持面向对象，但是依然可以通过很多方式模拟出面向对象的特性。例子中采用了我个人比较喜欢的一种方式是：<pre class=language-js><code class=language-js><span class="token keyword">var</span> <span class="token function function-variable">foodOrder</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ui<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>    <span class="token comment">//构造函数</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>ui<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br>foodOrder<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span><br>   <span class="token property literal-property">defaultUI</span> <span class="token operator">:</span>  <span class="token punctuation">{</span><br>       <span class="token property literal-property">form</span> <span class="token operator">:</span> <span class="token string">'#form-order'</span><br>   <span class="token punctuation">}</span><br>   <span class="token punctuation">,</span> <span class="token property literal-property">defaultOptions</span> <span class="token operator">:</span> <span class="token punctuation">{</span><br>       <span class="token property literal-property">debug</span> <span class="token operator">:</span> <span class="token boolean">false</span><br>   <span class="token punctuation">}</span><br>   <span class="token punctuation">,</span> <span class="token function function-variable">init</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ui<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>       <span class="token keyword">this</span><span class="token punctuation">.</span>ui <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultUI<span class="token punctuation">,</span> ui<span class="token punctuation">)</span><span class="token punctuation">;</span><br>       <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultOptions<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br>   <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token keyword">var</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foodOrder</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token property literal-property">form</span> <span class="token operator">:</span> <span class="token string">'#real-form'</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    <span class="token property literal-property">debug</span> <span class="token operator">:</span> <span class="token boolean">true</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>将页面的UI元素以及配置项目抽象出来，在实际构造对象时则可以通过入口参数复写，可以分离整个项目的逻辑与UI，使处理的方式更加灵活。<hr><p><strong>2013-07-02 19:08:09</strong></div><footer></footer></article></main><footer id=footer><div><nav><a href=https://twitter.com/gaubeebangeel rel="me nofollow" target=_blank>Twitter</a> · <a href="https://github.com/gaubee/gaubee.com/tree/main/./src/articles/「转」如何开始一个模块化可扩展的Web App.md" rel=nofollow target=_blank>Edit this page on GitHub</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>除非有特别的说明, 该站点所有直接内容都使用许可证：<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>署名 4.0 国际 (CC BY 4.0)</a></small><blockquote><small>本网站不收集任何访问者的行为与信息，不做任何商业运作，仅仅为个人使用</small></blockquote></footer><script src=/js/dark-mode-toggle.mjs type=module></script><script src=/js/time-elements.mjs type=module></script><script src=/js/main.mjs type=module></script>