<!doctype html><html lang=zh-CN><meta charset=utf-8><title>QT使用代理在线安装的方法 · Gaubee</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/css/main.css rel=stylesheet><link href=/webmanifest.json rel=manifest><meta content=#ec407a name=theme-color><link href=/articles.atom rel=alternate title="Gaubee's Articles Atom feed" type=application/atom+xml><link href=/events.atom rel=alternate title="Gaubee's Events Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><header id=header><h1><a href=/ >Gaubee</a></h1><a href=#navigation-toggle id=nav-toggle>显示导航 Show navigation</a><nav><ul><li><a href=/ >主页 Home</a><li class=current><a href=/articles>文章 Articles</a><li><a href=/events>小事件 Events</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>QT使用代理在线安装的方法</h1><p class=meta>发布于 <time datetime=3/22/2016 itemprop=datePublished>3/22/2016</time> · 最后修改时间 <time datetime=3/26/2016 itemprop=dateModified>3/26/2016</time></header><div itemprop=articleBody><p>QT 离线安装包对于把 Android 编译和 MSVC 编译混在一起搞，非常麻烦。而官方给的 MaintenanceTool.exe 有问题，没法用来增加额外的安装包，所以就必须使用在线安装。<p>而关于<a href=http://download.qt.io/online/qtsdkrepository/windows_x86/root/qt/Updates_orig.xml.mirrorlist>在线安装</a>。官方给出的一个完整的包地址，里头的 URL 竟然是绝对路径而且还带 SHA1 校验了。<figure><img alt="" height=663 loading=lazy src=/img/qt-download-proxy/capture-1.png width=793></figure><p>所以如果你用第三方镜像，会导致解析下载下来的 XML 文件后最后还是由于绝对路径跑到官方的站点下下载，而如果你自己篡改 XML 文件转发到镜像站点，就会发现各种莫名奇妙的问题，什么插件、依赖找不到之类的。<h2 id=%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%9A tabindex=-1><a href=#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%9A class=header-anchor>解决办法：</a></h2><p><strong>1.</strong> 修改系统 host 文件：<pre><code>127.0.0.1 download.qt.io
</code></pre><p><code>download.qt.io</code>这个域名不能在 XML 文件改变，那就把这个域名的控制器拿到手<p><strong>2.</strong> 然后使用 nginx，加入配置：<pre><code>
    server{
        listen      80;
        server_name download.qt.io;
        location / {
            proxy_pass http://mirror.bit.edu.cn/qtproject/;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Cookie $http_cookie;
            proxy_set_header Host $host;
            proxy_set_header Referer $http_referer;
            proxy_set_header X-Remote-IP $remote_addr;
        }
    }
</code></pre><p>转发<code>download.qt.io</code>到所需的镜像站点。<p><strong>3.</strong> 打开 QT 在线安装程序，自定义库地址：<code>http://download.qt.io/online/qtsdkrepository/windows_x86/root/qt/</code><br>官方的默认的是<code>https</code>协议，所以用<code>http</code>还是不同的，程序接受。<p><strong>补充</strong>：在<strong>检索阶段</strong>，把 host 文件的 download.qt.io 给注释掉，否则可能会检索不通过，等检索通过后，开始进入下载页面了，再把 host 文件的 download.qt.io 的转发给开启起来。如果已经开始在下载了，那么那几个文件的数据包会因为走 qt 官方的镜像而速度很慢，不要慌，把网络关掉，qt 下载器会报错说连接断开，这时候再把网络连接上去，点击下载器的 retry 按钮，这时候重新解析 dns，就会开始走国内镜像的渠道了。</div><footer></footer></article></main><footer id=footer><div><nav><a href=https://twitter.com/gaubeebangeel rel="me nofollow" target=_blank>Twitter</a> · <a href=https://github.com/gaubee/gaubee.com/tree/main/./src/articles/QT使用代理在线安装的方法.md rel=nofollow target=_blank>Edit this page on GitHub</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>除非有特别的说明, 该站点所有直接内容都使用许可证：<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>署名 4.0 国际 (CC BY 4.0)</a></small><blockquote><small>本网站不收集任何访问者的行为与信息，不做任何商业运作，仅仅为个人使用</small></blockquote></footer><script src=/js/dark-mode-toggle.mjs type=module></script><script src=/js/time-elements.mjs type=module></script><script src=/js/main.mjs type=module></script>