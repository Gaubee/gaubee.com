<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/icon-192x192.png"><meta name="generator" content="Astro v5.13.9"><title>View Transitions API (Level-1 single-document)</title><meta name="description" content="Gaubee's personal blog"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.B3vRBseb.js"></script><link rel="stylesheet" href="/_astro/editor.B3s7wtHl.css"></head> <body class="bg-white text-zinc-900 transition-colors duration-300 dark:bg-zinc-900 dark:text-zinc-50">  <div class="flex max-w-7xl mx-auto"> <aside class="hidden lg:block sticky top-0 h-screen w-64 flex-shrink-0 py-8 pr-8"> <aside class="w-64 p-4 pr-8"><nav class="flex flex-col space-y-2"><a href="/" class="flex items-center gap-4 py-3 px-6 text-lg font-semibold no-underline text-zinc-900 dark:text-zinc-100 rounded-full transition-colors duration-200 ease-in-out hover:bg-gray-200 dark:hover:bg-zinc-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house" aria-hidden="true"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg><span>主页</span></a><a href="/events" class="flex items-center gap-4 py-3 px-6 text-lg font-semibold no-underline text-zinc-900 dark:text-zinc-100 rounded-full transition-colors duration-200 ease-in-out hover:bg-gray-200 dark:hover:bg-zinc-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss" aria-hidden="true"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg><span>时事快讯</span></a></nav></aside> </aside> <main class="flex-1 min-w-0"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="r8Xtf" prefix="r15" component-url="/_astro/MobileNav.GHWk5zau.js" component-export="default" renderer-url="/_astro/client.DcVwxw19.js" props="{&quot;title&quot;:[0,&quot;View Transitions API (Level-1 single-document)&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;MobileNav&quot;,&quot;value&quot;:true}" await-children><div id="mobile-topbar" class="sticky top-0 z-50 flex h-14 items-center justify-between border-b border-zinc-200 bg-white/80 px-4 backdrop-blur-sm dark:border-zinc-800 dark:bg-zinc-900/80 lg:hidden"><div class="w-6"></div><div class="absolute left-1/2 -translate-x-1/2 text-sm font-semibold text-zinc-700 dark:text-zinc-300">View Transitions API (Level-1 single-document)</div><button type="button" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu" aria-hidden="true"><path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path></svg></button></div><template data-astro-template> <div class="space-y-4"> <astro-island uid="20L6nH" prefix="r8" component-url="/_astro/TableOfContentsCard.DZ19Aq2Y.js" component-export="default" renderer-url="/_astro/client.DcVwxw19.js" props="{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;一告别刀耕火种view-transitions-要解决啥蛋疼问题&quot;],&quot;text&quot;:[0,&quot;一、告别刀耕火种：View Transitions 要解决啥蛋疼问题？&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;二view-transitions-的核心思想与哲学解耦分离&quot;],&quot;text&quot;:[0,&quot;二、View Transitions 的核心思想与哲学：解耦！分离！&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;三上手初体验documentstartviewtransition-登场&quot;],&quot;text&quot;:[0,&quot;三、上手初体验：document.startViewTransition 登场！&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;四深入幕后揭秘伪元素树&quot;],&quot;text&quot;:[0,&quot;四、深入幕后：揭秘伪元素树&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;五定制你的专属转场css-大显身手&quot;],&quot;text&quot;:[0,&quot;五、定制你的专属转场：CSS 大显身手&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;六更骚的操作javascript-动画-web-animations-api&quot;],&quot;text&quot;:[0,&quot;六、更骚的操作：JavaScript 动画 (Web Animations API)&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;七注意事项与最佳实践&quot;],&quot;text&quot;:[0,&quot;七、注意事项与最佳实践&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;八总结&quot;],&quot;text&quot;:[0,&quot;八、总结&quot;]}]]]}" ssr client="load" opts="{&quot;name&quot;:&quot;TableOfContentsCard&quot;,&quot;value&quot;:true}" await-children><div class="rounded-xl border bg-card text-card-foreground shadow"><div class="p-6 pt-0"><ul><li><a href="#一告别刀耕火种view-transitions-要解决啥蛋疼问题">一、告别刀耕火种：View Transitions 要解决啥蛋疼问题？</a></li><li><a href="#二view-transitions-的核心思想与哲学解耦分离">二、View Transitions 的核心思想与哲学：解耦！分离！</a></li><li><a href="#三上手初体验documentstartviewtransition-登场">三、上手初体验：document.startViewTransition 登场！</a></li><li><a href="#四深入幕后揭秘伪元素树">四、深入幕后：揭秘伪元素树</a></li><li><a href="#五定制你的专属转场css-大显身手">五、定制你的专属转场：CSS 大显身手</a></li><li><a href="#六更骚的操作javascript-动画-web-animations-api">六、更骚的操作：JavaScript 动画 (Web Animations API)</a></li><li><a href="#七注意事项与最佳实践">七、注意事项与最佳实践</a></li><li><a href="#八总结">八、总结</a></li></ul></div></div><!--astro:end--></astro-island> <!-- <TagsCard client:load tags={allTags} />
          <ArchiveCard client:load postsByMonth={postsByMonth} /> --> </div> </template><!--astro:end--></astro-island> <div class="p-6">  <article class="prose dark:prose-invert max-w-none"> <p>今天咱们来聊一个前端圈儿里越来越火的新玩意儿——CSS View Transitions。这东西就好比给你的网页换场加了个丝滑的电影转场特效，告别过去那种生硬的“啪嗒”一下切换页面的体验。</p>
<p>W3C 的大佬们捣鼓出的这个 <a href="https://www.w3.org/TR/css-view-transitions-1/">CSS View Transitions Module Level 1</a> 规范，目前已经是 CR（Candidate Recommendation）阶段，说明离咱们大规模用上不远了。咱们的目标是彻底搞懂它，从“这啥玩意儿？”到“哦豁，有点意思”再到“爷青回，这动画我自己写！”。</p>
<h2 id="一告别刀耕火种view-transitions-要解决啥蛋疼问题">一、告别刀耕火种：View Transitions 要解决啥蛋疼问题？</h2>
<p>想想以前，尤其是在 SPA（单页应用）里搞页面切换动画，那叫一个折腾：</p>
<ol>
<li><strong>DOM 大乱炖</strong>：为了让新旧两个状态能同时存在并产生动画效果（比如旧的淡出，新的淡入），你可能得手动控制 DOM，让两个页面的内容在某个时间段内都挂在页面上。这 DOM 结构，简直是为了动画效果“牺牲色相”，乱七八糟。</li>
<li><strong>JS 胶水代码</strong>：得写一堆 JavaScript 来协调 DOM 的增删、CSS class 的切换、动画的开始结束监听。逻辑复杂，还容易出 bug。</li>
<li><strong>性能与体验</strong>：DOM 结构复杂了，性能可能受影响；动画过程中，焦点管理、可访问性（ARIA）也容易出问题，用户体验可能打折。比如动画过程中，屏幕阅读器是读旧的还是新的？按钮能点吗？</li>
</ol>
<p><strong>核心痛点</strong>：<strong>视觉过渡效果</strong> 和 <strong>DOM 状态更新</strong> 这两件事，在过去是紧密耦合、互相掣肘的。为了视觉效果，我们不得不扭曲 DOM 结构和更新逻辑。</p>
<h2 id="二view-transitions-的核心思想与哲学解耦分离">二、View Transitions 的核心思想与哲学：解耦！分离！</h2>
<p>W3C 的大佬们说：“不行，这太 low 了！咱们得想个办法把这两件事分开！”</p>
<p>于是，View Transitions 的核心哲学诞生了：</p>
<p><strong>将视觉层面的过渡动画 与 DOM 结构和数据的更新彻底分离。</strong></p>
<p>怎么分离呢？想象一下：</p>
<ol>
<li><strong>DOM 更新？瞬间完成！</strong> 你该怎么更新 DOM 还怎么更新，别管动画的事儿。调用 API 后，你的更新代码（比如 React 的 <code>setState</code>，Vue 的数据修改，或者原生 JS 操作）会立即或异步执行，DOM 状态瞬间变成新的。</li>
<li><strong>视觉过渡？交给浏览器！</strong> 在你更新 DOM 的前后，浏览器会像个摄影师，“咔嚓”给旧状态拍张照，“咔嚓”给新状态拍张照（这里的“照片”是渲染层面的快照，不是真的图片文件）。</li>
<li><strong>幕后动画师</strong>：浏览器拿到这两张“照片”后，在一个特殊的、凌驾于普通内容之上的图层里，基于这两张快照玩起了动画。默认是简单的交叉淡入淡出（cross-fade）。旧“照片”慢慢消失，新“照片”慢慢显现。</li>
<li><strong>动画结束，收工！</strong> 动画播完，这个特殊的图层和里面的“照片”就被清理掉了，用户看到的就是真实的新 DOM 状态。</li>
</ol>
<p><strong>好处显而易见：</strong></p>
<ul>
<li><strong>DOM 干净</strong>：你的 DOM 结构永远反映真实的应用状态，不用为了动画而妥协。</li>
<li><strong>关注点分离</strong>：JS 只管数据和 DOM 更新，CSS/Web Animations API 只管动画表现。清爽！</li>
<li><strong>体验更佳</strong>：因为 DOM 更新是（逻辑上）瞬时的，底层的状态切换更快，可访问性问题也更容易处理。动画只是一个视觉增强层。</li>
<li><strong>渐进增强</strong>：如果浏览器不支持 View Transitions，或者因为某些原因（如用户设置了减弱动态效果）动画无法执行，你的 DOM 更新逻辑依然会照常运行，页面还是能正常切换，只是没动画而已。完美符合渐进增强的理念。</li>
</ul>
<h2 id="三上手初体验documentstartviewtransition-登场">三、上手初体验：<code>document.startViewTransition</code> 登场！</h2>
<p>说了半天理论，上代码！最最核心的入口就是 <code>document</code> 对象上的新方法 <code>startViewTransition()</code>。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// 假设你原来是这么更新内容的</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> updateContent</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">  // ... 一顿操作猛如虎，更新 DOM ...</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"DOM 更新完毕！"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 现在想加上过渡动画？改成这样：</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> navigate</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">  // 判断浏览器是否支持</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">document.startViewTransition) {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"浏览器不支持 View Transitions，直接更新"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    updateContent</span><span style="color:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 调用 startViewTransition ！</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> transition</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">startViewTransition</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 这个回调函数里，放你原来的 DOM 更新逻辑</span></span>
<span class="line"><span style="color:#B392F0">    updateContent</span><span style="color:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#6A737D">    // 这个回调函数可以是同步的，也可以返回一个 Promise</span></span>
<span class="line"><span style="color:#6A737D">    // 如果返回 Promise，浏览器会等 Promise resolve 后再拍“新照片”</span></span>
<span class="line"><span style="color:#6A737D">    // return new Promise(resolve => setTimeout(resolve, 1000));</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // transition 对象后面会讲，它包含一些有用的 Promise</span></span>
<span class="line"><span style="color:#E1E4E8">  transition.finished.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"过渡动画播放完毕！"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 触发导航</span></span>
<span class="line"><span style="color:#B392F0">navigate</span><span style="color:#E1E4E8">({ content: </span><span style="color:#9ECBFF">"新的页面内容"</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<p><strong>发生了什么？</strong></p>
<ol>
<li>调用 <code>startViewTransition()</code>，浏览器：“收到！准备拍旧照片！”</li>
<li>浏览器拍下当前页面的<strong>旧状态快照</strong>。</li>
<li>浏览器执行你传入的那个回调函数 <code>() => updateContent(data)</code>。</li>
<li>你的 <code>updateContent</code> 函数执行，DOM 瞬间变成了新状态。</li>
<li>（如果回调返回 Promise，浏览器会等它 resolve）浏览器：“OK，DOM 更新完了，拍新照片！”</li>
<li>浏览器拍下当前页面的<strong>新状态快照</strong>。</li>
<li>浏览器在幕后创建一个特殊的<strong>伪元素树</strong>（后面细讲），把旧快照和新快照放进去。</li>
<li>浏览器应用默认的 CSS 动画（交叉淡入淡出）到这些伪元素上。</li>
<li>动画开始播放。用户看到旧内容淡出，新内容淡入。</li>
<li>动画结束。</li>
<li>浏览器清理掉伪元素树。</li>
<li><code>transition.finished</code> Promise resolve。</li>
</ol>
<p>就这么简单，一个基础的页面交叉淡入淡出效果就有了！你几乎没改动原来的 DOM 更新逻辑，只是把它包了一层 <code>startViewTransition</code>。</p>
<p><strong><code>ViewTransition</code> 对象：你的动画小助手</strong></p>
<p><code>startViewTransition</code> 返回一个 <code>ViewTransition</code> 对象，它有几个重要的属性（都是 Promise）：</p>
<ul>
<li><code>updateCallbackDone</code>: 当你传入的回调函数执行完毕（如果是 Promise，则 resolve）时，这个 Promise 就 resolve。表示 DOM 更新逻辑本身已经跑完了。</li>
<li><code>ready</code>: 当浏览器准备好新旧快照，并且创建了用于动画的伪元素、即将开始动画时，这个 Promise 就 resolve。如果你想用 JavaScript (Web Animations API) 来控制更复杂的动画，这是最佳时机。</li>
<li><code>finished</code>: 当整个过渡动画播放完毕，并且伪元素被清理后，这个 Promise 就 resolve。表示一切都结束了，用户看到的是最终的新状态。</li>
</ul>
<p>还有一个方法：</p>
<ul>
<li><code>skipTransition()</code>: 调用这个方法可以立即跳过动画，直接显示最终状态。这在某些情况下（比如用户快速连续点击）可能有用。</li>
</ul>
<h2 id="四深入幕后揭秘伪元素树">四、深入幕后：揭秘伪元素树</h2>
<p>前面提到，浏览器在幕后创建了一个“伪元素树”来承载动画。这棵树长啥样？</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>::view-transition                    (根节点，覆盖整个视口)</span></span>
<span class="line"><span>└─ ::view-transition-group(name)     (每个独立过渡元素的“分组”)</span></span>
<span class="line"><span>   └─ ::view-transition-image-pair(name) (新旧快照的“容器对”)</span></span>
<span class="line"><span>      ├─ ::view-transition-old(name)   (旧状态快照的“图片”)</span></span>
<span class="line"><span>      └─ ::view-transition-new(name)   (新状态快照的“图片”)</span></span></code></pre>
<ul>
<li><code>::view-transition</code>: 整个过渡效果的根容器，通常固定定位，覆盖整个快照区域（Snapshot Containing Block，一般是整个视口）。</li>
<li><code>::view-transition-group(name)</code>: 代表一个<strong>独立进行过渡的视觉区域</strong>。默认情况下，整个页面是一个匿名的 <code>root</code> 分组。如果你给某个元素指定了 <code>view-transition-name</code>，那么这个元素就会拥有自己的具名分组。这个 group 负责模拟原始元素的大小和位置，并且默认会在这两个状态之间进行动画。</li>
<li><code>::view-transition-image-pair(name)</code>: 包裹新旧两个快照的容器。它的主要作用是提供一个隔离环境（<code>isolation: isolate</code>），确保新旧快照的混合模式（blend mode）只影响它们俩，不影响外部。</li>
<li><code>::view-transition-old(name)</code>: 承载旧状态快照的伪元素。你可以把它想象成一个 <code>&#x3C;img></code> 标签，内容是旧页面的样子。</li>
<li><code>::view-transition-new(name)</code>: 承载新状态快照的伪元素。同上，内容是新页面的样子。</li>
</ul>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>name</code> 通常是 <code>root</code>（代表整个页面），或者是你通过 CSS 的 <code>view-transition-name</code> 属性给元素指定的名字。</li>
<li>默认情况下，只有 <code>::view-transition-group(root)</code> 这一个分组。</li>
<li>浏览器提供了一套<strong>用户代理样式表 (UA Stylesheet)</strong>，给这些伪元素加上了默认样式和动画，实现了那个默认的交叉淡入淡出效果。</li>
<li><code>::view-transition-old(root)</code> 代表着 startViewTransition 开始之前的页面快照（截图）</li>
<li><code>::view-transition-new(root)</code> 代表着当前 document.documentElement 元素，它被当成快照使用。在这个期间，你实时去续改 dom 的样式，就是直接反应在 <code>::view-transition-new(root)</code> 这个快照上。
<ul>
<li>也就是说，其实你的整个 document.documentElement 已经变成一个快照元素了，如果你隐藏了 <code>::view-transition</code>（opacity:0），你会发现整个 document.documentElement 都不见了，其实是灯下黑，它就是挂载在 <code>::view-transition-new(root)</code> 里头。同时因为处于快照模式，DOM 的交互实现现在完全无法响应。</li>
</ul>
</li>
<li>如果你通过<code>view-transition-name: name</code> 去定义一个 Element，那么等同于这个元素被剥离出来，独立成一个图层来渲染。
<ul>
<li>如果这个 name 在<code>::view-transition-new(root)</code>中存在，那么它会被抽出来作为<code>::view-transition-new(name)</code>进行渲染，否则那么就默认使用<code>::view-transition-old(name)</code>复制成<code>::view-transition-new(name)</code></li>
<li>也就是说，这时候有两个层叠在一起的元素<code>::view-transition-old(name)</code>和<code>::view-transition-new(name)</code>，默认情况下，前者会做淡出动画，后者会做淡入动画。因此你可以拿着这两个元素分别搞事情，从而实现复杂的动画效果。</li>
<li>以上同时二者被包含在 <code>::view-transition-image-pair(name)</code> 下面，同时 <code>::view-transition-image-pair(name)</code> 被包含在<code>::view-transition-group(name)</code>下面。目前 group 下面只有一个 image-pair 对象，之所以要设计成两层。是因为 image-pair 负责提供 <code>isolation: isolate</code>，然后 group 负责提供几何变 —— 即位置（transform）、尺寸（width, height）从旧状态到新状态的动画。</li>
<li>这里是因为 <code>isolation: isolate</code> 局限性，导致不得不分成两层。首先对于其作用，这里不展开细说，目的就是为了更好的前后过渡的混合效果</li>
<li>然后是如果将 image-pair 和 group 合并成一个行不行？答案是：不行。我们先假设如果分开，你可以在 group 上做背景色，而不会被 image-pair 所影响。因为<code>new</code>和<code>old</code>的 mix-blend-mode 只会干扰到 image-pair 就终止了。如果合成一个，那么背景色就会被参与到混合中去。</li>
<li>这里给一个例子 <a href="https://appn.dwewb.com/examples/kitchen-sink/isolation-isolate/">Isolation Demo</a></li>
</ul>
</li>
</ul>
<h2 id="五定制你的专属转场css-大显身手">五、定制你的专属转场：CSS 大显身手</h2>
<p>默认的淡入淡出太普通？没问题！既然是伪元素，我们就可以用 CSS 来定制它们的样式和动画！</p>
<p><strong>1. 改变默认动画时长或效果 (针对整个页面 root)</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* 让默认的交叉淡入淡出变慢一点 */</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-old(root),</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-new(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  animation-duration</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0.5</span><span style="color:#F97583">s</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 自定义动画：比如，旧的向左滑出并淡出，新的从右滑入并淡入 */</span></span>
<span class="line"><span style="color:#F97583">@keyframes</span><span style="color:#FFAB70"> slide-to-left</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  to</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    transform</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">translateX</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">-30</span><span style="color:#F97583">px</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">    opacity</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@keyframes</span><span style="color:#FFAB70"> slide-from-right</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  from</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    transform</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">translateX</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">30</span><span style="color:#F97583">px</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">    opacity</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-old(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">300</span><span style="color:#F97583">ms</span><span style="color:#79B8FF"> cubic-bezier</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#79B8FF">both</span><span style="color:#E1E4E8"> slide-to-left;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-new(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">300</span><span style="color:#F97583">ms</span><span style="color:#79B8FF"> cubic-bezier</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#79B8FF">90</span><span style="color:#F97583">ms</span><span style="color:#79B8FF"> both</span><span style="color:#E1E4E8"> slide-from-right; </span><span style="color:#6A737D">/* 延迟一点出现 */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>2. 让特定元素动起来：<code>view-transition-name</code></strong></p>
<p>想让页面上的某个卡片、头像、标题单独动起来？给它一个名字！</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* HTML 里有个卡片 */</span></span>
<span class="line"><span style="color:#6A737D">/* &#x3C;div class="card detailed-card">...&#x3C;/div> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* CSS 里给它命名 */</span></span>
<span class="line"><span style="color:#B392F0">.detailed-card</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  view-transition-name</span><span style="color:#E1E4E8">: detailed-card; </span><span style="color:#6A737D">/* 起个名字，必须唯一！ */</span></span>
<span class="line"><span style="color:#79B8FF">  contain</span><span style="color:#E1E4E8">: layout; </span><span style="color:#6A737D">/* 建议加上 contain，帮助浏览器优化 */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>一旦你给元素加了 <code>view-transition-name</code>：</p>
<ul>
<li>浏览器会为这个 <code>detailed-card</code> 创建<strong>单独的</strong> <code>::view-transition-group(detailed-card)</code>、<code>::view-transition-image-pair(detailed-card)</code> 等伪元素。</li>
<li>这个元素在旧状态和新状态的快照会被单独截取。</li>
<li><code>::view-transition-group(detailed-card)</code> 会自动从旧元素的位置/大小<strong>动画过渡</strong>到新元素的位置/大小。</li>
<li><code>::view-transition-old(detailed-card)</code> 和 <code>::view-transition-new(detailed-card)</code> 默认还是会进行<strong>交叉淡入淡出</strong>。</li>
</ul>
<p>你可以像上面修改 <code>root</code> 一样，针对 <code>detailed-card</code> 这个名字来定制动画：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#E1E4E8">::view-transition-group(</span><span style="color:#85E89D">detailed-card</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">  /* 可以改变 group 的动画，比如弹跳效果 */</span></span>
<span class="line"><span style="color:#79B8FF">  animation-timing-function</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">cubic-bezier</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1.5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1.5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-old(</span><span style="color:#85E89D">detailed-card</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">  /* 比如让旧卡片直接消失，不淡出 */</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">none</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">  opacity</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-new(</span><span style="color:#85E89D">detailed-card</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">  /* 比如让新卡片从下面飞入 */</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">300</span><span style="color:#F97583">ms</span><span style="color:#79B8FF"> ease-out</span><span style="color:#79B8FF"> both</span><span style="color:#E1E4E8"> slide-from-bottom;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@keyframes</span><span style="color:#FFAB70"> slide-from-bottom</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  from</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    transform</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">translateY</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">50</span><span style="color:#F97583">px</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">    opacity</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>重要提示</strong>：<code>view-transition-name</code> 的值在<strong>同一时刻</strong>必须是唯一的。如果在拍快照时发现有两个元素用了同一个名字，整个 View Transition 过程会失败（但 DOM 更新还是会执行）。</p>
<p><strong>3. 处理进入和离开动画 (使用 <code>:only-child</code>)</strong></p>
<p>有时候，某个元素只在新状态或旧状态存在（比如一个侧边栏导航只在某些页面有）。这时 <code>::view-transition-image-pair</code> 里就只有一个孩子 (<code>::view-transition-old</code> 或 <code>::view-transition-new</code>)。我们可以利用 CSS 的 <code>:only-child</code> 伪类来专门处理这种情况：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#B392F0">.sidebar</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  view-transition-name</span><span style="color:#E1E4E8">: sidebar;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 侧边栏进入动画 (新状态有，旧状态没有) */</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-new(sidebar)</span><span style="color:#B392F0">:only-child</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: slide-in </span><span style="color:#79B8FF">300</span><span style="color:#F97583">ms</span><span style="color:#79B8FF"> ease-out</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 侧边栏离开动画 (旧状态有，新状态没有) */</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-old(sidebar)</span><span style="color:#B392F0">:only-child</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: slide-out </span><span style="color:#79B8FF">300</span><span style="color:#F97583">ms</span><span style="color:#79B8FF"> ease-in</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 如果新旧状态都有侧边栏，默认的 group 位置/大小动画 + image-pair 淡入淡出可能就够了， */</span></span>
<span class="line"><span style="color:#6A737D">/* 或者你也可以单独为这种情况写动画 (不加 :only-child) */</span></span></code></pre>
<h2 id="六更骚的操作javascript-动画-web-animations-api">六、更骚的操作：JavaScript 动画 (Web Animations API)</h2>
<p>CSS 动画很方便，但对于某些交互性强、需要动态计算的动画（比如规范里的那个鼠标点击位置圆形展开的例子），JavaScript 就派上用场了。</p>
<p>最佳时机是等待 <code>transition.ready</code> Promise resolve 之后：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> navigateWithCircularReveal</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">clickEvent</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">document.startViewTransition) {</span></span>
<span class="line"><span style="color:#B392F0">    updateContent</span><span style="color:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 获取点击位置</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> x</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> clickEvent?.clientX </span><span style="color:#F97583">??</span><span style="color:#E1E4E8"> window.innerWidth </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> y</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> clickEvent?.clientY </span><span style="color:#F97583">??</span><span style="color:#E1E4E8"> window.innerHeight </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">  // 计算到最远角的距离作为最终半径</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> endRadius</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">hypot</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">    Math.</span><span style="color:#B392F0">max</span><span style="color:#E1E4E8">(x, window.innerWidth </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> x),</span></span>
<span class="line"><span style="color:#E1E4E8">    Math.</span><span style="color:#B392F0">max</span><span style="color:#E1E4E8">(y, window.innerHeight </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> y),</span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> transition</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">startViewTransition</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> updateContent</span><span style="color:#E1E4E8">(data));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 等待伪元素准备好</span></span>
<span class="line"><span style="color:#E1E4E8">  transition.ready.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 使用 Web Animations API</span></span>
<span class="line"><span style="color:#E1E4E8">    document.documentElement.</span><span style="color:#B392F0">animate</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#6A737D">        // 动画目标：从点击位置的小圆变成覆盖全屏的大圆</span></span>
<span class="line"><span style="color:#E1E4E8">        clipPath: [</span></span>
<span class="line"><span style="color:#9ECBFF">          `circle(0px at ${</span><span style="color:#E1E4E8">x</span><span style="color:#9ECBFF">}px ${</span><span style="color:#E1E4E8">y</span><span style="color:#9ECBFF">}px)`</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          `circle(${</span><span style="color:#E1E4E8">endRadius</span><span style="color:#9ECBFF">}px at ${</span><span style="color:#E1E4E8">x</span><span style="color:#9ECBFF">}px ${</span><span style="color:#E1E4E8">y</span><span style="color:#9ECBFF">}px)`</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#E1E4E8">        duration: </span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        easing: </span><span style="color:#9ECBFF">"ease-in"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6A737D">        // 关键：指定动画作用在哪个伪元素上！</span></span>
<span class="line"><span style="color:#E1E4E8">        pseudoElement: </span><span style="color:#9ECBFF">"::view-transition-new(root)"</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// 让新内容以圆形揭示出来</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    );</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>在这个例子里，我们还需要修改一下 CSS，阻止默认的淡入淡出，并让新旧内容直接叠加：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* 禁用默认动画 */</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-old(root),</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-new(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  animation</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">none</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 让新旧内容直接叠加，由 clip-path 控制谁可见 */</span></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-image-pair(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  isolation</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">auto</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">/* 如果不需要混合模式，可以设为 auto */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-new(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  mix-blend-mode</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">normal</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">/* 确保 JS 动画时混合模式正常 */</span></span>
<span class="line"><span style="color:#79B8FF">  z-index</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">/* 确保新内容在上面，被 clip-path 控制 */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">::view-transition-old(root) {</span></span>
<span class="line"><span style="color:#79B8FF">  mix-blend-mode</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">normal</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">  z-index</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="七注意事项与最佳实践">七、注意事项与最佳实践</h2>
<ol>
<li><strong><code>view-transition-name</code> 唯一性</strong>：再强调一次，非常重要！</li>
<li><strong><code>contain: layout</code> / <code>content-visibility: hidden</code></strong>：对于指定了 <code>view-transition-name</code> 的元素，加上 <code>contain: layout;</code> 或类似的 CSS（如 <code>contain: strict;</code> 或 <code>content-visibility: hidden;</code> 如果适用）可以帮助浏览器更好地隔离该元素的布局和渲染，提升性能。浏览器只需要知道这个元素的大小和位置，内部细节在快照时再处理。</li>
<li><strong>过渡是增强</strong>：时刻记住 View Transitions 是锦上添花。即使动画失败或被跳过，核心功能（DOM 更新）也应该能正常工作。</li>
<li><strong>性能考量</strong>：虽然浏览器会做优化，但截取快照、创建伪元素、运行动画还是有成本的。对于非常复杂的页面或大量的独立过渡元素，要注意测试性能。避免给太多小元素指定 <code>view-transition-name</code>。</li>
<li><strong>快照内容</strong>：快照是渲染结果，包括 CSS 绘制的背景、伪元素内容等。但不包括 <code>&#x3C;iframe></code> 内部的内容（除非同源）或某些插件内容。</li>
<li><strong>调试</strong>：现代浏览器的开发者工具（如 Chrome DevTools）已经开始支持调试 View Transitions，可以检查伪元素树、查看应用的动画等。</li>
</ol>
<h2 id="八总结">八、总结</h2>
<p>CSS View Transitions 绝对是近年来 Web 平台最令人兴奋的新特性之一。它精准地抓住了前端开发中关于页面切换动画的痛点，提供了一种优雅、高效且符合渐进增强理念的解决方案。</p>
<p>其核心在于<strong>分离 DOM 更新与视觉过渡</strong>，通过<strong>快照</strong>和<strong>伪元素树</strong>，让浏览器接管了繁琐的过渡动画协调工作，开发者只需要：</p>
<ol>
<li>用 <code>document.startViewTransition</code> 包裹你的 DOM 更新逻辑。</li>
<li>（可选）用 <code>view-transition-name</code> 标记需要独立动画的元素。</li>
<li>（可选）用 CSS 或 JavaScript (Web Animations API) 定制伪元素的动画效果。</li>
</ol>
<p>从此，打造原生 App 般丝滑的页面转场不再是难事。赶紧去试试吧，让你的网页也“纵享丝滑”！</p>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://www.w3.org/TR/css-view-transitions-1/">W3C CSS View Transitions Module Level 1 Spec</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/View_Transition_API">MDN 文档: View Transitions API</a></li>
<li><a href="https://developer.chrome.com/docs/web-platform/view-transitions/same-document">Same-document view transitions for single-page applications</a></li>
<li><a href="https://github.com/demarketed/view-transitions-polyfill">github.com/demarketed/view-transitions-polyfill</a></li>
<li><a href="https://caniuse.com/view-transitions"><code>caniuse View Transitions API (single-document)</code></a>
<ul>
<li>chrome 111+</li>
<li>safari 18.0+</li>
</ul>
</li>
</ul> </article>  </div> </main> <aside class="hidden lg:block sticky top-0 h-screen w-64 flex-shrink-0 py-8 pl-8"> <div class="space-y-4"> <div class="rounded-xl border bg-card text-card-foreground shadow"><div class="p-6 pt-0"><ul><li><a href="#一告别刀耕火种view-transitions-要解决啥蛋疼问题">一、告别刀耕火种：View Transitions 要解决啥蛋疼问题？</a></li><li><a href="#二view-transitions-的核心思想与哲学解耦分离">二、View Transitions 的核心思想与哲学：解耦！分离！</a></li><li><a href="#三上手初体验documentstartviewtransition-登场">三、上手初体验：document.startViewTransition 登场！</a></li><li><a href="#四深入幕后揭秘伪元素树">四、深入幕后：揭秘伪元素树</a></li><li><a href="#五定制你的专属转场css-大显身手">五、定制你的专属转场：CSS 大显身手</a></li><li><a href="#六更骚的操作javascript-动画-web-animations-api">六、更骚的操作：JavaScript 动画 (Web Animations API)</a></li><li><a href="#七注意事项与最佳实践">七、注意事项与最佳实践</a></li><li><a href="#八总结">八、总结</a></li></ul></div></div> <div class="rounded-xl border bg-card text-card-foreground shadow"><div class="flex flex-col space-y-1.5 p-6"><div class="font-semibold leading-none tracking-tight">Tags</div></div><div class="p-6 pt-0"><div class="flex flex-wrap gap-2"><a href="/tags/article" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">article</a><a href="/tags/event" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">event</a><a href="/tags/rust" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">rust</a><a href="/tags/iced" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">iced</a><a href="/tags/gui" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">gui</a><a href="/tags/multiplatform" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">multiplatform</a><a href="/tags/mobile" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">mobile</a><a href="/tags/web" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">web</a><a href="/tags/Kotlin" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">Kotlin</a><a href="/tags/linux" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">linux</a><a href="/tags/dns" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">dns</a><a href="/tags/javascript" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">javascript</a><a href="/tags/async" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">async</a><a href="/tags/reactive" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">reactive</a><a href="/tags/html&amp;css" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">html&amp;css</a><a href="/tags/cogitation" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">cogitation</a><a href="/tags/tools" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">tools</a><a href="/tags/efficiency" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">efficiency</a><a href="/tags/trivial" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">trivial</a><a href="/tags/lift" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">lift</a><a href="/tags/C++" class="bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-sm font-semibold">C++</a></div></div></div> <div class="rounded-xl border bg-card text-card-foreground shadow"><div class="flex flex-col space-y-1.5 p-6"><div class="font-semibold leading-none tracking-tight">Archive</div></div><div class="p-6 pt-0"><ul><li><a href="/archive/2025/09">2025-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2025/06">2025-06<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2025/05">2025-05<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2025/04">2025-04<!-- --> (<!-- -->12<!-- -->)</a></li><li><a href="/archive/2025/03">2025-03<!-- --> (<!-- -->9<!-- -->)</a></li><li><a href="/archive/2024/05">2024-05<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2024/04">2024-04<!-- --> (<!-- -->3<!-- -->)</a></li><li><a href="/archive/2023/05">2023-05<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2023/04">2023-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2023/03">2023-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2022/10">2022-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2022/04">2022-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2021/12">2021-12<!-- --> (<!-- -->3<!-- -->)</a></li><li><a href="/archive/2021/07">2021-07<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2021/04">2021-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/10">2020-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/09">2020-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/05">2020-05<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2020/04">2020-04<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2020/03">2020-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2018/07">2018-07<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2017/10">2017-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2017/03">2017-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/10">2016-10<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2016/09">2016-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/08">2016-08<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/07">2016-07<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/05">2016-05<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/03">2016-03<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2016/02">2016-02<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2015/02">2015-02<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2014/09">2014-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2014/04">2014-04<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2014/03">2014-03<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2014/02">2014-02<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2014/01">2014-01<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2013/12">2013-12<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/10">2013-10<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/09">2013-09<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/08">2013-08<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2013/07">2013-07<!-- --> (<!-- -->2<!-- -->)</a></li><li><a href="/archive/2013/06">2013-06<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/archive/2013/05">2013-05<!-- --> (<!-- -->4<!-- -->)</a></li></ul></div></div> </div> </aside> </div> <astro-island uid="twXPy" prefix="r12" component-url="/_astro/Footer.BXY8aI41.js" component-export="default" renderer-url="/_astro/client.DcVwxw19.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;Footer&quot;,&quot;value&quot;:true}" await-children><footer class="border-t border-zinc-200 dark:border-zinc-700 mt-12 pt-8 pb-12"><div class="flex items-center justify-center space-x-6 text-sm text-zinc-600 dark:text-zinc-400"><a href="https://github.com/gaubee/gaubee.com" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-2 transition-colors hover:text-zinc-900 dark:hover:text-zinc-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span>Source Code</span></a><a href="https://beian.miit.gov.cn/#/Integrated/recordQuery" target="_blank" rel="noopener noreferrer" class="transition-colors hover:text-zinc-900 dark:hover:text-zinc-100">闽ICP备17026139号-1</a></div></footer><!--astro:end--></astro-island> <astro-island uid="Tziuc" prefix="r13" component-url="/_astro/BackToTop.SXSzft_N.js" component-export="default" renderer-url="/_astro/client.DcVwxw19.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;BackToTop&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Back to top" class="fixed right-8 bottom-8 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-zinc-900/20 text-white shadow-lg backdrop-blur-sm backdrop-saturate-200 transition-opacity duration-300 hover:bg-zinc-700 dark:bg-zinc-100/20 dark:text-zinc-900 dark:hover:bg-zinc-300 opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up" aria-hidden="true"><path d="m5 12 7-7 7 7"></path><path d="M12 19V5"></path></svg></button><!--astro:end--></astro-island>  </body></html>