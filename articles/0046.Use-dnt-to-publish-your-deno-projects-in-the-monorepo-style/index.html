<!doctype html><html><head><meta charset="utf-8"><meta name="description" content=""><meta name="keywords" content="Appn, WebComponent, article"><meta name="author" content="Gaubee, gaubeebangeel@gmail.com"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5"><title>使用 dnt 将你的 deno 项目发布成 monorepo 风格</title><link rel="shortcut icon" href="/assets/favicon-wB3RD3gX.ico"><link rel="stylesheet" href="/index.css">  <link rel="stylesheet" crossorigin href="/assets/prism-okaidia-D95GE6Gn.css">
</head><body><header class="bg-ani"><style>.nav{padding:0 2em;border-radius:2em;backdrop-filter:contrast(0.5) brightness(2);width:fit-content;max-width:100%}.nav{display:grid;grid-template-columns:repeat(auto-fit,180px);justify-content:center;gap:12px}.nav>a{display:block;flex:1;font-size:18px;padding:16px;text-align:center}.nav>a{color:#e91e63}@supports (-webkit-background-clip:text){.nav>a{background:-webkit-linear-gradient(#e91e63,#673ab7);color:transparent;-webkit-background-clip:text;-webkit-text-fill-color:transparent}}</style><nav class="nav"><a class="" href="/">Home</a> <a class="target" href="/articles/">Articles</a> <a class="" href="/events/">Events</a> <a class="" href="/timeline/">Timeline</a> <a class="" href="/projects/">Projects</a></nav></header><div id="main-wrapper" class="article-wrapper"><main><h1>使用 dnt 将你的 deno 项目发布成 monorepo 风格</h1><h2>使用 dnt 将你的 deno 项目发布成 monorepo 风格</h2><blockquote><p>在提供理论指导之前，我们先看具体的实践如何做到，完成后，我再说明这种项目管理方案的优势在哪里。</p></blockquote><h3>工具</h3><ol><li><a href="https://deno.com/">deno</a></li><li><a href="https://pnpm.io/installation">pnpm</a></li></ol><h3>准备工作</h3><ol><li><p>创建你的项目：</p><pre class="language-shell"><code class="language-shell">deno init dnt-mono
<span class="token comment"># cd dnt-mono</span>
<span class="token comment"># code . # open in ide</span></code></pre></li><li><p>初始化 git 仓库</p><pre class="language-shell"><code class="language-shell"><span class="token function">git</span> init
<span class="token builtin class-name">echo</span> <span class="token string">"npm<span class="token entity" title="\n">\n</span>node_modules"</span> <span class="token operator">></span> .gitignore <span class="token comment"># ignore the npm folder</span></code></pre></li><li><p>初始化 package.json，以及一些 npm/pnpm 通常所需的文件</p><pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> init <span class="token parameter variable">--yes</span> <span class="token parameter variable">--private</span> <span class="token comment"># create a package.json file</span>
<span class="token builtin class-name">echo</span> <span class="token string">"MIT"</span> <span class="token operator">></span> LICENSE
<span class="token builtin class-name">echo</span> <span class="token string">"# Hello Dnt ❤️ Monorepo"</span> <span class="token operator">></span> README.md
<span class="token builtin class-name">echo</span> <span class="token string">"packages:<span class="token entity" title="\n">\n</span>  - <span class="token entity" title="\&quot;">\"</span>npm/*<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">></span> pnpm-workspace.yaml</code></pre></li><li><p>准备 dnt 脚本</p><pre class="language-shell"><code class="language-shell">deno <span class="token function">add</span> @deno/dnt</code></pre><p>参考 <a href="https://github.com/denoland/dnt?tab=readme-ov-file#setup">Setup</a>，因为我们需要构建多个 npm 包，所以创建 <code>scripts/npmBuilder.ts</code> 文件：</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> build<span class="token punctuation">,</span> BuildOptions<span class="token punctuation">,</span> emptyDir <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@deno/dnt"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">"node:fs"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">"node:path"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"node:url"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rootDir <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">rootResolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> rootDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">npmBuilder</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token punctuation">{</span>
  packageDir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  version<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  importMap<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  options<span class="token operator">?</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>BuildOptions<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> packageDir<span class="token punctuation">,</span> version<span class="token punctuation">,</span> importMap<span class="token punctuation">,</span> options <span class="token punctuation">}</span> <span class="token operator">=</span> config<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">packageResolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> packageDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>
    fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token function">packageResolve</span><span class="token punctuation">(</span><span class="token string">"./package.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// remove some field which dnt will create. if you known how dnt work, you can keep them.</span>
  <span class="token keyword">delete</span> packageJson<span class="token punctuation">.</span>main<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> packageJson<span class="token punctuation">.</span>module<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> packageJson<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\nstart dnt: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageJson<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> npmDir <span class="token operator">=</span> <span class="token function">rootResolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./npm/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageJson<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">npmResolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>npmDir<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">emptyDir</span><span class="token punctuation">(</span>npmDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">,</span> <span class="token punctuation">{</span> version<span class="token operator">:</span> version <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    entryPoints<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token function">packageResolve</span><span class="token punctuation">(</span><span class="token string">"./index.ts"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    outDir<span class="token operator">:</span> npmDir<span class="token punctuation">,</span>
    packageManager<span class="token operator">:</span> <span class="token string">"pnpm"</span><span class="token punctuation">,</span>
    shims<span class="token operator">:</span> <span class="token punctuation">{</span>
      deno<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// you should open it in actual</span>
    test<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    importMap<span class="token operator">:</span> importMap<span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> packageJson<span class="token punctuation">,</span>
    <span class="token comment">// custom by yourself</span>
    compilerOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      lib<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"DOM"</span><span class="token punctuation">,</span> <span class="token string">"ES2022"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      target<span class="token operator">:</span> <span class="token string">"ES2022"</span><span class="token punctuation">,</span>
      emitDecoratorMetadata<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">postBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// steps to run after building and before running the tests</span>
      Deno<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span><span class="token function">rootResolve</span><span class="token punctuation">(</span><span class="token string">"./LICENSE"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">npmResolve</span><span class="token punctuation">(</span><span class="token string">"./LICENSE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Deno<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>
        <span class="token function">packageResolve</span><span class="token punctuation">(</span><span class="token string">"./README.md"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">npmResolve</span><span class="token punctuation">(</span><span class="token string">"./README.md"</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li></ol><h3>主要步骤</h3><ol><li><p>创建两个子文件夹，加入一些项目文件</p><pre class="language-shell"><code class="language-shell"><span class="token comment"># start from root</span>
<span class="token function">mkdir</span> packages/module-a
<span class="token builtin class-name">cd</span> packages/module-a
<span class="token builtin class-name">echo</span> <span class="token string">"export const a = 1;"</span> <span class="token operator">></span> index.ts
<span class="token builtin class-name">echo</span> <span class="token string">"# @dnt-mono/module-a"</span> <span class="token operator">></span> README.md
<span class="token function">npm</span> init <span class="token parameter variable">--scope</span> @dnt-mono <span class="token parameter variable">--yes</span> <span class="token comment"># name : @dnt-mono/module-a</span></code></pre><p>同样的步骤，创建 <code>module-b</code> 文件夹</p><pre class="language-shell"><code class="language-shell"><span class="token comment"># start from root</span>
<span class="token function">mkdir</span> packages/module-b
<span class="token builtin class-name">cd</span> packages/module-b
<span class="token builtin class-name">echo</span> <span class="token string">"import { a } from <span class="token entity" title="\&quot;">\"</span>@dnt-mono/module-a<span class="token entity" title="\&quot;">\"</span>;<span class="token entity" title="\n">\n</span>export const b = a + 1;"</span> <span class="token operator">></span> index.ts
<span class="token builtin class-name">echo</span> <span class="token string">"# @dnt-mono/module-b"</span> <span class="token operator">></span> README.md
<span class="token function">npm</span> init <span class="token parameter variable">--scope</span> @dnt-mono <span class="token parameter variable">--yes</span> <span class="token comment"># name : @dnt-mono/module-b</span>

<span class="token function">pnpm</span> <span class="token function">add</span> @dnt-mono/module-a <span class="token parameter variable">--workspace</span> <span class="token comment"># add module-a as dependencie</span></code></pre></li><li><p>在这个事例中， <code>module-b</code> 依赖了 <code>module-a</code>，同时我们在代码中使用了 <code>@dnt-mono/module-a</code> 这个 specifier，所以我们为了让 deno 的语言服务器正确工作，还需要做一些配置。在 <code>deno.json</code> 的 <code>imports</code> 字段中加入这些配置：</p><pre class="language-jsonc"><code class="language-jsonc"> "@dnt-mono/module-a": "./packages/module-a/index.ts", // in imports
 "@dnt-mono/module-b": "./packages/module-b/index.ts" // in imports</code></pre></li><li><p>接着，我们创建构建脚本和配置文件</p><ol><li><p><code>scripts/build_npm.ts</code></p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> npmBuilder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./npmBuilder.ts"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> version <span class="token operator">=</span> Deno<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">npmBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  packageDir<span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"../packages/module-a/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  importMap<span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./import_map.npm.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  version<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">npmBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  packageDir<span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"../packages/module-b/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  importMap<span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./import_map.npm.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  version<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p><code>scripts/import_map.npm.json</code></p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"imports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@dnt-mono/module-a"</span><span class="token operator">:</span> <span class="token string">"npm:@dnt-mono/module-a"</span><span class="token punctuation">,</span>
    <span class="token property">"@dnt-mono/module-b"</span><span class="token operator">:</span> <span class="token string">"npm:@dnt-mono/module-b"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></li></ol></li><li><p>然后，在你的 <code>deno.json</code> 中配置 build 指令：</p><pre class="language-jsonc"><code class="language-jsonc">"build": "deno run -A ./scripts/build_npm.ts" // in tasks</code></pre></li><li><p>最后，尝试执行 build 指令，构建出 npm 目录</p><pre class="language-shell"><code class="language-shell">deno task build</code></pre><p>这时候，你可以看到 npm 目录下输出了 module-a 和 module-b 两个 npm 包文件夹。 现在你可以尝试发布这些 npm 包了：</p><pre class="language-shell"><code class="language-shell"><span class="token function">pnpm</span> publish <span class="token parameter variable">-r</span> --no-git-checks --dry-run <span class="token comment"># you should remove --dry-run actual</span></code></pre></li></ol><h3>工作原理</h3><ol><li>我们使用 deno 作为语言服务器，它很强大，很多体验经过定制化开发，已经超越 tsc 本身。</li><li>所以 package.json 在这里只是一个“模板文件”，而不是配置文件。在开发中，真正生效的配置文件只有 deno.json</li><li>因此，pnpm 在这里是一个面向 dnt 最终编译产出的工具，也就是只服务于 <code>npm/*</code> 的目录。这也是为什么 <code>pnpm-workspaces.yaml</code> 的配置是这样的</li><li>dnt 中使用的 <code>import_map.npm.json</code> 很重要，我们不能直接使用 <code>deno.json</code> 作为 <code>importMap</code>，因为<code>deno.json</code>配置给 deno 语言服务器，而 <code>import_map.npm.json</code> 是配置给 dnt/pnpm 使用的。在复杂的项目中，建议你用脚本自动生成并管理它。</li></ol><h3>进阶技巧</h3><p>在 deno 的开发中，我们的理念是面向文件而不是面向模块，因此如果有需要，你需要增加这样的配置在<code>deno.json</code>中：</p><pre class="language-jsonc"><code class="language-jsonc">{
  // ...
  "imports": {
    // ...
    "@dnt-mono/module-a": "./packages/module-a/index.ts",
    "@dnt-mono/module-a/": "./packages/module-a/src/",
    "@dnt-mono/module-b": "./packages/module-b/index.ts",
    "@dnt-mono/module-b/": "./packages/module-b/src/"
    // ...
  }
}</code></pre><p>我习惯将除了 <code>index.ts</code> 意外的文件放到 <code>src</code> 目录下，这会更加符合 node 项目的风格。</p><blockquote><p>但切记，不要把 index.ts 文件也挪到 <code>src</code> 目录下，否则会引发异常 <a href="https://github.com/denoland/dnt/issues/249">#249</a></p></blockquote><p>然后，就是 dnt 的配置，你需要遍历你所有的文件，并将它配置到 entryPoints 中：</p><pre class="language-ts"><code class="language-ts"><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  entryPoints<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// default entry</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token function">packageResolve</span><span class="token punctuation">(</span><span class="token string">"./index.ts"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// src files</span>
    <span class="token constant">ALL_SRC_TS_FILES</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./src/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>现在，你就可以写这样的代码了：</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> xxx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dnt-mono/module-a/xxx.ts"</span><span class="token punctuation">;</span></code></pre><h3>注意事项</h3><ol><li>规划好你的项目结构，避免形成循环依赖。如果有需要，你需要自己配置 peerDependencies</li><li>不要在某个模块中做自引入。<blockquote><p>语言服务器并不理解你最终要发布 npm 的意图，所以即便 deno 能正确工作，但你的目的是让 node 也能工作。</p></blockquote><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dnt-mono/module-a"</span><span class="token punctuation">;</span> <span class="token comment">// don't import module-a in module-a</span></code></pre>在正式的项目中，建议编写 lint 规则来避免这种错误的发生</li></ol><h3>优势</h3></main></div><style>footer a{line-height:1}footer nav{display:flex;gap:1rem}</style><footer class="bg-ani"><nav><a target="_blank" href="https://github.com/gaubee/gaubee.com">Github</a> <a target="_blank" href="https://beian.miit.gov.cn/#/Integrated/recordQuery">闽ICP备17026139号-1</a></nav></footer></body></html>