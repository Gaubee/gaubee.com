<!doctype html><html lang=zh-CH><meta charset=utf-8><title>使用WebGL作色器基础知识实现PIXI.js高斯三角模糊 · Gaubee</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#ec407a name=theme-color><link href=/articles.atom rel=alternate title="Gaubee's Articles Atom feed" type=application/atom+xml><link href=/events.atom rel=alternate title="Gaubee's Events Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><header id=header><h1><a href=/ >Gaubee</a></h1><a href=#navigation-toggle id=nav-toggle>显示导航 Show navigation</a><nav><ul><li><a href=/ >主页 Home</a><li class=current><a href=/articles>文章 Articles</a><li><a href=/events>小事件 Events</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>使用WebGL作色器基础知识实现PIXI.js高斯三角模糊</h1><p class=meta>发布于 <time datetime=5/3/2016 itemprop=datePublished>5/3/2016</time> · 最后修改时间 <time datetime=5/4/2016 itemprop=dateModified>5/4/2016</time> · 标签： <a href=/blog/tags/javascript class=tag>javascript</a></header><div itemprop=articleBody><p>官方给出的模糊滤镜效果不尽人意，所以就想自己写一个，顺带学习了一些 WebGL 的作色器相关的基础知识。<br>说真的网上的文章讲得不是很乱，以下是我总结出来的。<h2 id=webgl-%E4%BD%9C%E8%89%B2%E5%99%A8 tabindex=-1><a href=#webgl-%E4%BD%9C%E8%89%B2%E5%99%A8 class=header-anchor>WebGL 作色器</a></h2><p>作色器的基本理念我不赘述。不了解的看下面猜测一下也能猜出个大概。<br>这里从 PIXI.js 的源码中来看，用<a href=https://github.com/pixijs/pixi.js/blob/master/src/filters/blur/BlurXFilter.js>blurXFilter</a>为例，顶点作色器的代码如下：<pre class=language-glsl><code class=language-glsl><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> aVertexPosition<span class="token punctuation">;</span><br><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> aTextureCoord<span class="token punctuation">;</span><br><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> aColor<span class="token punctuation">;</span><br><br><span class="token keyword">uniform</span> <span class="token keyword">float</span> strength<span class="token punctuation">;</span><br><span class="token keyword">uniform</span> <span class="token keyword">mat3</span> projectionMatrix<span class="token punctuation">;</span><br><br><span class="token keyword">varying</span> <span class="token keyword">vec2</span> vTextureCoord<span class="token punctuation">;</span><br><span class="token keyword">varying</span> <span class="token keyword">vec4</span> vColor<span class="token punctuation">;</span><br><span class="token keyword">varying</span> <span class="token keyword">vec2</span> vBlurTexCoords<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>projectionMatrix <span class="token operator">*</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token punctuation">(</span>aVertexPosition<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vTextureCoord <span class="token operator">=</span> aTextureCoord<span class="token punctuation">;</span><br><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.012</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.008</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.004</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">0.004</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">0.008</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">0.012</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    vColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>aColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span> aColor<span class="token punctuation">.</span>a<span class="token punctuation">,</span> aColor<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p><strong>顶点作色器</strong>程序执行过程中需要数据，首先了解这三种数据：<ol><li>Attribute (从缓冲区对象中拉取数据)<li>Uniform (在绘制过程中所有顶点都需要的、固定的数据值)<li>Texture (像素/纹理元素数据)<br><strong>片元作色器</strong>也需要数据，也是三种获取方式：<li>Uniform (在绘制过程中每个像素都需要的、固定的变量值)<li>Texture (像素/纹理元素数据)<li>Varying (从顶点着色器传递过来并且经过内插过程的数据)</ol><p>简单的站在我这个新手的角度来说，我是这样看的：<br>attribute 是 PIXI 框架传入的数据，顶点作色器最终的计算数据是反应到<code>gl_Position</code>上面。<br>uniform 是用户自己传入的数据。<br>varying 是定点作色器和片元作色器的共享的数据。<p>所以对比<a href=https://github.com/pixijs/pixi.js/blob/039200b46d7840f065faa50739e4b98f69678db4/src/core/renderers/webgl/shaders/TextureShader.js#L74-L90>默认的顶点作色器代码 TextureShader</a>，可以看出有三行都是一样的：<pre class=language-glsl><code class=language-glsl>gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>projectionMatrix <span class="token operator">*</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>aVertexPosition<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>vTextureCoord <span class="token operator">=</span> aTextureCoord<span class="token punctuation">;</span><br>vColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>aColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span> aColor<span class="token punctuation">.</span>a<span class="token punctuation">,</span> aColor<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>不管这三行，看其它部分：<pre class=language-glsl><code class=language-glsl>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.012</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.008</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.004</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">0.004</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">0.008</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> aTextureCoord <span class="token operator">+</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">0.012</span> <span class="token operator">*</span> strength<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>当我把 strength 值调整到 100 后，是这样的效果：<figure><img alt="" height=245 loading=lazy src=/img/pixi-webgl-gaussian-blur/strength-100.png width=340><figcaption>image</figcaption></figure><p>我不得不诟病这个模糊效果（不然也不会有这篇文章了）。所以现在理解一下上面的代码：<br><code>vec2( X , Y)</code> 意味着一个偏移量，其中 Y=0，而<code>aTextureCoord</code>从命名理解就是<strong>纹理坐标</strong>，这里 j 把纹理贴图左右两边的数据拿了过来，在执行片元作色器的时候用上了：<pre class=language-glsl><code class=language-glsl><span class="token keyword">precision</span> <span class="token keyword">lowp</span> <span class="token keyword">float</span><span class="token punctuation">;</span><br><br><span class="token keyword">varying</span> <span class="token keyword">vec2</span> vTextureCoord<span class="token punctuation">;</span><br><span class="token keyword">varying</span> <span class="token keyword">vec2</span> vBlurTexCoords<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">varying</span> <span class="token keyword">vec4</span> vColor<span class="token punctuation">;</span><br><br><span class="token keyword">uniform</span> <span class="token keyword">sampler2D</span> uSampler<span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.004431848411938341</span><span class="token punctuation">;</span><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.05399096651318985</span><span class="token punctuation">;</span><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.2419707245191454</span><span class="token punctuation">;</span><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vTextureCoord     <span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.3989422804014327</span><span class="token punctuation">;</span><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.2419707245191454</span><span class="token punctuation">;</span><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.05399096651318985</span><span class="token punctuation">;</span><br>    gl_FragColor <span class="token operator">+=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>uSampler<span class="token punctuation">,</span> vBlurTexCoords<span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.004431848411938341</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>可以看到实现方式就是把左右纹理贴图的数据以渐变的方式贴到一个点上，最终看到的就是上面效果图展示的多层贴图以不同透明度重叠的效果。PS: <code>vColor</code>这个参数我猜是遮罩或者透明通道<h2 id=%E5%8F%82%E8%80%83-glfx-%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A tabindex=-1><a href=#%E5%8F%82%E8%80%83-glfx-%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A class=header-anchor>参考 glfx 实现高斯模糊</a></h2><p>对比<a href=https://github.com/evanw/glfx.js/blob/master/src/filters/blur/triangleblur.js>triangleblur.js</a>。可以看出它的作色器代码其实是片元作色器代码，顶点作色器放空 null 使用默认。所以对比一下参数其实就好办了：<br>其中<code>delta</code>这个参数都是用户传入的，剩下的只有<code>texture|texCoord</code>分别对应 PIXI.js 中的<code>uSampler|vTextureCoord</code>。<p>所以代码关系对上后就好说了，接下来用 TypeScript 来实现 PIXI.js 中的高斯模糊滤镜。<h2 id=pixi.js-%E4%B8%AD%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A%E7%9A%84%E5%AE%9E%E7%8E%B0 tabindex=-1><a href=#pixi.js-%E4%B8%AD%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A%E7%9A%84%E5%AE%9E%E7%8E%B0 class=header-anchor>PIXI.js 中高斯模糊的实现</a></h2><p>参考官方写法，先搭建出大概的类架构：<pre class=language-typescript><code class=language-typescript><span class="token keyword">class</span> <span class="token class-name">GaussianBlur</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">PIXI</span></span><span class="token punctuation">.</span>AbstractFilter <span class="token punctuation">{</span><br>  _delta<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> vert <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> frag <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>vert<span class="token punctuation">,</span> frag<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">applyFilter</span><span class="token punctuation">(</span>renderer<span class="token punctuation">,</span> input<span class="token punctuation">,</span> output<span class="token punctuation">,</span> clear<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token keyword">get</span> <span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_delta<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">set</span> <span class="token function">blur</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>_delta <span class="token operator">=</span> value<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> GaussianBlur<span class="token punctuation">;</span></code></pre><p>然后就是要传入作色器代码了:<pre class=language-typescript><code class=language-typescript><span class="token keyword">var</span> randomShaderFunc <span class="token operator">=</span><br>  <span class="token string">"\<br>    float random(vec3 scale, float seed) {\<br>        /* use the fragment position for a different seed per-pixel */\<br>        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\<br>    }\<br>"</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> vert <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">attribute vec2 aVertexPosition;<br>attribute vec2 aTextureCoord;<br>attribute vec4 aColor;<br><br>uniform vec2 delta;<br>uniform mat3 projectionMatrix;<br><br>varying vec2 vTextureCoord;<br>varying vec4 vColor;<br>varying vec2 vDelta;<br><br>void main(void)<br>{<br>    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);<br>    vTextureCoord = aTextureCoord;<br><br>    vDelta = delta;<br><br>    vColor = vec4(aColor.rgb * aColor.a, aColor.a);<br>}</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">let</span> frag <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">precision lowp float;<br><br>varying vec2 vTextureCoord;<br>varying vec2 vDelta;<br>varying vec4 vColor;<br><br>uniform sampler2D uSampler;<br></span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>randomShaderFunc<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"><br>void main() {<br>    vec4 color = vec4(0.0);<br>    float total = 0.0;<br><br>    /* randomize the lookup values to hide the fixed number of samples */<br>    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);<br><br>    for (float t = -30.0; t &lt;= 30.0; t++) {<br>        float percent = (t + offset - 0.5) / 30.0;<br>        float weight = 1.0 - abs(percent);<br>        vec4 sample = texture2D(uSampler, vTextureCoord + vDelta * percent);<br><br>        /* switch to pre-multiplied alpha to correctly blur transparent images */<br>        sample.rgb *= sample.a;<br><br>        color += sample * weight;<br>        total += weight;<br>    }<br><br>    gl_FragColor = color / total;<br><br>    /* switch back from pre-multiplied alpha */<br>    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;<br>}</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span></code></pre><p>要注意的是，PIXI.js 的风格就是数据都是从顶点作色器那边传入的，所以 detal 参数就从顶点作色器那边进行赋值并在片元作色器那边使用。片元作色器那边基本就是把 glfx 的代码拷贝过来，然后把参数命名改成 PIXI 中的参数命名即可。要注意的是<code>precision lowp float;</code>这一句 glfx 没有，PIXI 中一定要加，好像是声明精度的问题，作为一个小白，暂时不理解，只是在做的过程中发现如果没有这句的话作色器编译的时候会报错。<br>最终效果（blur=10）：<figure><img alt="" height=221 loading=lazy src=/img/pixi-webgl-gaussian-blur/blur-10.png width=221><figcaption>image</figcaption></figure><p>还有一个要注意的问题就是这个滤镜要跑两次才行，就是 X\Y 是分开来模糊的，如果一起的话，会变成斜方向的模糊。PIXI 中类似的实现参考<a href=https://github.com/pixijs/pixi.js/blob/master/src/filters/blur/BlurFilter.js>BlurFilter</a>，因为它也是 X、Y 两次模糊滤镜后的效果。以下是我 applyFilter 的代码：<pre class=language-typescript><code class=language-typescript><span class="token keyword">var</span> shader <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getShader</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> renderTarget <span class="token operator">=</span> renderer<span class="token punctuation">.</span>filterManager<span class="token punctuation">.</span><span class="token function">getRenderTarget</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>delta<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><br>  x<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_delta <span class="token operator">/</span> input<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span><br>  y<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br>renderer<span class="token punctuation">.</span>filterManager<span class="token punctuation">.</span><span class="token function">applyFilter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> input<span class="token punctuation">,</span> renderTarget<span class="token punctuation">,</span> clear<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>delta<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><br>  x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  y<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_delta <span class="token operator">/</span> input<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br>renderer<span class="token punctuation">.</span>filterManager<span class="token punctuation">.</span><span class="token function">applyFilter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> renderTarget<span class="token punctuation">,</span> output<span class="token punctuation">,</span> clear<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// 很重要，不加的话会引发内存泄漏</span><br>renderer<span class="token punctuation">.</span>filterManager<span class="token punctuation">.</span><span class="token function">returnRenderTarget</span><span class="token punctuation">(</span>renderTarget<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><hr><p>最后贴出完整代码：<br>Typescript、ES6 版本：<a href=https://gist.github.com/Gaubee/54aa14b5e06ef8c3f5c25e1964c89fab#file-gaussianblur-ts>Gaussianblur.ts</a><br>ES5 版本：<a href=https://gist.github.com/Gaubee/54aa14b5e06ef8c3f5c25e1964c89fab#file-gaussianblur-js>Gaussianblur.js</a></div><footer></footer></article></main><footer id=footer><div><nav><a href=https://twitter.com/gaubeebangeel rel="me nofollow" target=_blank>Twitter</a> · <a href=https://github.com/gaubee/gaubee.com/tree/main/./src/articles/使用WebGL作色器基础知识实现PIXI.js高斯三角模糊.md rel=nofollow target=_blank>Edit this page on GitHub</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>除非有特别的说明, 该站点所有直接内容都使用许可证：<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>署名 4.0 国际 (CC BY 4.0)</a></small><blockquote><small>本网站不收集任何访问者的行为与信息，不做任何商业运作，仅仅为个人使用</small></blockquote></footer><script src=/js/dark-mode-toggle.mjs type=module></script><script src=/js/time-elements.mjs type=module></script><script src=/js/main.mjs type=module></script>