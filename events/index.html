<!doctype html><html lang=zh-CN><meta charset=utf-8><title>events · Gaubee</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/css/main.css rel=stylesheet><link href=/webmanifest.json rel=manifest><meta content=#ec407a name=theme-color><link href=/articles.atom rel=alternate title="Gaubee's Articles Atom feed" type=application/atom+xml><link href=/events.atom rel=alternate title="Gaubee's Events Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><header id=header><h1><a href=/ >Gaubee</a></h1><a href=#navigation-toggle id=nav-toggle>显示导航 Show navigation</a><nav><ul><li><a href=/ >主页 Home</a><li><a href=/articles>文章 Articles</a><li class=current><a href=/events>小事件 Events</a></ul></nav></header><main id=main><h1>Event post archive</h1>[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]<ul><li><div><p><p>以华为的技术储备，做一款替代AR1的芯片和对应的产品，应该可以非常具有颠覆性的竞争力。25年相关的新技术也都可以量产了<p></p><relative-time datetime=2024-05-14T05:23:03.136+00:00>2024-05-14T05:23:03.136+00:00</relative-time><a href=/events/huawei-ar1>share↗</a></div><li><div><p><p>我发现浏览器有一个很离谱的 BUG，我不知道它是出于什么原因<pre class=language-js><code class=language-js><span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"http:/127.0.0.1:8000/test.mjs"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这个协议头不规范，居然能宽容地正确解析出来。<br>也就意味着在浏览器中，<code>new URL("https:/qaq.dweb/index.ts")</code> 能被合法解析成 <code>new URL("https://qaq.dweb/index.ts")</code>:<p>这个 bug，可以带来一个玩法。我可以利用这个 bug，用 node 实现类似 deno 的功能。因为 deno 近乎是完全使用浏览器的标准，所以说浏览器上面的这个 bug，在 deno 中同样也会有，也同样适用……<br>在 nodejs 项目里，只需要在 node_modules 里头创建一个 <code>https:</code> 的文件夹。它完全不会报错，可以正确解析。<p>比如说以下 deno 代码：<pre class=language-ts><code class=language-ts><span class="token keyword">import</span> <span class="token punctuation">{</span> Server <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https:/deno.land/std@0.187.0/http/server.ts"</span><span class="token punctuation">;</span> <span class="token comment">// 这里使用单斜杆，也会被认为是双斜杠</span></code></pre><p>然后同样的代码，在 nodejs 项目中，不启用 deno，只添加一个 tsconfig.json，使用 <a href=https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-0.html#allowimportingtsextensions>ts5+</a> 来实现 <code>.ts</code> 文件后缀的支持<pre class=language-json><code class=language-json><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES2020"</span><span class="token punctuation">,</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"bundler"</span><span class="token punctuation">,</span>
    <span class="token property">"allowImportingTsExtensions"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>最终效果如下图：<figure><img alt="" height=734 loading=lazy src=/img/http-protocol-with-one-dash/node-as-deno.png width=2020></figure><p></p><relative-time datetime=2023-05-14T11:05:08.970+00:00>2023-05-14T11:05:08.970+00:00</relative-time><a href=/events/http-protocol-with-one-dash>share↗</a></div><li><div><p><p>这是社区的讨论：<a href=https://github.com/whatwg/html/issues/1766#issuecomment-633197720>Add onclose event to MessagePort #1766</a><br>当初我提到一个垫片方案，那时是 2020 年，所以当初只有 chrome69+的内核能支持：<pre class=language-ts><code class=language-ts><span class="token comment">/// worker</span>
<span class="token keyword">const</span> lockReqId <span class="token operator">=</span> <span class="token string">"process-live-"</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span>locks<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>lockReqId<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">postMessage</span><span class="token punctuation">(</span>lockReqId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<p><span class="token comment">/// master</span><br>
worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>me<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> me<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">"string"</span> <span class="token operator">&&</span> me<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"process-live-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
navigator<span class="token punctuation">.</span>locks<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>
worker<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CloseEvent</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>
<span class="token punctuation">}</span><br>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><p>现在已经普遍支持<figure><img alt="" height=716 loading=lazy src=/img/message-port-onclose/caniuse-locks.png width=1482><figcaption>caniuse-locks</figcaption></figure><p></p><relative-time datetime=2023-04-07T00:50:33.815+00:00>2023-04-07T00:50:33.815+00:00</relative-time><a href=/events/message-port-onclose>share↗</a></div><li><div><p><p><a href=https://w3ctag.github.io/design-principles/ >Web Design Principles</a> 这篇文章提供了 Web 平台的接口设计最佳实践<p></p><relative-time datetime=2023-03-27T01:45:54.933+00:00>2023-03-27T01:45:54.933+00:00</relative-time><a href=/events/web-design-principles>share↗</a></div><li><div><p><p>尝试 Deploy to GitHub Pages<p></p><relative-time datetime=2021-12-21T07:51:03.136+00:00>2021-12-21T07:51:03.136+00:00</relative-time><a href=/events/event-2>share↗</a></div><li><div><p><p>Event模块是用于快速记录一些小事件。比如一些想法；一些值得分享的链接；一些图片等等<p></p><relative-time datetime=2021-12-20T09:45:18.629+00:00>2021-12-20T09:45:18.629+00:00</relative-time><a href=/events/first-event>share↗</a></div></ul></main><footer id=footer><div><nav><a href=https://twitter.com/gaubeebangeel rel="me nofollow" target=_blank>Twitter</a> · <a href=https://github.com/gaubee/gaubee.com/tree/main/./src/events.njk rel=nofollow target=_blank>Edit this page on GitHub</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>除非有特别的说明, 该站点所有直接内容都使用许可证：<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>署名 4.0 国际 (CC BY 4.0)</a></small><blockquote><small>本网站不收集任何访问者的行为与信息，不做任何商业运作，仅仅为个人使用</small> <small style=display:block><a href=https://beian.mps.gov.cn/#/query/webSearch>闽ICP备17026139号-1</a></small></blockquote></footer><script src=/js/dark-mode-toggle.mjs type=module></script><script src=/js/time-elements.mjs type=module></script><script src=/js/main.mjs type=module></script>