---
import HomeLayout from '../layouts/HomeLayout.astro';
import LeftSidebar from '../components/LeftSidebar.astro';
import RightSidebar from '../components/RightSidebar.astro';
import Card from '../components/Card.tsx';
import { getCollection } from 'astro:content';

// Use getCollection to fetch all posts from the content directory.
const articles = await getCollection('articles');
const events = await getCollection('events');

// Combine and sort all posts, creating a unified structure for the cards.
const allPosts = [...articles, ...events];

// Sort all posts by date
const sortedPosts = allPosts.sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf());

// Extract all unique tags
const allTags = [...new Set(allPosts.flatMap(post => post.data.tags || []))];


const pageTitle = "GauBee's Blog";
---
<HomeLayout title={pageTitle}>
    <div slot="left-sidebar">
        <LeftSidebar />
    </div>

    <div slot="main-content">
        <h1>GauBee's Feed</h1>
        <p>A collection of articles and events.</p>

        <div class="feed-container">
            {sortedPosts.map(post => (
                <Card
                    href={`/${post.collection}/${post.id}/`}
                    title={post.data.title || post.id}
                    date={post.data.date}
                    type={post.collection as 'article' | 'event'}
                />
            ))}
        </div>
    </div>

    <div slot="right-sidebar">
        <RightSidebar tags={allTags} />
    </div>
</HomeLayout>

<style>
	.feed-container {
		display: flex;
        flex-direction: column;
		gap: 0; /* Remove gap, handle spacing with borders */
        border-left: 1px solid var(--c-border);
        border-right: 1px solid var(--c-border);
	}
    h1, p {
        padding: 0 1rem;
    }
</style>
