---
import HomeLayout from '../layouts/HomeLayout.astro';
import LeftSidebar from '../components/LeftSidebar.astro';
import RightSidebar from '../components/RightSidebar.astro';
import Card from '../components/Card.tsx';
import { getCollection } from 'astro:content';

// Use getCollection to fetch all posts from the content directory.
const articles = await getCollection('articles');
const events = await getCollection('events');

// Combine and sort all posts, creating a unified structure for the cards.
const allPosts = [...articles, ...events].map(post => ({
    title: post.data.title || post.slug, // Use slug as a fallback title for events
    date: post.data.date,
    url: `/${post.collection}/${post.slug}/`, // Construct the URL based on collection and slug
    type: post.collection as 'article' | 'event'
})).sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf());

const pageTitle = "GauBee's Blog";
---
<HomeLayout title={pageTitle}>
    <div slot="left-sidebar">
        <LeftSidebar />
    </div>

    <div slot="main-content">
        <h1>GauBee's Feed</h1>
        <p>A collection of articles and events.</p>

        <div class="feed-container">
            {allPosts.map(post => (
                <Card
                    href={post.url}
                    title={post.title}
                    date={post.date}
                    type={post.type}
                />
            ))}
        </div>
    </div>

    <div slot="right-sidebar">
        <RightSidebar />
    </div>
</HomeLayout>

<style>
	.feed-container {
		display: flex;
        flex-direction: column;
		gap: 0; /* Remove gap, handle spacing with borders */
        border-left: 1px solid var(--c-border);
        border-right: 1px solid var(--c-border);
	}
    h1, p {
        padding: 0 1rem;
    }
</style>
