---
import RootLayout from "./RootLayout.astro";
import LeftSidebar from "@/components/LeftSidebar.tsx";
import BackToTop from "@/components/BackToTop.tsx";
import MobileNav from "@/components/MobileNav.tsx";
import Footer from "@/components/Footer.tsx";
import TableOfContentsCard from "@/components/cards/TableOfContentsCard.tsx";
import TagsCard from "@/components/cards/TagsCard.tsx";
import ArchiveCard from "@/components/cards/ArchiveCard.tsx";
import { getSiteData } from "@/lib/getSiteData.ts";
import type { MarkdownHeading } from "astro";
import { ContentScrollProgress } from "@/components/ContentScrollProgress";

import type { CollectionEntry } from "astro:content";

interface Props {
  title?: string;
  headings?: MarkdownHeading[];
  prev?: CollectionEntry<"articles" | "events">;
  next?: CollectionEntry<"articles" | "events">;
}

const { title, headings = [], prev, next } = Astro.props;
const { postsByMonth, allTags } = await getSiteData();
---

<RootLayout title={title}>
  <div class="mx-auto flex max-w-7xl">
    <aside
      class="sticky top-0 hidden h-screen w-64 flex-shrink-0 py-8 pr-8 lg:block"
    >
      <LeftSidebar />
    </aside>

    <main class="min-w-0 flex-1">
      <MobileNav client:load title={title}>
        <div class="space-y-4">
          <TableOfContentsCard client:load headings={headings} />
          <!-- <TagsCard client:load tags={allTags} />
          <ArchiveCard client:load postsByMonth={postsByMonth} /> -->
        </div>
      </MobileNav>
      <ContentScrollProgress />

      <div id="content" class="p-6">
        <slot />
      </div>

      <nav class="flex justify-between p-6">
        <div>
          {prev && (
            <a href={`/${prev.collection}/${prev.id}`} class="hover:text-sky-600 dark:hover:text-sky-400">
              &larr; {prev.data.title}
            </a>
          )}
        </div>
        <div>
          {next && (
            <a href={`/${next.collection}/${next.id}`} class="hover:text-sky-600 dark:hover:text-sky-400">
              {next.data.title} &rarr;
            </a>
          )}
        </div>
      </nav>
    </main>

    <aside
      class="sticky top-0 hidden h-screen w-64 flex-shrink-0 py-8 pl-8 lg:block"
    >
      <div class="space-y-4">
        <TableOfContentsCard headings={headings} />
        <TagsCard tags={allTags} />
        <ArchiveCard postsByMonth={postsByMonth} />
      </div>
    </aside>
  </div>

  <Footer />
  <BackToTop client:load />
</RootLayout>

<style>
  /** 默认隐藏滚动条，因此已经有 ContentScrollProgress 提供视觉滚动的支持了 */
  @plugin "tailwind-scrollbar";
  :root {
    @apply scrollbar-none;
  }
</style>
